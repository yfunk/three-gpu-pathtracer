let e,t,i,r,n,a,s,o,l,h,c,u,d,A,p;function f(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var m,g,v,w,y,b,E=globalThis,x={},M={},S=E.parcelRequire5b70;null==S&&((S=function(e){if(e in x)return x[e].exports;if(e in M){var t=M[e];delete M[e];var i={id:e,exports:{}};return x[e]=i,t.call(i.exports,i,i.exports),i.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){M[e]=t},E.parcelRequire5b70=S);var F=S.register;F("891vQ",function(e,t){f(e.exports,"RGBELoader",()=>r);var i=S("ilwiq");class r extends i.DataTextureLoader{constructor(e){super(e),this.type=i.HalfFloatType}parse(e){let t,r,n;let a=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},s=function(e,t,i){t=t||1024;let r=e.pos,n=-1,a=0,s="",o=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));for(;0>(n=o.indexOf("\n"))&&a<t&&r<e.byteLength;)s+=o,a+=o.length,r+=128,o+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(r,r+128)));return -1<n&&(!1!==i&&(e.pos+=a+n+1),s+o.slice(0,n))},o=new Uint8Array(e);o.pos=0;let l=function(e){let t,i;let r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,h={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=s(e))||a(1,"no header found"),(i=t.match(/^#\?(\S+)/))||a(3,"bad initial token"),h.valid|=1,h.programtype=i[1],h.string+=t+"\n";!1!==(t=s(e));){if(h.string+=t+"\n","#"===t.charAt(0)){h.comments+=t+"\n";continue}if((i=t.match(r))&&(h.gamma=parseFloat(i[1])),(i=t.match(n))&&(h.exposure=parseFloat(i[1])),(i=t.match(o))&&(h.valid|=2,h.format=i[1]),(i=t.match(l))&&(h.valid|=4,h.height=parseInt(i[1],10),h.width=parseInt(i[2],10)),2&h.valid&&4&h.valid)break}return 2&h.valid||a(3,"missing format specifier"),4&h.valid||a(3,"missing image size specifier"),h}(o),h=l.width,c=l.height,u=function(e,t,i){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&a(3,"wrong scanline width");let r=new Uint8Array(4*t*i);r.length||a(4,"unable to allocate buffer space");let n=0,s=0,o=4*t,l=new Uint8Array(4),h=new Uint8Array(o),c=i;for(;c>0&&s<e.byteLength;){s+4>e.byteLength&&a(1),l[0]=e[s++],l[1]=e[s++],l[2]=e[s++],l[3]=e[s++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&a(3,"bad rgbe scanline format");let i=0,u;for(;i<o&&s<e.byteLength;){let t=(u=e[s++])>128;if(t&&(u-=128),(0===u||i+u>o)&&a(3,"bad scanline data"),t){let t=e[s++];for(let e=0;e<u;e++)h[i++]=t}else h.set(e.subarray(s,s+u),i),i+=u,s+=u}for(let e=0;e<t;e++){let i=0;r[n]=h[e+i],i+=t,r[n+1]=h[e+i],i+=t,r[n+2]=h[e+i],i+=t,r[n+3]=h[e+i],n+=4}c--}return r}(o.subarray(o.pos),h,c);switch(this.type){case i.FloatType:let d=new Float32Array(4*(n=u.length/4));for(let e=0;e<n;e++)!function(e,t,i,r){let n=Math.pow(2,e[t+3]-128)/255;i[r+0]=e[t+0]*n,i[r+1]=e[t+1]*n,i[r+2]=e[t+2]*n,i[r+3]=1}(u,4*e,d,4*e);t=d,r=i.FloatType;break;case i.HalfFloatType:let A=new Uint16Array(4*(n=u.length/4));for(let e=0;e<n;e++)!function(e,t,r,n){let a=Math.pow(2,e[t+3]-128)/255;r[n+0]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+0]*a,65504)),r[n+1]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+1]*a,65504)),r[n+2]=(0,i.DataUtils).toHalfFloat(Math.min(e[t+2]*a,65504)),r[n+3]=(0,i.DataUtils).toHalfFloat(1)}(u,4*e,A,4*e);t=A,r=i.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:h,height:c,data:t,header:l.string,gamma:l.gamma,exposure:l.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,n){return super.load(e,function(e,r){switch(e.type){case i.FloatType:case i.HalfFloatType:e.colorSpace=i.LinearSRGBColorSpace,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,n)}}}),F("7MGRS",function(e,t){f(e.exports,"default",()=>r);var i=function(){var e=0,t=document.createElement("div");function r(e){return t.appendChild(e.dom),e}function n(i){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===i?"block":"none";e=i}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(i){i.preventDefault(),n(++e%t.children.length)},!1);var a=(performance||Date).now(),s=a,o=0,l=r(new i.Panel("FPS","#0ff","#002")),h=r(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=r(new i.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:r,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(h.update(e-a,200),e>=s+1e3&&(l.update(1e3*o/(e-s),100),s=e,o=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:t,setMode:n}};i.Panel=function(e,t,i){var r=1/0,n=0,a=Math.round,s=a(window.devicePixelRatio||1),o=80*s,l=48*s,h=3*s,c=2*s,u=3*s,d=15*s,A=74*s,p=30*s,f=document.createElement("canvas");f.width=o,f.height=l,f.style.cssText="width:80px;height:48px";var m=f.getContext("2d");return m.font="bold "+9*s+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=i,m.fillRect(0,0,o,l),m.fillStyle=t,m.fillText(e,h,c),m.fillRect(u,d,A,p),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(u,d,A,p),{dom:f,update:function(l,g){r=Math.min(r,l),n=Math.max(n,l),m.fillStyle=i,m.globalAlpha=1,m.fillRect(0,0,o,d),m.fillStyle=t,m.fillText(a(l)+" "+e+" ("+a(r)+"-"+a(n)+")",h,c),m.drawImage(f,u+s,d,A-s,p,u,d,A-s,p),m.fillRect(u+A-s,d,s,p),m.fillStyle=i,m.globalAlpha=.9,m.fillRect(u+A-s,d,s,a((1-l/g)*p))}}};var r=i}),F("1EdOY",function(e,t){f(e.exports,"generateRadialFloorTexture",()=>r);var i=S("ilwiq");function r(e){let t=new Uint8Array(e*e*4);for(let i=0;i<e;i++)for(let r=0;r<e;r++){let n=Math.max(Math.min(1-Math.sqrt((2*(i/(e-1)-.5))**2+(2*(r/(e-1)-.5))**2),1),0);n=Math.min(n=n**2*1.5,1);let a=r*e+i;t[4*a+0]=255,t[4*a+1]=255,t[4*a+2]=255,t[4*a+3]=255*n}let r=new i.DataTexture(t,e,e);return r.format=i.RGBAFormat,r.type=i.UnsignedByteType,r.minFilter=i.LinearFilter,r.magFilter=i.LinearFilter,r.wrapS=i.RepeatWrapping,r.wrapT=i.RepeatWrapping,r.needsUpdate=!0,r}}),F("62xhu",function(e,t){function i(e){return e.buffer instanceof ArrayBuffer&&"BYTES_PER_ELEMENT"in e}f(e.exports,"MaterialReducer",()=>r);class r{constructor(){let e=new Set;e.add("uuid"),this.ignoreKeys=e,this.shareTextures=!0,this.textures=[],this.materials=[]}areEqual(e,t){let r=new Set,n=new Set,a=this.ignoreKeys,s=(e,t)=>{if(e===t)return!0;if(e&&t&&e instanceof Object&&t instanceof Object){if(n.has(e)||n.has(t))throw Error("MaterialReducer: Material is recursive.");let o=e instanceof Element,l=t instanceof Element;if(o||l)return!!(o===l&&e instanceof Image&&t instanceof Image)&&e.src===t.src;let h=e instanceof ImageBitmap,c=t instanceof ImageBitmap;if(h||c)return!1;if(e.equals)return e.equals(t);let u=i(e),d=i(t);if(u||d){if(u!==d||e.constructor!==t.constructor||e.length!==t.length)return!1;for(let i=0,r=e.length;i<r;i++)if(e[i]!==t[i])return!1;return!0}for(let i in n.add(e),n.add(t),r.clear(),e)!e.hasOwnProperty(i)||e[i]instanceof Function||a.has(i)||r.add(i);for(let e in t)!t.hasOwnProperty(e)||t[e]instanceof Function||a.has(e)||r.add(e);let A=Array.from(r.values()),p=!0;for(let i in A){let r=A[i];if(!a.has(r)&&!(p=s(e[r],t[r])))break}return n.delete(e),n.delete(t),p}return!1};return s(e,t)}process(e){let{textures:t,materials:i}=this,r=0,n=e=>{let n=null;for(let t in i){let r=i[t];this.areEqual(e,r)&&(n=r)}if(n)return r++,n;if(i.push(e),this.shareTextures)for(let i in e){if(!e.hasOwnProperty(i))continue;let r=e[i];if(r&&r.isTexture&&r.image instanceof Image){let n=null;for(let e in t){let i=t[e];if(this.areEqual(i,r)){n=i;break}}n?e[i]=n:t.push(r)}}return e};return e.traverse(e=>{if(e.isMesh&&e.material){let t=e.material;if(Array.isArray(t))for(let e=0;e<t.length;e++)t[e]=n(t[e]);else e.material=n(t)}}),{replaced:r,retained:i.length}}}}),F("9fZ6X",function(e,t){f(e.exports,"MaterialBase",()=>r);var i=S("ilwiq");class r extends i.ShaderMaterial{constructor(e){for(let t in super(e),this.uniforms)Object.defineProperty(this,t,{get(){return this.uniforms[t].value},set(e){this.uniforms[t].value=e}})}setDefine(e,t){if(null==t){if(e in this.defines)return delete this.defines[e],this.needsUpdate=!0,!0}else if(this.defines[e]!==t)return this.defines[e]=t,this.needsUpdate=!0,!0;return!1}}}),F("khIrc",function(e,t){e.exports=function(){throw Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}}),F("fYvb1",function(e,t){f(e.exports,"math_functions",()=>i);let i=`

	// Fast arccos approximation used to remove banding artifacts caused by numerical errors in acos.
	// This is a cubic Lagrange interpolating polynomial for x = [-1, -1/2, 0, 1/2, 1].
	// For more information see: https://github.com/gkjohnson/three-gpu-pathtracer/pull/171#issuecomment-1152275248
	float acosApprox( float x ) {

		x = clamp( x, -1.0, 1.0 );
		return ( - 0.69813170079773212 * x * x - 0.87266462599716477 ) * x + 1.5707963267948966;

	}

	// An acos with input values bound to the range [-1, 1].
	float acosSafe( float x ) {

		return acos( clamp( x, -1.0, 1.0 ) );

	}

	float saturateCos( float val ) {

		return clamp( val, 0.001, 1.0 );

	}

	float square( float t ) {

		return t * t;

	}

	vec2 square( vec2 t ) {

		return t * t;

	}

	vec3 square( vec3 t ) {

		return t * t;

	}

	vec4 square( vec4 t ) {

		return t * t;

	}

	vec2 rotateVector( vec2 v, float t ) {

		float ac = cos( t );
		float as = sin( t );
		return vec2(
			v.x * ac - v.y * as,
			v.x * as + v.y * ac
		);

	}

	// forms a basis with the normal vector as Z
	mat3 getBasisFromNormal( vec3 normal ) {

		vec3 other;
		if ( abs( normal.x ) > 0.5 ) {

			other = vec3( 0.0, 1.0, 0.0 );

		} else {

			other = vec3( 1.0, 0.0, 0.0 );

		}

		vec3 ortho = normalize( cross( normal, other ) );
		vec3 ortho2 = normalize( cross( normal, ortho ) );
		return mat3( ortho2, ortho, normal );

	}

`}),F("dUUQZ",function(e,t){f(e.exports,"util_functions",()=>i);let i=`

	// TODO: possibly this should be renamed something related to material or path tracing logic

	#ifndef RAY_OFFSET
	#define RAY_OFFSET 1e-4
	#endif

	// adjust the hit point by the surface normal by a factor of some offset and the
	// maximum component-wise value of the current point to accommodate floating point
	// error as values increase.
	vec3 stepRayOrigin( vec3 rayOrigin, vec3 rayDirection, vec3 offset, float dist ) {

		vec3 point = rayOrigin + rayDirection * dist;
		vec3 absPoint = abs( point );
		float maxPoint = max( absPoint.x, max( absPoint.y, absPoint.z ) );
		return point + offset * ( maxPoint + 1.0 ) * RAY_OFFSET;

	}

	// https://github.com/KhronosGroup/glTF/blob/main/extensions/2.0/Khronos/KHR_materials_volume/README.md#attenuation
	vec3 transmissionAttenuation( float dist, vec3 attColor, float attDist ) {

		vec3 ot = - log( attColor ) / attDist;
		return exp( - ot * dist );

	}

	vec3 getHalfVector( vec3 wi, vec3 wo, float eta ) {

		// get the half vector - assuming if the light incident vector is on the other side
		// of the that it's transmissive.
		vec3 h;
		if ( wi.z > 0.0 ) {

			h = normalize( wi + wo );

		} else {

			// Scale by the ior ratio to retrieve the appropriate half vector
			// From Section 2.2 on computing the transmission half vector:
			// https://blog.selfshadow.com/publications/s2015-shading-course/burley/s2015_pbs_disney_bsdf_notes.pdf
			h = normalize( wi + wo * eta );

		}

		h *= sign( h.z );
		return h;

	}

	vec3 getHalfVector( vec3 a, vec3 b ) {

		return normalize( a + b );

	}

	// The discrepancy between interpolated surface normal and geometry normal can cause issues when a ray
	// is cast that is on the top side of the geometry normal plane but below the surface normal plane. If
	// we find a ray like that we ignore it to avoid artifacts.
	// This function returns if the direction is on the same side of both planes.
	bool isDirectionValid( vec3 direction, vec3 surfaceNormal, vec3 geometryNormal ) {

		bool aboveSurfaceNormal = dot( direction, surfaceNormal ) > 0.0;
		bool aboveGeometryNormal = dot( direction, geometryNormal ) > 0.0;
		return aboveSurfaceNormal == aboveGeometryNormal;

	}

	// ray sampling x and z are swapped to align with expected background view
	vec2 equirectDirectionToUv( vec3 direction ) {

		// from Spherical.setFromCartesianCoords
		vec2 uv = vec2( atan( direction.z, direction.x ), acos( direction.y ) );
		uv /= vec2( 2.0 * PI, PI );

		// apply adjustments to get values in range [0, 1] and y right side up
		uv.x += 0.5;
		uv.y = 1.0 - uv.y;
		return uv;

	}

	vec3 equirectUvToDirection( vec2 uv ) {

		// undo above adjustments
		uv.x -= 0.5;
		uv.y = 1.0 - uv.y;

		// from Vector3.setFromSphericalCoords
		float theta = uv.x * 2.0 * PI;
		float phi = uv.y * PI;

		float sinPhi = sin( phi );

		return vec3( sinPhi * cos( theta ), cos( phi ), sinPhi * sin( theta ) );

	}

	// power heuristic for multiple importance sampling
	float misHeuristic( float a, float b ) {

		float aa = a * a;
		float bb = b * b;
		return aa / ( aa + bb );

	}

	// tentFilter from Peter Shirley's 'Realistic Ray Tracing (2nd Edition)' book, pg. 60
	// erichlof/THREE.js-PathTracing-Renderer/
	float tentFilter( float x ) {

		return x < 0.5 ? sqrt( 2.0 * x ) - 1.0 : 1.0 - sqrt( 2.0 - ( 2.0 * x ) );

	}
`}),F("8keuf",function(e,t){f(e.exports,"ggx_functions",()=>i);let i=`

	// The GGX functions provide sampling and distribution information for normals as output so
	// in order to get probability of scatter direction the half vector must be computed and provided.
	// [0] https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.pdf
	// [1] https://hal.archives-ouvertes.fr/hal-01509746/document
	// [2] http://jcgt.org/published/0007/04/01/
	// [4] http://jcgt.org/published/0003/02/03/

	// trowbridge-reitz === GGX === GTR

	vec3 ggxDirection( vec3 incidentDir, vec2 roughness, vec2 uv ) {

		// TODO: try GGXVNDF implementation from reference [2], here. Needs to update ggxDistribution
		// function below, as well

		// Implementation from reference [1]
		// stretch view
		vec3 V = normalize( vec3( roughness * incidentDir.xy, incidentDir.z ) );

		// orthonormal basis
		vec3 T1 = ( V.z < 0.9999 ) ? normalize( cross( V, vec3( 0.0, 0.0, 1.0 ) ) ) : vec3( 1.0, 0.0, 0.0 );
		vec3 T2 = cross( T1, V );

		// sample point with polar coordinates (r, phi)
		float a = 1.0 / ( 1.0 + V.z );
		float r = sqrt( uv.x );
		float phi = ( uv.y < a ) ? uv.y / a * PI : PI + ( uv.y - a ) / ( 1.0 - a ) * PI;
		float P1 = r * cos( phi );
		float P2 = r * sin( phi ) * ( ( uv.y < a ) ? 1.0 : V.z );

		// compute normal
		vec3 N = P1 * T1 + P2 * T2 + V * sqrt( max( 0.0, 1.0 - P1 * P1 - P2 * P2 ) );

		// unstretch
		N = normalize( vec3( roughness * N.xy, max( 0.0, N.z ) ) );

		return N;

	}

	// Below are PDF and related functions for use in a Monte Carlo path tracer
	// as specified in Appendix B of the following paper
	// See equation (34) from reference [0]
	float ggxLamda( float theta, float roughness ) {

		float tanTheta = tan( theta );
		float tanTheta2 = tanTheta * tanTheta;
		float alpha2 = roughness * roughness;

		float numerator = - 1.0 + sqrt( 1.0 + alpha2 * tanTheta2 );
		return numerator / 2.0;

	}

	// See equation (34) from reference [0]
	float ggxShadowMaskG1( float theta, float roughness ) {

		return 1.0 / ( 1.0 + ggxLamda( theta, roughness ) );

	}

	// See equation (125) from reference [4]
	float ggxShadowMaskG2( vec3 wi, vec3 wo, float roughness ) {

		float incidentTheta = acos( wi.z );
		float scatterTheta = acos( wo.z );
		return 1.0 / ( 1.0 + ggxLamda( incidentTheta, roughness ) + ggxLamda( scatterTheta, roughness ) );

	}

	// See equation (33) from reference [0]
	float ggxDistribution( vec3 halfVector, float roughness ) {

		float a2 = roughness * roughness;
		a2 = max( EPSILON, a2 );
		float cosTheta = halfVector.z;
		float cosTheta4 = pow( cosTheta, 4.0 );

		if ( cosTheta == 0.0 ) return 0.0;

		float theta = acosSafe( halfVector.z );
		float tanTheta = tan( theta );
		float tanTheta2 = pow( tanTheta, 2.0 );

		float denom = PI * cosTheta4 * pow( a2 + tanTheta2, 2.0 );
		return ( a2 / denom );

	}

	// See equation (3) from reference [2]
	float ggxPDF( vec3 wi, vec3 halfVector, float roughness ) {

		float incidentTheta = acos( wi.z );
		float D = ggxDistribution( halfVector, roughness );
		float G1 = ggxShadowMaskG1( incidentTheta, roughness );

		return D * G1 * max( 0.0, dot( wi, halfVector ) ) / wi.z;

	}

`});var R=S("ilwiq"),_=S("891vQ"),T=S("cpS3d"),P=S("9hfHi"),C=S("jiuw3"),D=S("7MGRS"),B=S("1EdOY"),I=S("hWj76"),L=S("62xhu"),O=S("kLfIo"),G=S("ieQ3q"),R=S("ilwiq"),N=S("hWds8");function*V(e){let{viewCount:t,_camera:i,_quiltUtility:r,_subframe:n}=this,a={subframe:n,projectionMatrix:i.projectionMatrix,offsetDirection:new R.Vector3};for(;;){for(let n=0;n<t;n++){r.near=this.camera.near,r.far=this.camera.far,r.getCameraViewInfo(n,a),a.offsetDirection.transformDirection(this.camera.matrixWorld),this.camera.matrixWorld.decompose(i.position,i.quaternion,i.scale),i.position.addScaledVector(a.offsetDirection,a.offset),i.updateMatrixWorld(),i.projectionMatrixInverse.copy(i.projectionMatrix).invert(),this._opacityFactor=Math.floor(this._samples+1)/Math.floor(this._quiltSamples+1);do{let t=this.camera;this.camera=i,e(),this.camera=t,yield}while(this._samples%1!=0)this._quiltSamples+=1/t}this._quiltSamples=Math.round(this._quiltSamples)}}class k{constructor(){this.viewCount=48,this.quiltDimensions=new R.Vector2(8,6),this.viewCone=35*R.MathUtils.DEG2RAD,this.viewFoV=14*R.MathUtils.DEG2RAD,this.displayDistance=1,this.displayAspect=.75,this.near=.01,this.far=10}getCameraViewInfo(e,t={}){let{quiltDimensions:i,viewCone:r,displayDistance:n,viewCount:a,viewFoV:s,displayAspect:o,near:l,far:h}=this;t.subframe=t.subframe||new R.Vector4,t.offsetDirection=t.offsetDirection||new R.Vector3,t.projectionMatrix=t.projectionMatrix||new R.Matrix4;let c=Math.tan(.5*r)*n,u=1===a?0:-c+2*c/(a-1)*e;t.offsetDirection.set(1,0,0),t.offset=u;let d=Math.tan(.5*s)*n,A=o*d,p=l/n;t.projectionMatrix.makePerspective(p*(-A-u),p*(A-u),p*d,-(p*d),l,h);let f=e%i.x,m=Math.floor(e/i.x),g=1/i.x,v=1/i.y;return t.subframe.set(f*g,m*v,g,v),t}setFromDisplayView(e,t,i){this.displayAspect=t/i,this.displayDistance=e,this.viewFoV=2*Math.atan(.5*i/e)}}class U extends N.PathTracingRenderer{get samples(){return this._samples/this.viewCount}constructor(...e){super(...e),["quiltDimensions","viewCount","viewCone","viewFoV","displayDistance","displayAspect"].forEach(e=>{Object.defineProperty(this,e,{enumerable:!0,set:t=>{this._quiltUtility[e]=t},get:()=>this._quiltUtility[e]})}),this._quiltUtility=new k,this._quiltSamples=0,this._camera=new R.PerspectiveCamera,this._quiltTask=null}setFromDisplayView(...e){this._quiltUtility.setFromDisplayView(...e)}update(){this.alpha=!1,this._quiltTask||(this._quiltTask=V.call(this,()=>{super.update()})),this._quiltTask.next()}reset(){super.reset(),this._quiltTask=null,this._quiltSamples=0}}var z=S("RPVlj"),Q=S("5Rd1x"),R=S("ilwiq"),H=S("9fZ6X");class X extends H.MaterialBase{constructor(e){super({depthWrite:!1,blending:R.CustomBlending,uniforms:{quiltMap:{value:null},quiltDimensions:{value:new R.Vector2},displayIndex:{value:0},aspectRatio:{value:1},heightScale:{value:.75}},vertexShader:`

				varying vec2 vUv;
				void main() {

					vec4 mvPosition = vec4( position, 1.0 );
					mvPosition = modelViewMatrix * mvPosition;
					gl_Position = projectionMatrix * mvPosition;

					vUv = uv;

				}

			`,fragmentShader:`

				varying vec2 vUv;
				uniform sampler2D quiltMap;
				uniform ivec2 quiltDimensions;
				uniform int displayIndex;
				uniform float aspectRatio;
				uniform float heightScale;

				void main() {

					vec2 tileUv = vUv;
					tileUv.x -= ( 1.0 - aspectRatio * heightScale ) * 0.5;
					tileUv.x /= aspectRatio;

					tileUv.y -= ( 1.0 - heightScale ) * 0.5;
					tileUv /= heightScale;

					if ( tileUv.x < 0.0 || tileUv.x > 1.0 || tileUv.y < 0.0 || tileUv.y > 1.0 ) {

						gl_FragColor = vec4( 0.05, 0.05, 0.05, 1.0 );
						return;

					}

					ivec2 size = textureSize( quiltMap, 0 );
					vec2 texelWidth = 1.0 / vec2( size );
					vec2 tileTexelHalfWidth = 0.5 * vec2( quiltDimensions ) * texelWidth;
					tileUv = max( tileTexelHalfWidth, min( 1.0 - tileTexelHalfWidth, tileUv ) );

					ivec2 tileIndex = ivec2( 0 );
					tileIndex.x = displayIndex % quiltDimensions.x;
					tileIndex.y = ( displayIndex - tileIndex.x ) / quiltDimensions.x;

					vec2 tileWidth = 1.0 / vec2( quiltDimensions );
					vec2 quiltUv = tileWidth * ( vec2( tileIndex ) + tileUv );

					gl_FragColor = texture( quiltMap, quiltUv );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>

				}

			`}),this.setValues(e)}}const W=Symbol("@@webxr-polyfill/EventTarget");class q{constructor(){this[W]={listeners:new Map}}addEventListener(e,t){if("string"!=typeof e)throw Error("`type` must be a string");if("function"!=typeof t)throw Error("`listener` must be a function");let i=this[W].listeners.get(e)||[];i.push(t),this[W].listeners.set(e,i)}removeEventListener(e,t){if("string"!=typeof e)throw Error("`type` must be a string");if("function"!=typeof t)throw Error("`listener` must be a function");let i=this[W].listeners.get(e)||[];for(let e=i.length;e>=0;e--)i[e]===t&&i.pop()}dispatchEvent(e,t){let i=this[W].listeners.get(e)||[],r=[];for(let e=0;e<i.length;e++)r[e]=i[e];for(let e of r)e(t);"function"==typeof this[`on${e}`]&&this[`on${e}`](t)}}let j="undefined"!=typeof Float32Array?Float32Array:Array;function Y(){let e=new j(16);return j!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Z(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function K(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],A=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=i*o-r*s,w=i*l-n*s,y=i*h-a*s,b=r*l-n*o,E=r*h-a*o,x=n*h-a*l,M=c*f-u*p,S=c*m-d*p,F=c*g-A*p,R=u*m-d*f,_=u*g-A*f,T=d*g-A*m,P=v*T-w*_+y*R+b*F-E*S+x*M;return P?(P=1/P,e[0]=(o*T-l*_+h*R)*P,e[1]=(n*_-r*T-a*R)*P,e[2]=(f*x-m*E+g*b)*P,e[3]=(d*E-u*x-A*b)*P,e[4]=(l*F-s*T-h*S)*P,e[5]=(i*T-n*F+a*S)*P,e[6]=(m*y-p*x-g*w)*P,e[7]=(c*x-d*y+A*w)*P,e[8]=(s*_-o*F+h*M)*P,e[9]=(r*F-i*_-a*M)*P,e[10]=(p*E-f*y+g*v)*P,e[11]=(u*y-c*E-A*v)*P,e[12]=(o*S-s*R-l*M)*P,e[13]=(i*R-r*S+n*M)*P,e[14]=(f*w-p*b-m*v)*P,e[15]=(c*b-u*w+d*v)*P,e):null}function J(e,t,i){let r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],A=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],w=i[0],y=i[1],b=i[2],E=i[3];return e[0]=w*r+y*o+b*u+E*f,e[1]=w*n+y*l+b*d+E*m,e[2]=w*a+y*h+b*A+E*g,e[3]=w*s+y*c+b*p+E*v,w=i[4],y=i[5],b=i[6],E=i[7],e[4]=w*r+y*o+b*u+E*f,e[5]=w*n+y*l+b*d+E*m,e[6]=w*a+y*h+b*A+E*g,e[7]=w*s+y*c+b*p+E*v,w=i[8],y=i[9],b=i[10],E=i[11],e[8]=w*r+y*o+b*u+E*f,e[9]=w*n+y*l+b*d+E*m,e[10]=w*a+y*h+b*A+E*g,e[11]=w*s+y*c+b*p+E*v,w=i[12],y=i[13],b=i[14],E=i[15],e[12]=w*r+y*o+b*u+E*f,e[13]=w*n+y*l+b*d+E*m,e[14]=w*a+y*h+b*A+E*g,e[15]=w*s+y*c+b*p+E*v,e}function $(e,t,i){let r=t[0],n=t[1],a=t[2],s=t[3],o=r+r,l=n+n,h=a+a,c=r*o,u=r*l,d=r*h,A=n*l,p=n*h,f=a*h,m=s*o,g=s*l,v=s*h;return e[0]=1-(A+f),e[1]=u+v,e[2]=d-g,e[3]=0,e[4]=u-v,e[5]=1-(c+f),e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-(c+A),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function ee(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function et(e,t){let i=t[0]+t[5]+t[10],r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function ei(e,t,i,r,n){let a=1/Math.tan(t/2),s;return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(s=1/(r-n),e[10]=(n+r)*s,e[14]=2*n*r*s):(e[10]=-1,e[14]=-2*r),e}function er(){let e=new j(3);return j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function en(e){var t=new j(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ea(e,t,i){let r=new j(3);return r[0]=e,r[1]=t,r[2]=i,r}function es(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function eo(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function el(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function eh(e,t){let i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function ec(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function eu(e,t,i){let r=i[0],n=i[1],a=i[2],s=i[3],o=t[0],l=t[1],h=t[2],c=n*h-a*l,u=a*o-r*h,d=r*l-n*o,A=n*d-a*u,p=a*c-r*d,f=r*u-n*c,m=2*s;return c*=m,u*=m,d*=m,A*=2,p*=2,f*=2,e[0]=o+c+A,e[1]=l+u+p,e[2]=h+d+f,e}function ed(){let e=new j(4);return j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function eA(e,t,i){let r=t[0],n=t[1],a=t[2],s=t[3],o=i[0],l=i[1],h=i[2],c=i[3];return e[0]=r*c+s*o+n*h-a*l,e[1]=n*c+s*l+a*o-r*h,e[2]=a*c+s*h+r*l-n*o,e[3]=s*c-r*o-n*l-a*h,e}function ep(e,t,i,r){let n,a,s,o,l,h=t[0],c=t[1],u=t[2],d=t[3],A=i[0],p=i[1],f=i[2],m=i[3];return(a=h*A+c*p+u*f+d*m)<0&&(a=-a,A=-A,p=-p,f=-f,m=-m),1-a>1e-6?(s=Math.sin(n=Math.acos(a)),o=Math.sin((1-r)*n)/s,l=Math.sin(r*n)/s):(o=1-r,l=r),e[0]=o*h+l*A,e[1]=o*c+l*p,e[2]=o*u+l*f,e[3]=o*d+l*m,e}function ef(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return e[0]=-i*o,e[1]=-r*o,e[2]=-n*o,e[3]=a*o,e}er(),A=new j(4),j!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0);const em=function(e){let t=new j(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},eg=function(e,t,i,r){let n=new j(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},ev=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ew=function(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=a*s),e};er(),ea(1,0,0),ea(0,1,0),ed(),ed(),p=new j(9),j!=Float32Array&&(p[1]=0,p[2]=0,p[3]=0,p[5]=0,p[6]=0,p[7]=0),p[0]=1,p[4]=1,p[8]=1;const ey=Symbol("@@webxr-polyfill/XRRigidTransform");class eb{constructor(){if(this[ey]={matrix:null,position:null,orientation:null,inverse:null},0==arguments.length)this[ey].matrix=Z(new Float32Array(16));else if(1==arguments.length)arguments[0]instanceof Float32Array?this[ey].matrix=arguments[0]:(this[ey].position=this._getPoint(arguments[0]),this[ey].orientation=DOMPointReadOnly.fromPoint({x:0,y:0,z:0,w:1}));else if(2==arguments.length)this[ey].position=this._getPoint(arguments[0]),this[ey].orientation=this._getPoint(arguments[1]);else throw Error("Too many arguments!");if(this[ey].matrix){let e=er();ee(e,this[ey].matrix),this[ey].position=DOMPointReadOnly.fromPoint({x:e[0],y:e[1],z:e[2]});let t=ed();et(t,this[ey].matrix),this[ey].orientation=DOMPointReadOnly.fromPoint({x:t[0],y:t[1],z:t[2],w:t[3]})}else this[ey].matrix=Z(new Float32Array(16)),$(this[ey].matrix,eg(this[ey].orientation.x,this[ey].orientation.y,this[ey].orientation.z,this[ey].orientation.w),ea(this[ey].position.x,this[ey].position.y,this[ey].position.z))}_getPoint(e){return e instanceof DOMPointReadOnly?e:DOMPointReadOnly.fromPoint(e)}get matrix(){return this[ey].matrix}get position(){return this[ey].position}get orientation(){return this[ey].orientation}get inverse(){if(null===this[ey].inverse){let e=Z(new Float32Array(16));K(e,this[ey].matrix),this[ey].inverse=new eb(e),this[ey].inverse[ey].inverse=this}return this[ey].inverse}}const eE=Symbol("@@webxr-polyfill/XRSpace");class ex{constructor(e=null,t=null){this[eE]={specialType:e,inputSource:t,baseMatrix:null,inverseBaseMatrix:null,lastFrameId:-1}}get _specialType(){return this[eE].specialType}get _inputSource(){return this[eE].inputSource}_ensurePoseUpdated(e,t){t!=this[eE].lastFrameId&&(this[eE].lastFrameId=t,this._onPoseUpdate(e))}_onPoseUpdate(e){"viewer"==this[eE].specialType&&(this._baseMatrix=e.getBasePoseMatrix())}set _baseMatrix(e){this[eE].baseMatrix=e,this[eE].inverseBaseMatrix=null}get _baseMatrix(){return!this[eE].baseMatrix&&this[eE].inverseBaseMatrix&&(this[eE].baseMatrix=new Float32Array(16),K(this[eE].baseMatrix,this[eE].inverseBaseMatrix)),this[eE].baseMatrix}set _inverseBaseMatrix(e){this[eE].inverseBaseMatrix=e,this[eE].baseMatrix=null}get _inverseBaseMatrix(){return!this[eE].inverseBaseMatrix&&this[eE].baseMatrix&&(this[eE].inverseBaseMatrix=new Float32Array(16),K(this[eE].inverseBaseMatrix,this[eE].baseMatrix)),this[eE].inverseBaseMatrix}_getSpaceRelativeTransform(e){if(!this._inverseBaseMatrix||!e._baseMatrix)return null;let t=new Float32Array(16);return J(t,this._inverseBaseMatrix,e._baseMatrix),new eb(t)}}const eM=Symbol("@@webxr-polyfill/XRReferenceSpace"),eS=["viewer","local","local-floor","bounded-floor","unbounded"];class eF extends ex{constructor(e,t=null){if(!eS.includes(e))throw Error(`XRReferenceSpaceType must be one of ${eS}`);if(super(e),"bounded-floor"===e&&!t)throw Error("XRReferenceSpace cannot use 'bounded-floor' type if the platform does not provide the floor level");"bounded-floor"!==e&&"local-floor"!==e||t||((t=Z(new Float32Array(16)))[13]=1.6),this._inverseBaseMatrix=t||Z(new Float32Array(16)),this[eM]={type:e,transform:t,originOffset:Z(new Float32Array(16))}}_transformBasePoseMatrix(e,t){J(e,this._inverseBaseMatrix,t)}_originOffsetMatrix(){return this[eM].originOffset}_adjustForOriginOffset(e){let t=new Float32Array(16);K(t,this[eM].originOffset),J(e,t,e)}_getSpaceRelativeTransform(e){let t=super._getSpaceRelativeTransform(e);return this._adjustForOriginOffset(t.matrix),new XRRigidTransform(t.matrix)}getOffsetReferenceSpace(e){let t=new eF(this[eM].type,this[eM].transform,this[eM].bounds);return J(t[eM].originOffset,this[eM].originOffset,e.matrix),t}}const eR=Symbol("@@webxr-polyfill/XR"),e_=["inline","immersive-vr","immersive-ar"],eT={inline:{requiredFeatures:["viewer"],optionalFeatures:[]},"immersive-vr":{requiredFeatures:["viewer","local"],optionalFeatures:[]},"immersive-ar":{requiredFeatures:["viewer","local"],optionalFeatures:[]}},eP=`Polyfill Error: Must call navigator.xr.isSessionSupported() with any XRSessionMode
or navigator.xr.requestSession('inline') prior to requesting an immersive
session. This is a limitation specific to the WebXR Polyfill and does not apply
to native implementations of the API.`;class eC extends q{constructor(e){super(),this[eR]={device:null,devicePromise:e,immersiveSession:null,inlineSessions:new Set},e.then(e=>{this[eR].device=e})}async isSessionSupported(e){return(this[eR].device||await this[eR].devicePromise,"inline"!=e)?Promise.resolve(this[eR].device.isSessionSupported(e)):Promise.resolve(!0)}async requestSession(e,t){if(!this[eR].device){if("inline"!=e)throw Error(eP);await this[eR].devicePromise}if(!e_.includes(e))throw TypeError(`The provided value '${e}' is not a valid enum value of type XRSessionMode`);let i=eT[e],r=i.requiredFeatures.concat(t&&t.requiredFeatures?t.requiredFeatures:[]),n=i.optionalFeatures.concat(t&&t.optionalFeatures?t.optionalFeatures:[]),a=new Set,s=!1;for(let e of r)this[eR].device.isFeatureSupported(e)?a.add(e):(console.error(`The required feature '${e}' is not supported`),s=!0);if(s)throw new DOMException("Session does not support some required features","NotSupportedError");for(let e of n)this[eR].device.isFeatureSupported(e)?a.add(e):console.log(`The optional feature '${e}' is not supported`);let o=await this[eR].device.requestSession(e,a),l=new XRSession(this[eR].device,e,o);"inline"==e?this[eR].inlineSessions.add(l):this[eR].immersiveSession=l;let h=()=>{"inline"==e?this[eR].inlineSessions.delete(l):this[eR].immersiveSession=null,l.removeEventListener("end",h)};return l.addEventListener("end",h),l}}const eD=void 0!==E?E:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};if("performance"in eD==!1){let t=Date.now();e=()=>Date.now()-t}else e=()=>performance.now();var eB=e;const eI=Symbol("@@webxr-polyfill/XRPose");class eL{constructor(e,t){this[eI]={transform:e,emulatedPosition:t}}get transform(){return this[eI].transform}get emulatedPosition(){return this[eI].emulatedPosition}}const eO=Symbol("@@webxr-polyfill/XRViewerPose");class eG extends eL{constructor(e,t,i=!1){super(e,i),this[eO]={views:t}}get views(){return this[eO].views}}const eN=Symbol("@@webxr-polyfill/XRViewport");class eV{constructor(e){this[eN]={target:e}}get x(){return this[eN].target.x}get y(){return this[eN].target.y}get width(){return this[eN].target.width}get height(){return this[eN].target.height}}const ek=["left","right","none"],eU=Symbol("@@webxr-polyfill/XRView");class ez{constructor(e,t,i,r,n){if(!ek.includes(i))throw Error(`XREye must be one of: ${ek}`);let a=Object.create(null),s=new eV(a);this[eU]={device:e,eye:i,viewport:s,temp:a,sessionId:r,transform:t,viewIndex:n}}get eye(){return this[eU].eye}get projectionMatrix(){return this[eU].device.getProjectionMatrix(this.eye,this[eU].viewIndex)}get transform(){return this[eU].transform}_getViewport(e){if(this[eU].device.getViewport(this[eU].sessionId,this.eye,e,this[eU].temp,this[eU].viewIndex))return this[eU].viewport}}const eQ=Symbol("@@webxr-polyfill/XRFrame"),eH="XRFrame access outside the callback that produced it is invalid.";let eX=0;class eW{constructor(e,t,i){this[eQ]={id:++eX,active:!1,animationFrame:!1,device:e,session:t,sessionId:i}}get session(){return this[eQ].session}getViewerPose(e){if(!this[eQ].animationFrame)throw new DOMException("getViewerPose can only be called on XRFrame objects passed to XRSession.requestAnimationFrame callbacks.","InvalidStateError");if(!this[eQ].active)throw new DOMException(eH,"InvalidStateError");let t=this[eQ].device,i=this[eQ].session;i[e2].viewerSpace._ensurePoseUpdated(t,this[eQ].id),e._ensurePoseUpdated(t,this[eQ].id);let r=e._getSpaceRelativeTransform(i[e2].viewerSpace),n=[];for(let r of i[e2].viewSpaces){r._ensurePoseUpdated(t,this[eQ].id);let i=new ez(t,e._getSpaceRelativeTransform(r),r.eye,this[eQ].sessionId,r.viewIndex);n.push(i)}return new eG(r,n,!1)}getPose(e,t){if(!this[eQ].active)throw new DOMException(eH,"InvalidStateError");let i=this[eQ].device;if("target-ray"===e._specialType||"grip"===e._specialType)return i.getInputPose(e._inputSource,t,e._specialType);{e._ensurePoseUpdated(i,this[eQ].id),t._ensurePoseUpdated(i,this[eQ].id);let r=t._getSpaceRelativeTransform(e);return r?new XRPose(r,!1):null}}}const eq=Symbol("@@webxr-polyfill/XRRenderState"),ej=Object.freeze({depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:null,baseLayer:null});class eY{constructor(e={}){let t=Object.assign({},ej,e);this[eq]={config:t}}get depthNear(){return this[eq].config.depthNear}get depthFar(){return this[eq].config.depthFar}get inlineVerticalFieldOfView(){return this[eq].config.inlineVerticalFieldOfView}get baseLayer(){return this[eq].config.baseLayer}}const eZ=Symbol("@@webxr-polyfill/XRInputSourceEvent");class eK extends Event{constructor(e,t){super(e,t),this[eZ]={frame:t.frame,inputSource:t.inputSource},Object.setPrototypeOf(this,eK.prototype)}get frame(){return this[eZ].frame}get inputSource(){return this[eZ].inputSource}}const eJ=Symbol("@@webxr-polyfill/XRSessionEvent");class e$ extends Event{constructor(e,t){super(e,t),this[eJ]={session:t.session},Object.setPrototypeOf(this,e$.prototype)}get session(){return this[eJ].session}}const e1=Symbol("@@webxr-polyfill/XRInputSourcesChangeEvent");class e0 extends Event{constructor(e,t){super(e,t),this[e1]={session:t.session,added:t.added,removed:t.removed},Object.setPrototypeOf(this,e0.prototype)}get session(){return this[e1].session}get added(){return this[e1].added}get removed(){return this[e1].removed}}const e2=Symbol("@@webxr-polyfill/XRSession");class e3 extends ex{constructor(e){super(e)}get eye(){return this._specialType}_onPoseUpdate(e){this._inverseBaseMatrix=e.getBaseViewMatrix(this._specialType)}}class e4 extends q{constructor(e,t,i){super();let r="inline"!=t,n=new eY({inlineVerticalFieldOfView:r?null:.5*Math.PI}),a=r?[new e3("left"),new e3("right")]:[new e3("none")];Object.freeze(a),this[e2]={device:e,mode:t,immersive:r,ended:!1,suspended:!1,frameCallbacks:[],currentFrameCallbacks:null,frameHandle:0,deviceFrameHandle:null,id:i,activeRenderState:n,pendingRenderState:null,viewerSpace:new eF("viewer"),get viewSpaces(){return e.getViewSpaces(t)||a},currentInputSources:[]},this[e2].onDeviceFrame=()=>{if(this[e2].ended||this[e2].suspended||(this[e2].deviceFrameHandle=null,this[e2].startDeviceFrameLoop(),null!==this[e2].pendingRenderState&&(this[e2].activeRenderState=new eY(this[e2].pendingRenderState),this[e2].pendingRenderState=null,this[e2].activeRenderState.baseLayer&&this[e2].device.onBaseLayerSet(this[e2].id,this[e2].activeRenderState.baseLayer)),null===this[e2].activeRenderState.baseLayer))return;let t=new eW(e,this,this[e2].id),i=this[e2].currentFrameCallbacks=this[e2].frameCallbacks;this[e2].frameCallbacks=[],t[eQ].active=!0,t[eQ].animationFrame=!0,this[e2].device.onFrameStart(this[e2].id,this[e2].activeRenderState),this._checkInputSourcesChange();let r=eB();for(let e=0;e<i.length;e++)try{i[e].cancelled||"function"!=typeof i[e].callback||i[e].callback(r,t)}catch(e){console.error(e)}this[e2].currentFrameCallbacks=null,t[eQ].active=!1,this[e2].device.onFrameEnd(this[e2].id)},this[e2].startDeviceFrameLoop=()=>{null===this[e2].deviceFrameHandle&&(this[e2].deviceFrameHandle=this[e2].device.requestAnimationFrame(this[e2].onDeviceFrame))},this[e2].stopDeviceFrameLoop=()=>{let e=this[e2].deviceFrameHandle;null!==e&&(this[e2].device.cancelAnimationFrame(e),this[e2].deviceFrameHandle=null)},this[e2].onPresentationEnd=t=>{if(t!==this[e2].id){this[e2].suspended=!1,this[e2].startDeviceFrameLoop(),this.dispatchEvent("focus",{session:this});return}this[e2].ended=!0,this[e2].stopDeviceFrameLoop(),e.removeEventListener("@@webxr-polyfill/vr-present-end",this[e2].onPresentationEnd),e.removeEventListener("@@webxr-polyfill/vr-present-start",this[e2].onPresentationStart),e.removeEventListener("@@webxr-polyfill/input-select-start",this[e2].onSelectStart),e.removeEventListener("@@webxr-polyfill/input-select-end",this[e2].onSelectEnd),this.dispatchEvent("end",new e$("end",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-end",this[e2].onPresentationEnd),this[e2].onPresentationStart=e=>{e!==this[e2].id&&(this[e2].suspended=!0,this[e2].stopDeviceFrameLoop(),this.dispatchEvent("blur",{session:this}))},e.addEventListener("@@webxr-polyfill/vr-present-start",this[e2].onPresentationStart),this[e2].onSelectStart=e=>{e.sessionId===this[e2].id&&this[e2].dispatchInputSourceEvent("selectstart",e.inputSource)},e.addEventListener("@@webxr-polyfill/input-select-start",this[e2].onSelectStart),this[e2].onSelectEnd=e=>{e.sessionId===this[e2].id&&(this[e2].dispatchInputSourceEvent("selectend",e.inputSource),this[e2].dispatchInputSourceEvent("select",e.inputSource))},e.addEventListener("@@webxr-polyfill/input-select-end",this[e2].onSelectEnd),this[e2].onSqueezeStart=e=>{e.sessionId===this[e2].id&&this[e2].dispatchInputSourceEvent("squeezestart",e.inputSource)},e.addEventListener("@@webxr-polyfill/input-squeeze-start",this[e2].onSqueezeStart),this[e2].onSqueezeEnd=e=>{e.sessionId===this[e2].id&&(this[e2].dispatchInputSourceEvent("squeezeend",e.inputSource),this[e2].dispatchInputSourceEvent("squeeze",e.inputSource))},e.addEventListener("@@webxr-polyfill/input-squeeze-end",this[e2].onSqueezeEnd),this[e2].dispatchInputSourceEvent=(t,i)=>{let r=new eW(e,this,this[e2].id),n=new eK(t,{frame:r,inputSource:i});r[eQ].active=!0,this.dispatchEvent(t,n),r[eQ].active=!1},this[e2].startDeviceFrameLoop(),this.onblur=void 0,this.onfocus=void 0,this.onresetpose=void 0,this.onend=void 0,this.onselect=void 0,this.onselectstart=void 0,this.onselectend=void 0}get renderState(){return this[e2].activeRenderState}get environmentBlendMode(){return this[e2].device.environmentBlendMode||"opaque"}async requestReferenceSpace(e){if(this[e2].ended)return;if(!eS.includes(e))throw TypeError(`XRReferenceSpaceType must be one of ${eS}`);if(!this[e2].device.doesSessionSupportReferenceSpace(this[e2].id,e))throw new DOMException(`The ${e} reference space is not supported by this session.`,"NotSupportedError");if("viewer"===e)return this[e2].viewerSpace;let t=await this[e2].device.requestFrameOfReferenceTransform(e);if("bounded-floor"===e){if(!t||!this[e2].device.requestStageBounds())throw new DOMException(`${e} XRReferenceSpace not supported by this device.`,"NotSupportedError");throw new DOMException(`The WebXR polyfill does not support the ${e} reference space yet.`,"NotSupportedError")}return new eF(e,t)}requestAnimationFrame(e){if(this[e2].ended)return;let t=++this[e2].frameHandle;return this[e2].frameCallbacks.push({handle:t,callback:e,cancelled:!1}),t}cancelAnimationFrame(e){let t=this[e2].frameCallbacks,i=t.findIndex(t=>t&&t.handle===e);i>-1&&(t[i].cancelled=!0,t.splice(i,1)),(t=this[e2].currentFrameCallbacks)&&(i=t.findIndex(t=>t&&t.handle===e))>-1&&(t[i].cancelled=!0)}get inputSources(){return this[e2].device.getInputSources()}async end(){if(!this[e2].ended)return this[e2].immersive&&(this[e2].ended=!0,this[e2].device.removeEventListener("@@webxr-polyfill/vr-present-start",this[e2].onPresentationStart),this[e2].device.removeEventListener("@@webxr-polyfill/vr-present-end",this[e2].onPresentationEnd),this[e2].device.removeEventListener("@@webxr-polyfill/input-select-start",this[e2].onSelectStart),this[e2].device.removeEventListener("@@webxr-polyfill/input-select-end",this[e2].onSelectEnd),this.dispatchEvent("end",new e$("end",{session:this}))),this[e2].stopDeviceFrameLoop(),this[e2].device.endSession(this[e2].id)}updateRenderState(e){if(this[e2].ended)throw Error("Can't call updateRenderState on an XRSession that has already ended.");if(e.baseLayer&&e.baseLayer._session!==this)throw Error("Called updateRenderState with a base layer that was created by a different session.");if(null!==e.inlineVerticalFieldOfView&&void 0!==e.inlineVerticalFieldOfView){if(this[e2].immersive)throw Error("inlineVerticalFieldOfView must not be set for an XRRenderState passed to updateRenderState for an immersive session.");e.inlineVerticalFieldOfView=Math.min(3.13,Math.max(.01,e.inlineVerticalFieldOfView))}if(null===this[e2].pendingRenderState){let e=this[e2].activeRenderState;this[e2].pendingRenderState={depthNear:e.depthNear,depthFar:e.depthFar,inlineVerticalFieldOfView:e.inlineVerticalFieldOfView,baseLayer:e.baseLayer}}Object.assign(this[e2].pendingRenderState,e)}_checkInputSourcesChange(){let e=[],t=[],i=this.inputSources,r=this[e2].currentInputSources;for(let t of i)r.includes(t)||e.push(t);for(let e of r)i.includes(e)||t.push(e);for(let r of((e.length>0||t.length>0)&&this.dispatchEvent("inputsourceschange",new e0("inputsourceschange",{session:this,added:e,removed:t})),this[e2].currentInputSources.length=0,i))this[e2].currentInputSources.push(r)}}const e5=Symbol("@@webxr-polyfill/XRInputSource");class e6{constructor(e){this[e5]={impl:e,gripSpace:new ex("grip",this),targetRaySpace:new ex("target-ray",this)}}get handedness(){return this[e5].impl.handedness}get targetRayMode(){return this[e5].impl.targetRayMode}get gripSpace(){let e=this[e5].impl.targetRayMode;return"gaze"===e||"screen"===e?null:this[e5].gripSpace}get targetRaySpace(){return this[e5].targetRaySpace}get profiles(){return this[e5].impl.profiles}get gamepad(){return this[e5].impl.gamepad}}const e7=Symbol("@@webxr-polyfill/polyfilled-xr-compatible"),e8=Symbol("@@webxr-polyfill/xr-compatible"),e9=Symbol("@@webxr-polyfill/XRWebGLLayer"),te=Object.freeze({antialias:!0,depth:!0,stencil:!1,alpha:!0,multiview:!1,ignoreDepthValues:!1,framebufferScaleFactor:1});class tt{constructor(e,t,i={}){let r=Object.assign({},te,i);if(!(e instanceof e4))throw Error("session must be a XRSession");if(e.ended||t[e7]&&!0!==t[e8])throw Error("InvalidStateError");this[e9]={context:t,config:r,session:e}}get context(){return this[e9].context}get antialias(){return this[e9].config.antialias}get ignoreDepthValues(){return!0}get framebuffer(){return null}get framebufferWidth(){return this[e9].context.drawingBufferWidth}get framebufferHeight(){return this[e9].context.drawingBufferHeight}get _session(){return this[e9].session}getViewport(e){return e._getViewport(this)}static getNativeFramebufferScaleFactor(e){if(!e)throw TypeError("getNativeFramebufferScaleFactor must be passed a session.");return e[e2].ended?0:1}}const ti=Symbol("@@webxr-polyfill/XRReferenceSpaceEvent");class tr extends Event{constructor(e,t){super(e,t),this[ti]={referenceSpace:t.referenceSpace,transform:t.transform||null},Object.setPrototypeOf(this,tr.prototype)}get referenceSpace(){return this[ti].referenceSpace}get transform(){return this[ti].transform}}var tn={XRSystem:eC,XRSession:e4,XRSessionEvent:e$,XRFrame:eW,XRView:ez,XRViewport:eV,XRViewerPose:eG,XRWebGLLayer:tt,XRSpace:ex,XRReferenceSpace:eF,XRReferenceSpaceEvent:tr,XRInputSource:e6,XRInputSourceEvent:eK,XRInputSourcesChangeEvent:e0,XRRenderState:eY,XRRigidTransform:eb,XRPose:eL};const ta=e=>(e.prototype.makeXRCompatible,e.prototype.makeXRCompatible=function(){return this[e8]=!0,Promise.resolve()},!0),ts=e=>{let t=e.prototype.getContext;e.prototype.getContext=function(e,i){let r=t.call(this,e,i);return r&&(r[e7]=!0,i&&"xrCompatible"in i&&(r[e8]=i.xrCompatible)),r}},to=e=>!!(e.ImageBitmapRenderingContext&&e.createImageBitmap),tl=e=>{var t,i=!1;return t=e.navigator.userAgent||e.navigator.vendor||e.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(i=!0),i},th=e=>{e.style.display="block",e.style.position="absolute",e.style.width=e.style.height="1px",e.style.top=e.style.left="0px"};var tc={};tc=function(){!function(){function e(e){this.value=e}function t(t){var i,r;function n(i,r){try{var s=t[i](r),o=s.value;o instanceof e?Promise.resolve(o.value).then(function(e){n("next",e)},function(e){n("throw",e)}):a(s.done?"return":"normal",s.value)}catch(e){a("throw",e)}}function a(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?n(i.key,i.arg):r=null}this._invoke=function(e,t){return new Promise(function(a,s){var o={key:e,arg:t,resolve:a,reject:s,next:null};r?r=r.next=o:(i=r=o,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}();var e,t,i,r,n,a,s,o,l,h,c,u,d,A,p,f,m=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")},g=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(i.push(s.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw a}}return i}(e,t);throw TypeError("Invalid attempt to destructure non-iterable instance")},w=function(e,t,i){return e+(t-e)*i},y=(r=/iPad|iPhone|iPod/.test(navigator.platform),function(){return r}),b=(n=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome"),function(){return n}),x=(a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),function(){return a}),M=(s=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android"),function(){return s}),S=(l=(o=navigator.userAgent.match(/.*Chrome\/([0-9]+)/))?parseInt(o[1],10):null,function(){return l}),F=(h=!1,h=y()&&x()&&-1!==navigator.userAgent.indexOf("13_4"),function(){return h}),R=function(){var e=!1;if(65===S()){var t=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(t){var i=v(t[1].split("."),4),r=(i[0],i[1],i[2]),n=i[3];e=3325===parseInt(r,10)&&148>parseInt(n,10)}}return function(){return e}}(),_=(c=-1!==navigator.userAgent.indexOf("R7 Build"),function(){return c}),T=function(){var e=90==window.orientation||-90==window.orientation;return _()?!e:e},P=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},C=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},D=function(e){if(b())return!1;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else{if(!e.msRequestFullscreen)return!1;e.msRequestFullscreen()}return!0},B=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},I=function(e,t,i,r){var n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t),e.compileShader(n);var a=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(a,i),e.compileShader(a);var s=e.createProgram();for(var o in e.attachShader(s,n),e.attachShader(s,a),r)e.bindAttribLocation(s,r[o],o);return e.linkProgram(s),e.deleteShader(n),e.deleteShader(a),s},L=function(e,t){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n="",a=0;a<r;a++)i[n=e.getActiveUniform(t,a).name.replace("[0]","")]=e.getUniformLocation(t,n);return i},O=function(e,t,i,r,n,a,s){var o=1/(t-i),l=1/(r-n),h=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+i)*o,e[13]=(n+r)*l,e[14]=(s+a)*h,e[15]=1,e},G=function(){var e,t=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t},N=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},V=function(e){if(y()){var t=e.style.width,i=e.style.height;e.style.width=parseInt(t)+1+"px",e.style.height=parseInt(i)+"px",setTimeout(function(){e.style.width=t,e.style.height=i},100)}window.canvas=e},k=function(){var e=Math.PI/180,t=.25*Math.PI,i=new Float32Array([0,0,0,1]),r=new Float32Array([0,0,0]);function n(n,a,s,o,l,h){c=o||null,u=h.depthNear,d=h.depthFar,A=Math.tan(c?c.upDegrees*e:t),p=Math.tan(c?c.downDegrees*e:t),g=2/((f=Math.tan(c?c.leftDegrees*e:t))+(m=Math.tan(c?c.rightDegrees*e:t))),v=2/(A+p),n[0]=g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=v,n[6]=0,n[7]=0,n[8]=-((f-m)*g*.5),n[9]=(A-p)*v*.5,n[10]=d/(u-d),n[11]=-1,n[12]=0,n[13]=0,n[14]=d*u/(u-d),n[15]=0;var c,u,d,A,p,f,m,g,v,w,y,b,E,x,M,S,F,R,_,T,P,C,D,B,I,L,O,G,N,V,k,U,z,Q,H,X,W,q,j,Y,Z,K,J,$,ee,et,ei,er,en,ea,es,eo,el,eh,ec,eu,ed,eA,ep,ef,em,eg,ev,ew,ey,eb,eE,ex,eM,eS=s.orientation||i,eF=s.position||r;w=eS[0],y=eS[1],b=eS[2],E=eS[3],x=w+w,M=y+y,S=b+b,F=w*x,R=w*M,_=w*S,T=y*M,P=y*S,C=b*S,D=E*x,B=E*M,I=E*S,a[0]=1-(T+C),a[1]=R+I,a[2]=_-B,a[3]=0,a[4]=R-I,a[5]=1-(F+C),a[6]=P+D,a[7]=0,a[8]=_+B,a[9]=P-D,a[10]=1-(F+T),a[11]=0,a[12]=eF[0],a[13]=eF[1],a[14]=eF[2],a[15]=1,l&&(q=l[0],j=l[1],Y=l[2],a==a?(a[12]=a[0]*q+a[4]*j+a[8]*Y+a[12],a[13]=a[1]*q+a[5]*j+a[9]*Y+a[13],a[14]=a[2]*q+a[6]*j+a[10]*Y+a[14],a[15]=a[3]*q+a[7]*j+a[11]*Y+a[15]):(L=a[0],O=a[1],G=a[2],N=a[3],V=a[4],k=a[5],U=a[6],z=a[7],Q=a[8],H=a[9],X=a[10],W=a[11],a[0]=L,a[1]=O,a[2]=G,a[3]=N,a[4]=V,a[5]=k,a[6]=U,a[7]=z,a[8]=Q,a[9]=H,a[10]=X,a[11]=W,a[12]=L*q+V*j+Q*Y+a[12],a[13]=O*q+k*j+H*Y+a[13],a[14]=G*q+U*j+X*Y+a[14],a[15]=N*q+z*j+W*Y+a[15])),Z=a[0],K=a[1],J=a[2],$=a[3],ee=a[4],et=a[5],ei=a[6],er=a[7],en=a[8],ea=a[9],es=a[10],eo=a[11],el=a[12],eh=a[13],ec=a[14],eu=a[15],ed=Z*et-K*ee,eA=Z*ei-J*ee,ep=Z*er-$*ee,ef=K*ei-J*et,em=K*er-$*et,eg=J*er-$*ei,ev=en*eh-ea*el,ew=en*ec-es*el,ey=en*eu-eo*el,eb=ea*ec-es*eh,eE=ea*eu-eo*eh,(eM=ed*(ex=es*eu-eo*ec)-eA*eE+ep*eb+ef*ey-em*ew+eg*ev)&&(eM=1/eM,a[0]=(et*ex-ei*eE+er*eb)*eM,a[1]=(J*eE-K*ex-$*eb)*eM,a[2]=(eh*eg-ec*em+eu*ef)*eM,a[3]=(es*em-ea*eg-eo*ef)*eM,a[4]=(ei*ey-ee*ex-er*ew)*eM,a[5]=(Z*ex-J*ey+$*ew)*eM,a[6]=(ec*ep-el*eg-eu*eA)*eM,a[7]=(en*eg-es*ep+eo*eA)*eM,a[8]=(ee*eE-et*ey+er*ev)*eM,a[9]=(K*ey-Z*eE-$*ev)*eM,a[10]=(el*em-eh*ep+eu*ed)*eM,a[11]=(ea*ep-en*em-eo*ed)*eM,a[12]=(et*ew-ee*eb-ei*ev)*eM,a[13]=(Z*eb-K*ew+J*ev)*eM,a[14]=(eh*eA-el*ef-ec*ed)*eM,a[15]=(en*ef-ea*eA+es*ed)*eM)}return function(e,t,i){return!!e&&!!t&&(e.pose=t,e.timestamp=t.timestamp,n(e.leftProjectionMatrix,e.leftViewMatrix,t,i._getFieldOfView("left"),i._getEyeOffset("left"),i),n(e.rightProjectionMatrix,e.rightViewMatrix,t,i._getFieldOfView("right"),i._getEyeOffset("right"),i),!0)}}(),U=function(){var e=window.self!==window.top,t=z(document.referrer),i=z(window.location.href);return e&&t!==i},z=function(e){var t,i=e.indexOf("://");t=-1!==i?i+3:0;var r=e.indexOf("/",t);return -1===r&&(r=e.length),e.substring(0,r)},Q=(u={},function(e,t){void 0===u[e]&&(console.warn("webvr-polyfill: "+t),u[e]=!0)}),H=function(e,t){Q(e,e+" has been deprecated. This may not work on native WebVR displays. "+(t?"Please use "+t+" instead.":""))},X=function(e,t,i){if(!t){i(e);return}for(var r=[],n=null,a=0;a<t.length;++a){var s=t[a];switch(s){case e.TEXTURE_BINDING_2D:case e.TEXTURE_BINDING_CUBE_MAP:var o=t[++a];if(o<e.TEXTURE0||o>e.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit"),r.push(null,null);break}n||(n=e.getParameter(e.ACTIVE_TEXTURE)),e.activeTexture(o),r.push(e.getParameter(s),null);break;case e.ACTIVE_TEXTURE:n=e.getParameter(e.ACTIVE_TEXTURE),r.push(null);break;default:r.push(e.getParameter(s))}}i(e);for(var a=0;a<t.length;++a){var s=t[a],l=r[a];switch(s){case e.ACTIVE_TEXTURE:break;case e.ARRAY_BUFFER_BINDING:e.bindBuffer(e.ARRAY_BUFFER,l);break;case e.COLOR_CLEAR_VALUE:e.clearColor(l[0],l[1],l[2],l[3]);break;case e.COLOR_WRITEMASK:e.colorMask(l[0],l[1],l[2],l[3]);break;case e.CURRENT_PROGRAM:e.useProgram(l);break;case e.ELEMENT_ARRAY_BUFFER_BINDING:e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,l);break;case e.FRAMEBUFFER_BINDING:e.bindFramebuffer(e.FRAMEBUFFER,l);break;case e.RENDERBUFFER_BINDING:e.bindRenderbuffer(e.RENDERBUFFER,l);break;case e.TEXTURE_BINDING_2D:var o=t[++a];if(o<e.TEXTURE0||o>e.TEXTURE31)break;e.activeTexture(o),e.bindTexture(e.TEXTURE_2D,l);break;case e.TEXTURE_BINDING_CUBE_MAP:var o=t[++a];if(o<e.TEXTURE0||o>e.TEXTURE31)break;e.activeTexture(o),e.bindTexture(e.TEXTURE_CUBE_MAP,l);break;case e.VIEWPORT:e.viewport(l[0],l[1],l[2],l[3]);break;case e.BLEND:case e.CULL_FACE:case e.DEPTH_TEST:case e.SCISSOR_TEST:case e.STENCIL_TEST:l?e.enable(s):e.disable(s);break;default:console.log("No GL restore behavior for 0x"+s.toString(16))}n&&e.activeTexture(n)}};function W(e,t,i,r){this.gl=e,this.cardboardUI=t,this.bufferScale=i,this.dirtySubmitFrameBindings=r,this.ctxAttribs=e.getContextAttributes(),this.instanceExt=e.getExtension("ANGLE_instanced_arrays"),this.meshWidth=20,this.meshHeight=20,this.bufferWidth=e.drawingBufferWidth,this.bufferHeight=e.drawingBufferHeight,this.realBindFramebuffer=e.bindFramebuffer,this.realEnable=e.enable,this.realDisable=e.disable,this.realColorMask=e.colorMask,this.realClearColor=e.clearColor,this.realViewport=e.viewport,y()||(this.realCanvasWidth=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"width"),this.realCanvasHeight=Object.getOwnPropertyDescriptor(e.canvas.__proto__,"height")),this.isPatched=!1,this.lastBoundFramebuffer=null,this.cullFace=!1,this.depthTest=!1,this.blend=!1,this.scissorTest=!1,this.stencilTest=!1,this.viewport=[0,0,0,0],this.colorMask=[!0,!0,!0,!0],this.clearColor=[0,0,0,0],this.attribs={position:0,texCoord:1},this.program=I(e,"attribute vec2 position;\nattribute vec3 texCoord;\nvarying vec2 vTexCoord;\nuniform vec4 viewportOffsetScale[2];\nvoid main() {\n  vec4 viewport = viewportOffsetScale[int(texCoord.z)];\n  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;\n  gl_Position = vec4( position, 1.0, 1.0 );\n}","precision mediump float;\nuniform sampler2D diffuse;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(diffuse, vTexCoord);\n}",this.attribs),this.uniforms=L(e,this.program),this.viewportOffsetScale=new Float32Array(8),this.setTextureBounds(),this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.indexCount=0,this.renderTarget=e.createTexture(),this.framebuffer=e.createFramebuffer(),this.depthStencilBuffer=null,this.depthBuffer=null,this.stencilBuffer=null,this.ctxAttribs.depth&&this.ctxAttribs.stencil?this.depthStencilBuffer=e.createRenderbuffer():this.ctxAttribs.depth?this.depthBuffer=e.createRenderbuffer():this.ctxAttribs.stencil&&(this.stencilBuffer=e.createRenderbuffer()),this.patch(),this.onResize()}W.prototype.destroy=function(){var e=this.gl;this.unpatch(),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.indexBuffer),e.deleteTexture(this.renderTarget),e.deleteFramebuffer(this.framebuffer),this.depthStencilBuffer&&e.deleteRenderbuffer(this.depthStencilBuffer),this.depthBuffer&&e.deleteRenderbuffer(this.depthBuffer),this.stencilBuffer&&e.deleteRenderbuffer(this.stencilBuffer),this.cardboardUI&&this.cardboardUI.destroy()},W.prototype.onResize=function(){var e=this.gl,t=this,i=[e.RENDERBUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0];X(e,i,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.framebuffer),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.texImage2D(e.TEXTURE_2D,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,t.bufferWidth,t.bufferHeight,0,t.ctxAttribs.alpha?e.RGBA:e.RGB,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.renderTarget,0),t.ctxAttribs.depth&&t.ctxAttribs.stencil?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthStencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t.depthStencilBuffer)):t.ctxAttribs.depth?(e.bindRenderbuffer(e.RENDERBUFFER,t.depthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.depthBuffer)):t.ctxAttribs.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,t.stencilBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.STENCIL_INDEX8,t.bufferWidth,t.bufferHeight),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,t.stencilBuffer)),!e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer incomplete!"),t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),t.realClearColor.apply(e,t.clearColor)}),this.cardboardUI&&this.cardboardUI.onResize()},W.prototype.patch=function(){if(!this.isPatched){var e=this,t=this.gl.canvas,i=this.gl;y()||(t.width=P()*this.bufferScale,t.height=C()*this.bufferScale,Object.defineProperty(t,"width",{configurable:!0,enumerable:!0,get:function(){return e.bufferWidth},set:function(i){e.bufferWidth=i,e.realCanvasWidth.set.call(t,i),e.onResize()}}),Object.defineProperty(t,"height",{configurable:!0,enumerable:!0,get:function(){return e.bufferHeight},set:function(i){e.bufferHeight=i,e.realCanvasHeight.set.call(t,i),e.onResize()}})),this.lastBoundFramebuffer=i.getParameter(i.FRAMEBUFFER_BINDING),null==this.lastBoundFramebuffer&&(this.lastBoundFramebuffer=this.framebuffer,this.gl.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer)),this.gl.bindFramebuffer=function(t,r){e.lastBoundFramebuffer=r||e.framebuffer,e.realBindFramebuffer.call(i,t,e.lastBoundFramebuffer)},this.cullFace=i.getParameter(i.CULL_FACE),this.depthTest=i.getParameter(i.DEPTH_TEST),this.blend=i.getParameter(i.BLEND),this.scissorTest=i.getParameter(i.SCISSOR_TEST),this.stencilTest=i.getParameter(i.STENCIL_TEST),i.enable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!0;break;case i.DEPTH_TEST:e.depthTest=!0;break;case i.BLEND:e.blend=!0;break;case i.SCISSOR_TEST:e.scissorTest=!0;break;case i.STENCIL_TEST:e.stencilTest=!0}e.realEnable.call(i,t)},i.disable=function(t){switch(t){case i.CULL_FACE:e.cullFace=!1;break;case i.DEPTH_TEST:e.depthTest=!1;break;case i.BLEND:e.blend=!1;break;case i.SCISSOR_TEST:e.scissorTest=!1;break;case i.STENCIL_TEST:e.stencilTest=!1}e.realDisable.call(i,t)},this.colorMask=i.getParameter(i.COLOR_WRITEMASK),i.colorMask=function(t,r,n,a){e.colorMask[0]=t,e.colorMask[1]=r,e.colorMask[2]=n,e.colorMask[3]=a,e.realColorMask.call(i,t,r,n,a)},this.clearColor=i.getParameter(i.COLOR_CLEAR_VALUE),i.clearColor=function(t,r,n,a){e.clearColor[0]=t,e.clearColor[1]=r,e.clearColor[2]=n,e.clearColor[3]=a,e.realClearColor.call(i,t,r,n,a)},this.viewport=i.getParameter(i.VIEWPORT),i.viewport=function(t,r,n,a){e.viewport[0]=t,e.viewport[1]=r,e.viewport[2]=n,e.viewport[3]=a,e.realViewport.call(i,t,r,n,a)},this.isPatched=!0,V(t)}},W.prototype.unpatch=function(){if(this.isPatched){var e=this.gl,t=this.gl.canvas;y()||(Object.defineProperty(t,"width",this.realCanvasWidth),Object.defineProperty(t,"height",this.realCanvasHeight)),t.width=this.bufferWidth,t.height=this.bufferHeight,e.bindFramebuffer=this.realBindFramebuffer,e.enable=this.realEnable,e.disable=this.realDisable,e.colorMask=this.realColorMask,e.clearColor=this.realClearColor,e.viewport=this.realViewport,this.lastBoundFramebuffer==this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,null),this.isPatched=!1,setTimeout(function(){V(t)},1)}},W.prototype.setTextureBounds=function(e,t){e||(e=[0,0,.5,1]),t||(t=[.5,0,.5,1]),this.viewportOffsetScale[0]=e[0],this.viewportOffsetScale[1]=e[1],this.viewportOffsetScale[2]=e[2],this.viewportOffsetScale[3]=e[3],this.viewportOffsetScale[4]=t[0],this.viewportOffsetScale[5]=t[1],this.viewportOffsetScale[6]=t[2],this.viewportOffsetScale[7]=t[3]},W.prototype.submitFrame=function(){var e=this.gl,t=this,i=[];if(this.dirtySubmitFrameBindings||i.push(e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING,e.ELEMENT_ARRAY_BUFFER_BINDING,e.TEXTURE_BINDING_2D,e.TEXTURE0),X(e,i,function(e){t.realBindFramebuffer.call(e,e.FRAMEBUFFER,null);var i=0,r=0;t.instanceExt&&(i=e.getVertexAttrib(t.attribs.position,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE),r=e.getVertexAttrib(t.attribs.texCoord,t.instanceExt.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE)),t.cullFace&&t.realDisable.call(e,e.CULL_FACE),t.depthTest&&t.realDisable.call(e,e.DEPTH_TEST),t.blend&&t.realDisable.call(e,e.BLEND),t.scissorTest&&t.realDisable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realDisable.call(e,e.STENCIL_TEST),t.realColorMask.call(e,!0,!0,!0,!0),t.realViewport.call(e,0,0,e.drawingBufferWidth,e.drawingBufferHeight),(t.ctxAttribs.alpha||y())&&(t.realClearColor.call(e,0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)),e.useProgram(t.program),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.enableVertexAttribArray(t.attribs.position),e.enableVertexAttribArray(t.attribs.texCoord),e.vertexAttribPointer(t.attribs.position,2,e.FLOAT,!1,20,0),e.vertexAttribPointer(t.attribs.texCoord,3,e.FLOAT,!1,20,8),t.instanceExt&&(0!=i&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,0),0!=r&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,0)),e.activeTexture(e.TEXTURE0),e.uniform1i(t.uniforms.diffuse,0),e.bindTexture(e.TEXTURE_2D,t.renderTarget),e.uniform4fv(t.uniforms.viewportOffsetScale,t.viewportOffsetScale),e.drawElements(e.TRIANGLES,t.indexCount,e.UNSIGNED_SHORT,0),t.cardboardUI&&t.cardboardUI.renderNoState(),t.realBindFramebuffer.call(t.gl,e.FRAMEBUFFER,t.framebuffer),t.ctxAttribs.preserveDrawingBuffer||(t.realClearColor.call(e,0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)),t.dirtySubmitFrameBindings||t.realBindFramebuffer.call(e,e.FRAMEBUFFER,t.lastBoundFramebuffer),t.cullFace&&t.realEnable.call(e,e.CULL_FACE),t.depthTest&&t.realEnable.call(e,e.DEPTH_TEST),t.blend&&t.realEnable.call(e,e.BLEND),t.scissorTest&&t.realEnable.call(e,e.SCISSOR_TEST),t.stencilTest&&t.realEnable.call(e,e.STENCIL_TEST),t.realColorMask.apply(e,t.colorMask),t.realViewport.apply(e,t.viewport),(t.ctxAttribs.alpha||!t.ctxAttribs.preserveDrawingBuffer)&&t.realClearColor.apply(e,t.clearColor),t.instanceExt&&(0!=i&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.position,i),0!=r&&t.instanceExt.vertexAttribDivisorANGLE(t.attribs.texCoord,r))}),y()){var r=e.canvas;(r.width!=t.bufferWidth||r.height!=t.bufferHeight)&&(t.bufferWidth=r.width,t.bufferHeight=r.height,t.onResize())}},W.prototype.updateDeviceInfo=function(e){var t=this.gl,i=this,r=[t.ARRAY_BUFFER_BINDING,t.ELEMENT_ARRAY_BUFFER_BINDING];X(t,r,function(t){var r=i.computeMeshVertices_(i.meshWidth,i.meshHeight,e);if(t.bindBuffer(t.ARRAY_BUFFER,i.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),!i.indexCount){var n=i.computeMeshIndices_(i.meshWidth,i.meshHeight);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),i.indexCount=n.length}})},W.prototype.computeMeshVertices_=function(e,t,i){for(var r=new Float32Array(2*e*t*5),n=i.getLeftEyeVisibleTanAngles(),a=i.getLeftEyeNoLensTanAngles(),s=i.getLeftEyeVisibleScreenRect(a),o=0,l=0;l<2;l++){for(var h=0;h<t;h++)for(var c=0;c<e;c++,o++){var u=c/(e-1),d=h/(t-1),A=u,p=d,f=w(n[0],n[2],u),m=w(n[3],n[1],d),g=Math.sqrt(f*f+m*m),v=i.distortion.distortInverse(g),y=f*v/g,b=m*v/g;u=(y-a[0])/(a[2]-a[0]),d=(b-a[3])/(a[1]-a[3]),u=(s.x+u*s.width-.5)*2,d=(s.y+d*s.height-.5)*2,r[5*o+0]=u,r[5*o+1]=d,r[5*o+2]=A,r[5*o+3]=p,r[5*o+4]=l}var E=n[2]-n[0];n[0]=-(E+n[0]),n[2]=E-n[2],E=a[2]-a[0],a[0]=-(E+a[0]),a[2]=E-a[2],s.x=1-(s.x+s.width)}return r},W.prototype.computeMeshIndices_=function(e,t){for(var i=new Uint16Array(2*(e-1)*(t-1)*6),r=e/2,n=t/2,a=0,s=0,o=0;o<2;o++)for(var l=0;l<t;l++)for(var h=0;h<e;h++,a++)0!=h&&0!=l&&(h<=r==l<=n?(i[s++]=a,i[s++]=a-e-1,i[s++]=a-e,i[s++]=a-e-1,i[s++]=a,i[s++]=a-1):(i[s++]=a-1,i[s++]=a-e,i[s++]=a,i[s++]=a-e,i[s++]=a-1,i[s++]=a-e-1));return i},W.prototype.getOwnPropertyDescriptor_=function(e,t){var i=Object.getOwnPropertyDescriptor(e,t);return(void 0===i.get||void 0===i.set)&&(i.configurable=!0,i.enumerable=!0,i.get=function(){return this.getAttribute(t)},i.set=function(e){this.setAttribute(t,e)}),i};var q=Math.PI/180;function j(e){this.gl=e,this.attribs={position:0},this.program=I(e,"attribute vec2 position;\nuniform mat4 projectionMat;\nvoid main() {\n  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );\n}","precision mediump float;\nuniform vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}",this.attribs),this.uniforms=L(e,this.program),this.vertexBuffer=e.createBuffer(),this.gearOffset=0,this.gearVertexCount=0,this.arrowOffset=0,this.arrowVertexCount=0,this.projMat=new Float32Array(16),this.listener=null,this.onResize()}function Y(e){this.coefficients=e}j.prototype.destroy=function(){var e=this.gl;this.listener&&e.canvas.removeEventListener("click",this.listener,!1),e.deleteProgram(this.program),e.deleteBuffer(this.vertexBuffer)},j.prototype.listen=function(e,t){var i=this.gl.canvas;this.listener=function(r){var n=i.clientWidth/2;r.clientX>n-42&&r.clientX<n+42&&r.clientY>i.clientHeight-42?e(r):r.clientX<42&&r.clientY<42&&t(r)},i.addEventListener("click",this.listener,!1)},j.prototype.onResize=function(){var e=this.gl,t=this,i=[e.ARRAY_BUFFER_BINDING];X(e,i,function(e){var i=[],r=e.drawingBufferWidth/2,n=Math.max(screen.width,screen.height)*window.devicePixelRatio,a=e.drawingBufferWidth/n*window.devicePixelRatio,s=4*a/2,o=42*a,l=28*a/2,h=14*a;function c(e,t){var n=(90-e)*q,a=Math.cos(n),s=Math.sin(n);i.push(.3125*a*l+r,.3125*s*l+l),i.push(t*a*l+r,t*s*l+l)}i.push(r-s,o),i.push(r-s,e.drawingBufferHeight),i.push(r+s,o),i.push(r+s,e.drawingBufferHeight),t.gearOffset=i.length/2;for(var u=0;u<=6;u++){var d=60*u;c(d,1),c(d+12,1),c(d+20,.75),c(d+40,.75),c(d+48,1)}function A(t,r){i.push(h+t,e.drawingBufferHeight-h-r)}t.gearVertexCount=i.length/2-t.gearOffset,t.arrowOffset=i.length/2;var p=s/Math.sin(45*q);A(0,l),A(l,0),A(l+p,p),A(p,l+p),A(p,l-p),A(0,l),A(l,2*l),A(l+p,2*l-p),A(p,l-p),A(0,l),A(p,l-s),A(28*a,l-s),A(p,l+s),A(28*a,l+s),t.arrowVertexCount=i.length/2-t.arrowOffset,e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array(i),e.STATIC_DRAW)})},j.prototype.render=function(){var e=this.gl,t=this,i=[e.CULL_FACE,e.DEPTH_TEST,e.BLEND,e.SCISSOR_TEST,e.STENCIL_TEST,e.COLOR_WRITEMASK,e.VIEWPORT,e.CURRENT_PROGRAM,e.ARRAY_BUFFER_BINDING];X(e,i,function(e){e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.colorMask(!0,!0,!0,!0),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.renderNoState()})},j.prototype.renderNoState=function(){var e=this.gl;e.useProgram(this.program),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.enableVertexAttribArray(this.attribs.position),e.vertexAttribPointer(this.attribs.position,2,e.FLOAT,!1,8,0),e.uniform4f(this.uniforms.color,1,1,1,1),O(this.projMat,0,e.drawingBufferWidth,0,e.drawingBufferHeight,.1,1024),e.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.drawArrays(e.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount),e.drawArrays(e.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)},Y.prototype.distortInverse=function(e){for(var t=0,i=1,r=e-this.distort(t);Math.abs(i-t)>1e-4;){var n=e-this.distort(i),a=i-(i-t)/(n-r)*n;t=i,i=a,r=n}return i},Y.prototype.distort=function(e){for(var t=e*e,i=0,r=0;r<this.coefficients.length;r++)i=t*(i+this.coefficients[r]);return(i+1)*e};var Z=Math.PI/180,K=180/Math.PI,J=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0};J.prototype={constructor:J,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var e=this.length();return 0!==e?this.multiplyScalar(1/e):(this.x=0,this.y=0,this.z=0),this},multiplyScalar:function(e){this.x*=e,this.y*=e,this.z*=e},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,a=e.y,s=e.z,o=e.w,l=o*t+a*r-s*i,h=o*i+s*t-n*r,c=o*r+n*i-a*t,u=-n*t-a*i-s*r;return this.x=l*o+-(u*n)+-(h*s)- -(c*a),this.y=h*o+-(u*a)+-(c*n)- -(l*s),this.z=c*o+-(u*s)+-(l*a)- -(h*n),this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,a=t.x,s=t.y,o=t.z;return this.x=r*o-n*s,this.y=n*a-i*o,this.z=i*s-r*a,this}};var $=function(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1};function ee(e){this.width=e.width||P(),this.height=e.height||C(),this.widthMeters=e.widthMeters,this.heightMeters=e.heightMeters,this.bevelMeters=e.bevelMeters}$.prototype={constructor:$,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEulerXYZ:function(e,t,i){var r=Math.cos(e/2),n=Math.cos(t/2),a=Math.cos(i/2),s=Math.sin(e/2),o=Math.sin(t/2),l=Math.sin(i/2);return this.x=s*n*a+r*o*l,this.y=r*o*a-s*n*l,this.z=r*n*l+s*o*a,this.w=r*n*a-s*o*l,this},setFromEulerYXZ:function(e,t,i){var r=Math.cos(e/2),n=Math.cos(t/2),a=Math.cos(i/2),s=Math.sin(e/2),o=Math.sin(t/2),l=Math.sin(i/2);return this.x=s*n*a+r*o*l,this.y=r*o*a-s*n*l,this.z=r*n*l-s*o*a,this.w=r*n*a+s*o*l,this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this.x=e.x*r,this.y=e.y*r,this.z=e.z*r,this.w=Math.cos(i),this},multiply:function(e){return this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e.x,r=e.y,n=e.z,a=e.w,s=t.x,o=t.y,l=t.z,h=t.w;return this.x=i*h+a*s+r*l-n*o,this.y=r*h+a*o+n*s-i*l,this.z=n*h+a*l+i*o-r*s,this.w=a*h-i*s-r*o-n*l,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this.x,r=this.y,n=this.z,a=this.w,s=a*e.w+i*e.x+r*e.y+n*e.z;if(s<0?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,s=-s):this.copy(e),s>=1)return this.w=a,this.x=i,this.y=r,this.z=n,this;var o=Math.acos(s),l=Math.sqrt(1-s*s);if(.001>Math.abs(l))return this.w=.5*(a+this.w),this.x=.5*(i+this.x),this.y=.5*(r+this.y),this.z=.5*(n+this.z),this;var h=Math.sin((1-t)*o)/l,c=Math.sin(t*o)/l;return this.w=a*h+this.w*c,this.x=i*h+this.x*c,this.y=r*h+this.y*c,this.z=n*h+this.z*c,this},setFromUnitVectors:function(e,t){return void 0===d&&(d=new J),(A=e.dot(t)+1)<1e-6?(A=0,Math.abs(e.x)>Math.abs(e.z)?d.set(-e.y,e.x,0):d.set(0,-e.z,e.y)):d.crossVectors(e,t),this.x=d.x,this.y=d.y,this.z=d.z,this.w=A,this.normalize(),this}};var et=new ee({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),ei=new ee({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),er={CardboardV1:new ea({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new ea({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-.0009904169,6183535e-11,-.0000016981803]})};function en(e,t){this.viewer=er.CardboardV2,this.updateDeviceParams(e),this.distortion=new Y(this.viewer.distortionCoefficients);for(var i=0;i<t.length;i++){var r=t[i];er[r.id]=new ea(r)}}function ea(e){this.id=e.id,this.label=e.label,this.fov=e.fov,this.interLensDistance=e.interLensDistance,this.baselineLensDistance=e.baselineLensDistance,this.screenLensDistance=e.screenLensDistance,this.distortionCoefficients=e.distortionCoefficients,this.inverseCoefficients=e.inverseCoefficients}en.prototype.updateDeviceParams=function(e){this.device=this.determineDevice_(e)||this.device},en.prototype.getDevice=function(){return this.device},en.prototype.setViewer=function(e){this.viewer=e,this.distortion=new Y(this.viewer.distortionCoefficients)},en.prototype.determineDevice_=function(e){if(!e)return y()?(console.warn("Using fallback iOS device measurements."),ei):(console.warn("Using fallback Android device measurements."),et);var t=.0254/e.xdpi,i=.0254/e.ydpi;return new ee({widthMeters:t*P(),heightMeters:i*C(),bevelMeters:.001*e.bevelMm})},en.prototype.getDistortedFieldOfViewLeftEye=function(){var e=this.viewer,t=this.device,i=this.distortion,r=e.screenLensDistance,n=(t.widthMeters-e.interLensDistance)/2,a=e.interLensDistance/2,s=e.baselineLensDistance-t.bevelMeters,o=t.heightMeters-s,l=K*Math.atan(i.distort(n/r)),h=K*Math.atan(i.distort(a/r)),c=K*Math.atan(i.distort(s/r)),u=K*Math.atan(i.distort(o/r));return{leftDegrees:Math.min(l,e.fov),rightDegrees:Math.min(h,e.fov),downDegrees:Math.min(c,e.fov),upDegrees:Math.min(u,e.fov)}},en.prototype.getLeftEyeVisibleTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,r=Math.tan(-Z*e.fov),n=Math.tan(Z*e.fov),a=Math.tan(Z*e.fov),s=Math.tan(-Z*e.fov),o=t.widthMeters/4,l=t.heightMeters/2,h=e.baselineLensDistance-t.bevelMeters-l,c=e.interLensDistance/2-o,u=-h,d=e.screenLensDistance,A=i.distort((c-o)/d),p=i.distort((u+l)/d),f=i.distort((c+o)/d),m=i.distort((u-l)/d),g=new Float32Array(4);return g[0]=Math.max(r,A),g[1]=Math.min(n,p),g[2]=Math.min(a,f),g[3]=Math.max(s,m),g},en.prototype.getLeftEyeNoLensTanAngles=function(){var e=this.viewer,t=this.device,i=this.distortion,r=new Float32Array(4),n=i.distortInverse(Math.tan(-Z*e.fov)),a=i.distortInverse(Math.tan(Z*e.fov)),s=i.distortInverse(Math.tan(Z*e.fov)),o=i.distortInverse(Math.tan(-Z*e.fov)),l=t.widthMeters/4,h=t.heightMeters/2,c=e.baselineLensDistance-t.bevelMeters-h,u=e.interLensDistance/2-l,d=-c,A=e.screenLensDistance;return r[0]=Math.max(n,(u-l)/A),r[1]=Math.min(a,(d+h)/A),r[2]=Math.min(s,(u+l)/A),r[3]=Math.max(o,(d-h)/A),r},en.prototype.getLeftEyeVisibleScreenRect=function(e){var t=this.viewer,i=this.device,r=t.screenLensDistance,n=(i.widthMeters-t.interLensDistance)/2,a=t.baselineLensDistance-i.bevelMeters,s=(e[0]*r+n)/i.widthMeters,o=(e[1]*r+a)/i.heightMeters,l=(e[2]*r+n)/i.widthMeters,h=(e[3]*r+a)/i.heightMeters;return{x:s,y:h,width:l-s,height:o-h}},en.prototype.getFieldOfViewLeftEye=function(e){return e?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()},en.prototype.getFieldOfViewRightEye=function(e){var t=this.getFieldOfViewLeftEye(e);return{leftDegrees:t.rightDegrees,rightDegrees:t.leftDegrees,upDegrees:t.upDegrees,downDegrees:t.downDegrees}},en.prototype.getUndistortedFieldOfViewLeftEye=function(){var e=this.getUndistortedParams_();return{leftDegrees:K*Math.atan(e.outerDist),rightDegrees:K*Math.atan(e.innerDist),downDegrees:K*Math.atan(e.bottomDist),upDegrees:K*Math.atan(e.topDist)}},en.prototype.getUndistortedViewportLeftEye=function(){var e=this.getUndistortedParams_(),t=this.viewer,i=this.device,r=t.screenLensDistance,n=i.widthMeters/r,a=i.heightMeters/r,s=i.width/n,o=i.height/a,l=Math.round((e.eyePosX-e.outerDist)*s),h=Math.round((e.eyePosY-e.bottomDist)*o);return{x:l,y:h,width:Math.round((e.eyePosX+e.innerDist)*s)-l,height:Math.round((e.eyePosY+e.topDist)*o)-h}},en.prototype.getUndistortedParams_=function(){var e=this.viewer,t=this.device,i=this.distortion,r=e.screenLensDistance,n=e.interLensDistance/2/r,a=t.widthMeters/r,s=t.heightMeters/r,o=a/2-n,l=(e.baselineLensDistance-t.bevelMeters)/r,h=e.fov,c=i.distortInverse(Math.tan(Z*h));return{outerDist:Math.min(o,c),innerDist:Math.min(n,c),topDist:Math.min(s-l,c),bottomDist:Math.min(l,c),eyePosX:o,eyePosY:l}},en.Viewers=er;var es={format:1,last_updated:"2019-11-09T17:36:14Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X00PD/*"},{ua:"ASUS_X00PD"}],dpi:245,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_X008D/*"},{ua:"ASUS_X008D"}],dpi:282,bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2 XL/*"},{ua:"Pixel 2 XL"}],dpi:537.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3 XL/*"},{ua:"Pixel 3 XL"}],dpi:[558.5,553.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 3/*"},{ua:"Pixel 3"}],dpi:442.4,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel 2/*"},{ua:"Pixel 2"}],dpi:441,bw:3,ac:500},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/BLN-L24/*"},{ua:"HONORBLN-L24"}],dpi:480,bw:4,ac:500},{type:"android",rules:[{mdmh:"Huawei/*/BKL-L09/*"},{ua:"BKL-L09"}],dpi:403,bw:3.47,ac:500},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1001/*"},{ua:"ONE E1001"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1003/*"},{ua:"ONE E1003"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2001/*"},{ua:"ONE A2001"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2003/*"},{ua:"ONE A2003"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3000/*"},{ua:"ONEPLUS A3000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3003/*"},{ua:"ONEPLUS A3003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A3010/*"},{ua:"ONEPLUS A3010"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6000/*"},{ua:"ONEPLUS A6000"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6003/*"},{ua:"ONEPLUS A6003"}],dpi:401,bw:3,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6010/*"},{ua:"ONEPLUS A6010"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A6013/*"},{ua:"ONEPLUS A6013"}],dpi:401,bw:2,ac:500},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955F/*"},{ua:"SM-G955F"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G960F/*"},{ua:"SM-G960F"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9600/*"},{ua:"SM-G9600"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960T/*"},{ua:"SM-G960T"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960N/*"},{ua:"SM-G960N"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960U/*"},{ua:"SM-G960U"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G9608/*"},{ua:"SM-G9608"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960FD/*"},{ua:"SM-G960FD"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G960W/*"},{ua:"SM-G960W"}],dpi:[569.575,571.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G965F/*"},{ua:"SM-G965F"}],dpi:529,bw:2,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/EML-L29/*"},{ua:"EML-L29"}],dpi:428,bw:3.45,ac:500},{type:"android",rules:[{mdmh:"Nokia/*/Nokia 7.1/*"},{ua:"Nokia 7.1"}],dpi:[432,431.9],bw:3,ac:500},{type:"ios",rules:[{res:[1242,2688]}],dpi:458,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G570M/*"},{ua:"SM-G570M"}],dpi:320,bw:3.684,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G970F/*"},{ua:"SM-G970F"}],dpi:438,bw:2.281,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G973F/*"},{ua:"SM-G973F"}],dpi:550,bw:2.002,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G975F/*"},{ua:"SM-G975F"}],dpi:522,bw:2.054,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G977F/*"},{ua:"SM-G977F"}],dpi:505,bw:2.334,ac:500},{type:"ios",rules:[{res:[828,1792]}],dpi:326,bw:5,ac:500}]};function eo(e,t){if(this.dpdb=es,this.recalculateDeviceParams_(),e){this.onDeviceParamsUpdated=t;var i=new XMLHttpRequest,r=this;i.open("GET",e,!0),i.addEventListener("load",function(){r.loading=!1,i.status>=200&&i.status<=299?(r.dpdb=JSON.parse(i.response),r.recalculateDeviceParams_()):console.error("Error loading online DPDB!")}),i.send()}}function el(e){this.xdpi=e.xdpi,this.ydpi=e.ydpi,this.bevelMm=e.bevelMm}function eh(e,t){this.set(e,t)}function ec(e,t){this.kFilter=e,this.isDebug=t,this.currentAccelMeasurement=new eh,this.currentGyroMeasurement=new eh,this.previousGyroMeasurement=new eh,y()?this.filterQ=new $(-1,0,0,1):this.filterQ=new $(1,0,0,1),this.previousFilterQ=new $,this.previousFilterQ.copy(this.filterQ),this.accelQ=new $,this.isOrientationInitialized=!1,this.estimatedGravity=new J,this.measuredGravity=new J,this.gyroIntegralQ=new $}function eu(e,t){this.predictionTimeS=e,this.isDebug=t,this.previousQ=new $,this.previousTimestampS=null,this.deltaQ=new $,this.outQ=new $}function ed(e,t,i,r){this.yawOnly=i,this.accelerometer=new J,this.gyroscope=new J,this.filter=new ec(e,r),this.posePredictor=new eu(t,r),this.isFirefoxAndroid=M(),this.isIOS=y();var n=S();this.isDeviceMotionInRadians=!this.isIOS&&n&&n<66,this.isWithoutDeviceMotion=R()||F(),this.filterToWorldQ=new $,y()?this.filterToWorldQ.setFromAxisAngle(new J(1,0,0),Math.PI/2):this.filterToWorldQ.setFromAxisAngle(new J(1,0,0),-Math.PI/2),this.inverseWorldToScreenQ=new $,this.worldToScreenQ=new $,this.originalPoseAdjustQ=new $,this.originalPoseAdjustQ.setFromAxisAngle(new J(0,0,1),-window.orientation*Math.PI/180),this.setScreenTransform_(),T()&&this.filterToWorldQ.multiply(this.inverseWorldToScreenQ),this.resetQ=new $,this.orientationOut_=new Float32Array(4),this.start()}eo.prototype.getDeviceParams=function(){return this.deviceParams},eo.prototype.recalculateDeviceParams_=function(){var e=this.calcDeviceParams_();e?(this.deviceParams=e,this.onDeviceParamsUpdated&&this.onDeviceParamsUpdated(this.deviceParams)):console.error("Failed to recalculate device parameters.")},eo.prototype.calcDeviceParams_=function(){var e=this.dpdb;if(!e)return console.error("DPDB not available."),null;if(1!=e.format)return console.error("DPDB has unexpected format version."),null;if(!e.devices||!e.devices.length)return console.error("DPDB does not have a devices section."),null;var t=navigator.userAgent||navigator.vendor||window.opera,i=P(),r=C();if(!e.devices)return console.error("DPDB has no devices section."),null;for(var n=0;n<e.devices.length;n++){var a=e.devices[n];if(!a.rules){console.warn("Device["+n+"] has no rules section.");continue}if("ios"!=a.type&&"android"!=a.type){console.warn("Device["+n+"] has invalid type.");continue}if(y()==("ios"==a.type)){for(var s=!1,o=0;o<a.rules.length;o++){var l=a.rules[o];if(this.ruleMatches_(l,t,i,r)){s=!0;break}}if(s)return new el({xdpi:a.dpi[0]||a.dpi,ydpi:a.dpi[1]||a.dpi,bevelMm:a.bw})}}return console.warn("No DPDB device match."),null},eo.prototype.ruleMatches_=function(e,t,i,r){if(!e.ua&&!e.res||(e.ua&&"SM"===e.ua.substring(0,2)&&(e.ua=e.ua.substring(0,7)),e.ua&&0>t.indexOf(e.ua)))return!1;if(e.res){if(!e.res[0]||!e.res[1])return!1;var n=e.res[0],a=e.res[1];if(Math.min(i,r)!=Math.min(n,a)||Math.max(i,r)!=Math.max(n,a))return!1}return!0},eh.prototype.set=function(e,t){this.sample=e,this.timestampS=t},eh.prototype.copy=function(e){this.set(e.sample,e.timestampS)},ec.prototype.addAccelMeasurement=function(e,t){this.currentAccelMeasurement.set(e,t)},ec.prototype.addGyroMeasurement=function(e,t){var i;this.currentGyroMeasurement.set(e,t),isNaN(i=t-this.previousGyroMeasurement.timestampS)||i<=.001||i>1||this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},ec.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),this.isOrientationInitialized=!0;return}var e=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,t=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,e);this.gyroIntegralQ.multiply(t),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(t);var i=new $;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var r=new $;r.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),r.inverse(),this.isDebug&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",K*(r.w>1?(console.warn("getQuaternionAngle: w > 1"),0):2*Math.acos(r.w)),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var n=new $;n.copy(this.filterQ),n.multiply(r),this.filterQ.slerp(n,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},ec.prototype.getOrientation=function(){return this.filterQ},ec.prototype.accelToQuaternion_=function(e){var t=new J;t.copy(e),t.normalize();var i=new $;return i.setFromUnitVectors(new J(0,0,-1),t),i.inverse(),i},ec.prototype.gyroToQuaternionDelta_=function(e,t){var i=new $,r=new J;return r.copy(e),r.normalize(),i.setFromAxisAngle(r,e.length()*t),i},eu.prototype.getPrediction=function(e,t,i){if(!this.previousTimestampS)return this.previousQ.copy(e),this.previousTimestampS=i,e;var r=new J;r.copy(t),r.normalize();var n=t.length();if(n<20*Z)return this.isDebug&&console.log("Moving slowly, at %s deg/s: no prediction",(K*n).toFixed(1)),this.outQ.copy(e),this.previousQ.copy(e),this.outQ;var a=n*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(r,a),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(e),this.previousTimestampS=i,this.outQ},ed.prototype.getPosition=function(){return null},ed.prototype.getOrientation=function(){var e=void 0;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||(t=new $().setFromAxisAngle(new J(0,0,-1),0),i=new $,-90===window.orientation?i.setFromAxisAngle(new J(0,1,0),-(Math.PI/2)):i.setFromAxisAngle(new J(0,1,0),Math.PI/2),t.multiply(i)),this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||((r=new $).setFromAxisAngle(new J(1,0,0),-Math.PI/2),r),e=this._deviceOrientationQ;var t,i,r,n=new $;return n.copy(e),n.multiply(this.deviceOrientationFilterToWorldQ),n.multiply(this.resetQ),n.multiply(this.worldToScreenQ),n.multiplyQuaternions(this.deviceOrientationFixQ,n),this.yawOnly&&(n.x=0,n.z=0,n.normalize()),this.orientationOut_[0]=n.x,this.orientationOut_[1]=n.y,this.orientationOut_[2]=n.z,this.orientationOut_[3]=n.w,this.orientationOut_}var a=this.filter.getOrientation();e=this.posePredictor.getPrediction(a,this.gyroscope,this.previousTimestampS);var n=new $;return n.copy(this.filterToWorldQ),n.multiply(this.resetQ),n.multiply(e),n.multiply(this.worldToScreenQ),this.yawOnly&&(n.x=0,n.z=0,n.normalize()),this.orientationOut_[0]=n.x,this.orientationOut_[1]=n.y,this.orientationOut_[2]=n.z,this.orientationOut_[3]=n.w,this.orientationOut_},ed.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation()),this.resetQ.x=0,this.resetQ.y=0,this.resetQ.z*=-1,this.resetQ.normalize(),T()&&this.resetQ.multiply(this.inverseWorldToScreenQ),this.resetQ.multiply(this.originalPoseAdjustQ)},ed.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new $;var t=e.alpha,i=e.beta,r=e.gamma;t=(t||0)*Math.PI/180,i=(i||0)*Math.PI/180,r=(r||0)*Math.PI/180,this._deviceOrientationQ.setFromEulerYXZ(i,t,-r)},ed.prototype.onDeviceMotion_=function(e){this.updateDeviceMotion_(e)},ed.prototype.updateDeviceMotion_=function(e){var t=e.accelerationIncludingGravity,i=e.rotationRate,r=e.timeStamp/1e3,n=r-this.previousTimestampS;if(n<0){Q("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion"),this.previousTimestampS=r;return}if(n<=.001||n>1){Q("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range."),this.previousTimestampS=r;return}this.accelerometer.set(-t.x,-t.y,-t.z),i&&(_()?this.gyroscope.set(-i.beta,i.alpha,i.gamma):this.gyroscope.set(i.alpha,i.beta,i.gamma),this.isDeviceMotionInRadians||this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addGyroMeasurement(this.gyroscope,r)),this.filter.addAccelMeasurement(this.accelerometer,r),this.previousTimestampS=r},ed.prototype.onOrientationChange_=function(e){this.setScreenTransform_()},ed.prototype.onMessage_=function(e){var t=e.data;t&&t.type&&"devicemotion"===t.type.toLowerCase()&&this.updateDeviceMotion_(t.deviceMotionEvent)},ed.prototype.setScreenTransform_=function(){switch(this.worldToScreenQ.set(0,0,0,1),window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new J(0,0,1),-Math.PI/2);break;case -90:this.worldToScreenQ.setFromAxisAngle(new J(0,0,1),Math.PI/2)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},ed.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this),this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this),this.onMessageCallback_=this.onMessage_.bind(this),this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this),y()&&U()&&window.addEventListener("message",this.onMessageCallback_),window.addEventListener("orientationchange",this.onOrientationChangeCallback_),this.isWithoutDeviceMotion?window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_):window.addEventListener("devicemotion",this.onDeviceMotionCallback_)},ed.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_),window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_),window.removeEventListener("orientationchange",this.onOrientationChangeCallback_),window.removeEventListener("message",this.onMessageCallback_)};var eA=new J(1,0,0),ep=new J(0,0,1),ef=new $;ef.setFromAxisAngle(eA,-Math.PI/2),ef.multiply(new $().setFromAxisAngle(ep,Math.PI/2));var em=function(){function e(t){m(this,e),this.config=t,this.sensor=null,this.fusionSensor=null,this._out=new Float32Array(4),this.api=null,this.errors=[],this._sensorQ=new $,this._outQ=new $,this._onSensorRead=this._onSensorRead.bind(this),this._onSensorError=this._onSensorError.bind(this),this.init()}return g(e,[{key:"init",value:function(){var e=null;try{(e=new RelativeOrientationSensor({frequency:60,referenceFrame:"screen"})).addEventListener("error",this._onSensorError)}catch(e){this.errors.push(e),"SecurityError"===e.name?(console.error("Cannot construct sensors due to the Feature Policy"),console.warn('Attempting to fall back using "devicemotion"; however this will fail in the future without correct permissions.'),this.useDeviceMotion()):"ReferenceError"===e.name?this.useDeviceMotion():console.error(e)}e&&(this.api="sensor",this.sensor=e,this.sensor.addEventListener("reading",this._onSensorRead),this.sensor.start())}},{key:"useDeviceMotion",value:function(){this.api="devicemotion",this.fusionSensor=new ed(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG),this.sensor&&(this.sensor.removeEventListener("reading",this._onSensorRead),this.sensor.removeEventListener("error",this._onSensorError),this.sensor=null)}},{key:"getOrientation",value:function(){if(this.fusionSensor)return this.fusionSensor.getOrientation();if(!this.sensor||!this.sensor.quaternion)return this._out[0]=this._out[1]=this._out[2]=0,this._out[3]=1,this._out;var e=this.sensor.quaternion;this._sensorQ.set(e[0],e[1],e[2],e[3]);var t=this._outQ;return t.copy(ef),t.multiply(this._sensorQ),this.config.YAW_ONLY&&(t.x=t.z=0,t.normalize()),this._out[0]=t.x,this._out[1]=t.y,this._out[2]=t.z,this._out[3]=t.w,this._out}},{key:"_onSensorError",value:function(e){this.errors.push(e.error),"NotAllowedError"===e.error.name?console.error("Permission to access sensor was denied"):"NotReadableError"===e.error.name?console.error("Sensor could not be read"):console.error(e.error),this.useDeviceMotion()}},{key:"_onSensorRead",value:function(){}}]),e}();function eg(){this.loadIcon_();var e=document.createElement("div"),t=e.style;t.position="fixed",t.top=0,t.right=0,t.bottom=0,t.left=0,t.backgroundColor="gray",t.fontFamily="sans-serif",t.zIndex=1e6;var i=document.createElement("img");i.src=this.icon;var t=i.style;t.marginLeft="25%",t.marginTop="25%",t.width="50%",e.appendChild(i);var r=document.createElement("div"),t=r.style;t.textAlign="center",t.fontSize="16px",t.lineHeight="24px",t.margin="24px 25%",t.width="50%",r.innerHTML="Place your phone into your Cardboard viewer.",e.appendChild(r);var n=document.createElement("div"),t=n.style;t.backgroundColor="#CFD8DC",t.position="fixed",t.bottom=0,t.width="100%",t.height="48px",t.padding="14px 24px",t.boxSizing="border-box",t.color="#656A6B",e.appendChild(n);var a=document.createElement("div");a.style.float="left",a.innerHTML="No Cardboard viewer?";var s=document.createElement("a");s.href="https://www.google.com/get/cardboard/get-cardboard/",s.innerHTML="get one",s.target="_blank";var t=s.style;t.float="right",t.fontWeight=600,t.textTransform="uppercase",t.borderLeft="1px solid gray",t.paddingLeft="24px",t.textDecoration="none",t.color="#656A6B",n.appendChild(a),n.appendChild(s),this.overlay=e,this.text=r,this.hide()}eg.prototype.show=function(e){e||this.overlay.parentElement?e&&(this.overlay.parentElement&&this.overlay.parentElement!=e&&this.overlay.parentElement.removeChild(this.overlay),e.appendChild(this.overlay)):document.body.appendChild(this.overlay),this.overlay.style.display="block";var t=this.overlay.querySelector("img").style;T()?(t.width="20%",t.marginLeft="40%",t.marginTop="3%"):(t.width="50%",t.marginLeft="25%",t.marginTop="25%")},eg.prototype.hide=function(){this.overlay.style.display="none"},eg.prototype.showTemporarily=function(e,t){this.show(t),this.timer=setTimeout(this.hide.bind(this),e)},eg.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)},eg.prototype.update=function(){this.disableShowTemporarily(),!T()&&G()?this.show():this.hide()},eg.prototype.loadIcon_=function(){this.icon="data:image/svg+xml,"+encodeURIComponent("<svg width='198' height='240' viewBox='0 0 198 240' xmlns='http://www.w3.org/2000/svg'><g fill='none' fill-rule='evenodd'><path d='M149.625 109.527l6.737 3.891v.886c0 .177.013.36.038.549.01.081.02.162.027.242.14 1.415.974 2.998 2.105 3.999l5.72 5.062.081-.09s4.382-2.53 5.235-3.024l25.97 14.993v54.001c0 .771-.386 1.217-.948 1.217-.233 0-.495-.076-.772-.236l-23.967-13.838-.014.024-27.322 15.775-.85-1.323c-4.731-1.529-9.748-2.74-14.951-3.61a.27.27 0 0 0-.007.024l-5.067 16.961-7.891 4.556-.037-.063v27.59c0 .772-.386 1.217-.948 1.217-.232 0-.495-.076-.772-.236l-42.473-24.522c-.95-.549-1.72-1.877-1.72-2.967v-1.035l-.021.047a5.111 5.111 0 0 0-1.816-.399 5.682 5.682 0 0 0-.546.001 13.724 13.724 0 0 1-1.918-.041c-1.655-.153-3.2-.6-4.404-1.296l-46.576-26.89.005.012-10.278-18.75c-1.001-1.827-.241-4.216 1.698-5.336l56.011-32.345a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.659 3.227 1.853l.005-.003.227.413-.006.004a9.63 9.63 0 0 0 1.477 2.018l.277.27c1.914 1.85 4.468 2.801 7.113 2.801 1.949 0 3.948-.517 5.775-1.572.013 0 7.319-4.219 7.319-4.219a4.194 4.194 0 0 1 2.099-.572c1.326 0 2.572.658 3.226 1.853l3.25 5.928.022-.018 6.785 3.917-.105-.182 46.881-26.965m0-1.635c-.282 0-.563.073-.815.218l-46.169 26.556-5.41-3.124-3.005-5.481c-.913-1.667-2.699-2.702-4.66-2.703-1.011 0-2.02.274-2.917.792a3825 3825 0 0 1-7.275 4.195l-.044.024a9.937 9.937 0 0 1-4.957 1.353c-2.292 0-4.414-.832-5.976-2.342l-.252-.245a7.992 7.992 0 0 1-1.139-1.534 1.379 1.379 0 0 0-.06-.122l-.227-.414a1.718 1.718 0 0 0-.095-.154c-.938-1.574-2.673-2.545-4.571-2.545-1.011 0-2.02.274-2.917.792L3.125 155.502c-2.699 1.559-3.738 4.94-2.314 7.538l10.278 18.75c.177.323.448.563.761.704l46.426 26.804c1.403.81 3.157 1.332 5.072 1.508a15.661 15.661 0 0 0 2.146.046 4.766 4.766 0 0 1 .396 0c.096.004.19.011.283.022.109 1.593 1.159 3.323 2.529 4.114l42.472 24.522c.524.302 1.058.455 1.59.455 1.497 0 2.583-1.2 2.583-2.852v-26.562l7.111-4.105a1.64 1.64 0 0 0 .749-.948l4.658-15.593c4.414.797 8.692 1.848 12.742 3.128l.533.829a1.634 1.634 0 0 0 2.193.531l26.532-15.317L193 192.433c.523.302 1.058.455 1.59.455 1.497 0 2.583-1.199 2.583-2.852v-54.001c0-.584-.312-1.124-.818-1.416l-25.97-14.993a1.633 1.633 0 0 0-1.636.001c-.606.351-2.993 1.73-4.325 2.498l-4.809-4.255c-.819-.725-1.461-1.933-1.561-2.936a7.776 7.776 0 0 0-.033-.294 2.487 2.487 0 0 1-.023-.336v-.886c0-.584-.312-1.123-.817-1.416l-6.739-3.891a1.633 1.633 0 0 0-.817-.219' fill='#455A64'/><path d='M96.027 132.636l46.576 26.891c1.204.695 1.979 1.587 2.242 2.541l-.01.007-81.374 46.982h-.001c-1.654-.152-3.199-.6-4.403-1.295l-46.576-26.891 83.546-48.235' fill='#FAFAFA'/><path d='M63.461 209.174c-.008 0-.015 0-.022-.002-1.693-.156-3.228-.609-4.441-1.309l-46.576-26.89a.118.118 0 0 1 0-.203l83.546-48.235a.117.117 0 0 1 .117 0l46.576 26.891c1.227.708 2.021 1.612 2.296 2.611a.116.116 0 0 1-.042.124l-.021.016-81.375 46.981a.11.11 0 0 1-.058.016zm-50.747-28.303l46.401 26.79c1.178.68 2.671 1.121 4.32 1.276l81.272-46.922c-.279-.907-1.025-1.73-2.163-2.387l-46.517-26.857-83.313 48.1z' fill='#607D8B'/><path d='M148.327 165.471a5.85 5.85 0 0 1-.546.001c-1.894-.083-3.302-1.038-3.145-2.132a2.693 2.693 0 0 0-.072-1.105l-81.103 46.822c.628.058 1.272.073 1.918.042.182-.009.364-.009.546-.001 1.894.083 3.302 1.038 3.145 2.132l79.257-45.759' fill='#FFF'/><path d='M69.07 211.347a.118.118 0 0 1-.115-.134c.045-.317-.057-.637-.297-.925-.505-.61-1.555-1.022-2.738-1.074a5.966 5.966 0 0 0-.535.001 14.03 14.03 0 0 1-1.935-.041.117.117 0 0 1-.103-.092.116.116 0 0 1 .055-.126l81.104-46.822a.117.117 0 0 1 .171.07c.104.381.129.768.074 1.153-.045.316.057.637.296.925.506.61 1.555 1.021 2.739 1.073.178.008.357.008.535-.001a.117.117 0 0 1 .064.218l-79.256 45.759a.114.114 0 0 1-.059.016zm-3.405-2.372c.089 0 .177.002.265.006 1.266.056 2.353.488 2.908 1.158.227.274.35.575.36.882l78.685-45.429c-.036 0-.072-.001-.107-.003-1.267-.056-2.354-.489-2.909-1.158-.282-.34-.402-.724-.347-1.107a2.604 2.604 0 0 0-.032-.91L63.846 208.97a13.91 13.91 0 0 0 1.528.012c.097-.005.194-.007.291-.007z' fill='#607D8B'/><path d='M2.208 162.134c-1.001-1.827-.241-4.217 1.698-5.337l56.011-32.344c1.939-1.12 4.324-.546 5.326 1.281l.232.41a9.344 9.344 0 0 0 1.47 2.021l.278.27c3.325 3.214 8.583 3.716 12.888 1.23l7.319-4.22c1.94-1.119 4.324-.546 5.325 1.282l3.25 5.928-83.519 48.229-10.278-18.75z' fill='#FAFAFA'/><path d='M12.486 181.001a.112.112 0 0 1-.031-.005.114.114 0 0 1-.071-.056L2.106 162.19c-1.031-1.88-.249-4.345 1.742-5.494l56.01-32.344a4.328 4.328 0 0 1 2.158-.588c1.415 0 2.65.702 3.311 1.882.01.008.018.017.024.028l.227.414a.122.122 0 0 1 .013.038 9.508 9.508 0 0 0 1.439 1.959l.275.266c1.846 1.786 4.344 2.769 7.031 2.769 1.977 0 3.954-.538 5.717-1.557a.148.148 0 0 1 .035-.013l7.284-4.206a4.321 4.321 0 0 1 2.157-.588c1.427 0 2.672.716 3.329 1.914l3.249 5.929a.116.116 0 0 1-.044.157l-83.518 48.229a.116.116 0 0 1-.059.016zm49.53-57.004c-.704 0-1.41.193-2.041.557l-56.01 32.345c-1.882 1.086-2.624 3.409-1.655 5.179l10.221 18.645 83.317-48.112-3.195-5.829c-.615-1.122-1.783-1.792-3.124-1.792a4.08 4.08 0 0 0-2.04.557l-7.317 4.225a.148.148 0 0 1-.035.013 11.7 11.7 0 0 1-5.801 1.569c-2.748 0-5.303-1.007-7.194-2.835l-.278-.27a9.716 9.716 0 0 1-1.497-2.046.096.096 0 0 1-.013-.037l-.191-.347a.11.11 0 0 1-.023-.029c-.615-1.123-1.783-1.793-3.124-1.793z' fill='#607D8B'/><path d='M42.434 155.808c-2.51-.001-4.697-1.258-5.852-3.365-1.811-3.304-.438-7.634 3.059-9.654l12.291-7.098a7.599 7.599 0 0 1 3.789-1.033c2.51 0 4.697 1.258 5.852 3.365 1.811 3.304.439 7.634-3.059 9.654l-12.291 7.098a7.606 7.606 0 0 1-3.789 1.033zm13.287-20.683a7.128 7.128 0 0 0-3.555.971l-12.291 7.098c-3.279 1.893-4.573 5.942-2.883 9.024 1.071 1.955 3.106 3.122 5.442 3.122a7.13 7.13 0 0 0 3.556-.97l12.291-7.098c3.279-1.893 4.572-5.942 2.883-9.024-1.072-1.955-3.106-3.123-5.443-3.123z' fill='#607D8B'/><path d='M149.588 109.407l6.737 3.89v.887c0 .176.013.36.037.549.011.081.02.161.028.242.14 1.415.973 2.998 2.105 3.999l7.396 6.545c.177.156.358.295.541.415 1.579 1.04 2.95.466 3.062-1.282.049-.784.057-1.595.023-2.429l-.003-.16v-1.151l25.987 15.003v54c0 1.09-.77 1.53-1.72.982l-42.473-24.523c-.95-.548-1.72-1.877-1.72-2.966v-34.033' fill='#FAFAFA'/><path d='M194.553 191.25c-.257 0-.54-.085-.831-.253l-42.472-24.521c-.981-.567-1.779-1.943-1.779-3.068v-34.033h.234v34.033c0 1.051.745 2.336 1.661 2.866l42.473 24.521c.424.245.816.288 1.103.122.285-.164.442-.52.442-1.002v-53.933l-25.753-14.868.003 1.106c.034.832.026 1.654-.024 2.439-.054.844-.396 1.464-.963 1.746-.619.309-1.45.173-2.28-.373a5.023 5.023 0 0 1-.553-.426l-7.397-6.544c-1.158-1.026-1.999-2.625-2.143-4.076a9.624 9.624 0 0 0-.027-.238 4.241 4.241 0 0 1-.038-.564v-.82l-6.68-3.856.117-.202 6.738 3.89.058.034v.954c0 .171.012.351.036.533.011.083.021.165.029.246.138 1.395.948 2.935 2.065 3.923l7.397 6.545c.173.153.35.289.527.406.758.499 1.504.63 2.047.359.49-.243.786-.795.834-1.551.05-.778.057-1.591.024-2.417l-.004-.163v-1.355l.175.1 25.987 15.004.059.033v54.068c0 .569-.198.996-.559 1.204a1.002 1.002 0 0 1-.506.131' fill='#607D8B'/><path d='M145.685 163.161l24.115 13.922-25.978 14.998-1.462-.307c-6.534-2.17-13.628-3.728-21.019-4.616-4.365-.524-8.663 1.096-9.598 3.62a2.746 2.746 0 0 0-.011 1.928c1.538 4.267 4.236 8.363 7.995 12.135l.532.845-25.977 14.997-24.115-13.922 75.518-43.6' fill='#FFF'/><path d='M94.282 220.818l-.059-.033-24.29-14.024.175-.101 75.577-43.634.058.033 24.29 14.024-26.191 15.122-.045-.01-1.461-.307c-6.549-2.174-13.613-3.725-21.009-4.614a13.744 13.744 0 0 0-1.638-.097c-3.758 0-7.054 1.531-7.837 3.642a2.62 2.62 0 0 0-.01 1.848c1.535 4.258 4.216 8.326 7.968 12.091l.016.021.526.835.006.01.064.102-.105.061-25.977 14.998-.058.033zm-23.881-14.057l23.881 13.788 24.802-14.32c.546-.315.846-.489 1.017-.575l-.466-.74c-3.771-3.787-6.467-7.881-8.013-12.168a2.851 2.851 0 0 1 .011-2.008c.815-2.199 4.203-3.795 8.056-3.795.557 0 1.117.033 1.666.099 7.412.891 14.491 2.445 21.041 4.621.836.175 1.215.254 1.39.304l25.78-14.884-23.881-13.788-75.284 43.466z' fill='#607D8B'/><path d='M167.23 125.979v50.871l-27.321 15.773-6.461-14.167c-.91-1.996-3.428-1.738-5.624.574a10.238 10.238 0 0 0-2.33 4.018l-6.46 21.628-27.322 15.774v-50.871l75.518-43.6' fill='#FFF'/><path d='M91.712 220.567a.127.127 0 0 1-.059-.016.118.118 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.519-43.6a.117.117 0 0 1 .175.101v50.871c0 .041-.023.08-.059.1l-27.321 15.775a.118.118 0 0 1-.094.01.12.12 0 0 1-.071-.063l-6.46-14.168c-.375-.822-1.062-1.275-1.934-1.275-1.089 0-2.364.686-3.5 1.881a10.206 10.206 0 0 0-2.302 3.972l-6.46 21.627a.118.118 0 0 1-.054.068L91.77 220.551a.12.12 0 0 1-.058.016zm.117-50.92v50.601l27.106-15.65 6.447-21.583a10.286 10.286 0 0 1 2.357-4.065c1.18-1.242 2.517-1.954 3.669-1.954.969 0 1.731.501 2.146 1.411l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M168.543 126.213v50.87l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.624.574a10.248 10.248 0 0 0-2.33 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6' fill='#FFF'/><path d='M93.025 220.8a.123.123 0 0 1-.059-.015.12.12 0 0 1-.058-.101v-50.871c0-.042.023-.08.058-.101l75.518-43.6a.112.112 0 0 1 .117 0c.036.02.059.059.059.1v50.871a.116.116 0 0 1-.059.101l-27.321 15.774a.111.111 0 0 1-.094.01.115.115 0 0 1-.071-.062l-6.46-14.168c-.375-.823-1.062-1.275-1.935-1.275-1.088 0-2.363.685-3.499 1.881a10.19 10.19 0 0 0-2.302 3.971l-6.461 21.628a.108.108 0 0 1-.053.067l-27.322 15.775a.12.12 0 0 1-.058.015zm.117-50.919v50.6l27.106-15.649 6.447-21.584a10.293 10.293 0 0 1 2.357-4.065c1.179-1.241 2.516-1.954 3.668-1.954.969 0 1.732.502 2.147 1.412l6.407 14.051 27.152-15.676v-50.601l-75.284 43.466z' fill='#607D8B'/><path d='M169.8 177.083l-27.322 15.774-6.46-14.168c-.91-1.995-3.428-1.738-5.625.574a10.246 10.246 0 0 0-2.329 4.019l-6.461 21.627-27.321 15.774v-50.87l75.518-43.6v50.87z' fill='#FAFAFA'/><path d='M94.282 220.917a.234.234 0 0 1-.234-.233v-50.871c0-.083.045-.161.117-.202l75.518-43.601a.234.234 0 1 1 .35.202v50.871a.233.233 0 0 1-.116.202l-27.322 15.775a.232.232 0 0 1-.329-.106l-6.461-14.168c-.36-.789-.992-1.206-1.828-1.206-1.056 0-2.301.672-3.415 1.844a10.099 10.099 0 0 0-2.275 3.924l-6.46 21.628a.235.235 0 0 1-.107.136l-27.322 15.774a.23.23 0 0 1-.116.031zm.233-50.969v50.331l26.891-15.525 6.434-21.539a10.41 10.41 0 0 1 2.384-4.112c1.201-1.265 2.569-1.991 3.753-1.991 1.018 0 1.818.526 2.253 1.48l6.354 13.934 26.982-15.578v-50.331l-75.051 43.331z' fill='#607D8B'/><path d='M109.894 199.943c-1.774 0-3.241-.725-4.244-2.12a.224.224 0 0 1 .023-.294.233.233 0 0 1 .301-.023c.78.547 1.705.827 2.75.827 1.323 0 2.754-.439 4.256-1.306 5.311-3.067 9.631-10.518 9.631-16.611 0-1.927-.442-3.56-1.278-4.724a.232.232 0 0 1 .323-.327c1.671 1.172 2.591 3.381 2.591 6.219 0 6.242-4.426 13.863-9.865 17.003-1.574.908-3.084 1.356-4.488 1.356zm-2.969-1.542c.813.651 1.82.877 2.968.877h.001c1.321 0 2.753-.327 4.254-1.194 5.311-3.067 9.632-10.463 9.632-16.556 0-1.979-.463-3.599-1.326-4.761.411 1.035.625 2.275.625 3.635 0 6.243-4.426 13.883-9.865 17.023-1.574.909-3.084 1.317-4.49 1.317-.641 0-1.243-.149-1.799-.341z' fill='#607D8B'/><path d='M113.097 197.23c5.384-3.108 9.748-10.636 9.748-16.814 0-2.051-.483-3.692-1.323-4.86-1.784-1.252-4.374-1.194-7.257.47-5.384 3.108-9.748 10.636-9.748 16.814 0 2.051.483 3.692 1.323 4.86 1.784 1.252 4.374 1.194 7.257-.47' fill='#FAFAFA'/><path d='M108.724 198.614c-1.142 0-2.158-.213-3.019-.817-.021-.014-.04.014-.055-.007-.894-1.244-1.367-2.948-1.367-4.973 0-6.242 4.426-13.864 9.865-17.005 1.574-.908 3.084-1.363 4.49-1.363 1.142 0 2.158.309 3.018.913a.23.23 0 0 1 .056.056c.894 1.244 1.367 2.972 1.367 4.997 0 6.243-4.426 13.783-9.865 16.923-1.574.909-3.084 1.276-4.49 1.276zm-2.718-1.109c.774.532 1.688.776 2.718.776 1.323 0 2.754-.413 4.256-1.28 5.311-3.066 9.631-10.505 9.631-16.598 0-1.909-.434-3.523-1.255-4.685-.774-.533-1.688-.799-2.718-.799-1.323 0-2.755.441-4.256 1.308-5.311 3.066-9.631 10.506-9.631 16.599 0 1.909.434 3.517 1.255 4.679z' fill='#607D8B'/><path d='M149.318 114.262l-9.984 8.878 15.893 11.031 5.589-6.112-11.498-13.797' fill='#FAFAFA'/><path d='M169.676 120.84l-9.748 5.627c-3.642 2.103-9.528 2.113-13.147.024-3.62-2.089-3.601-5.488.041-7.591l9.495-5.608-6.729-3.885-81.836 47.071 45.923 26.514 3.081-1.779c.631-.365.869-.898.618-1.39-2.357-4.632-2.593-9.546-.683-14.262 5.638-13.92 24.509-24.815 48.618-28.07 8.169-1.103 16.68-.967 24.704.394.852.145 1.776.008 2.407-.357l3.081-1.778-25.825-14.91' fill='#FAFAFA'/><path d='M113.675 183.459a.47.47 0 0 1-.233-.062l-45.924-26.515a.468.468 0 0 1 .001-.809l81.836-47.071a.467.467 0 0 1 .466 0l6.729 3.885a.467.467 0 0 1-.467.809l-6.496-3.75-80.9 46.533 44.988 25.973 2.848-1.644c.192-.111.62-.409.435-.773-2.416-4.748-2.658-9.814-.7-14.65 2.806-6.927 8.885-13.242 17.582-18.263 8.657-4.998 19.518-8.489 31.407-10.094 8.198-1.107 16.79-.97 24.844.397.739.125 1.561.007 2.095-.301l2.381-1.374-25.125-14.506a.467.467 0 0 1 .467-.809l25.825 14.91a.467.467 0 0 1 0 .809l-3.081 1.779c-.721.417-1.763.575-2.718.413-7.963-1.351-16.457-1.486-24.563-.392-11.77 1.589-22.512 5.039-31.065 9.977-8.514 4.916-14.456 11.073-17.183 17.805-1.854 4.578-1.623 9.376.666 13.875.37.725.055 1.513-.8 2.006l-3.081 1.78a.476.476 0 0 1-.234.062' fill='#455A64'/><path d='M153.316 128.279c-2.413 0-4.821-.528-6.652-1.586-1.818-1.049-2.82-2.461-2.82-3.975 0-1.527 1.016-2.955 2.861-4.02l9.493-5.607a.233.233 0 1 1 .238.402l-9.496 5.609c-1.696.979-2.628 2.263-2.628 3.616 0 1.34.918 2.608 2.585 3.571 3.549 2.049 9.343 2.038 12.914-.024l9.748-5.628a.234.234 0 0 1 .234.405l-9.748 5.628c-1.858 1.072-4.296 1.609-6.729 1.609' fill='#607D8B'/><path d='M113.675 182.992l-45.913-26.508M113.675 183.342a.346.346 0 0 1-.175-.047l-45.913-26.508a.35.35 0 1 1 .35-.607l45.913 26.508a.35.35 0 0 1-.175.654' fill='#455A64'/><path d='M67.762 156.484v54.001c0 1.09.77 2.418 1.72 2.967l42.473 24.521c.95.549 1.72.11 1.72-.98v-54.001' fill='#FAFAFA'/><path d='M112.727 238.561c-.297 0-.62-.095-.947-.285l-42.473-24.521c-1.063-.613-1.895-2.05-1.895-3.27v-54.001a.35.35 0 1 1 .701 0v54.001c0 .96.707 2.18 1.544 2.663l42.473 24.522c.344.198.661.243.87.122.206-.119.325-.411.325-.799v-54.001a.35.35 0 1 1 .7 0v54.001c0 .655-.239 1.154-.675 1.406a1.235 1.235 0 0 1-.623.162' fill='#455A64'/><path d='M112.86 147.512h-.001c-2.318 0-4.499-.522-6.142-1.471-1.705-.984-2.643-2.315-2.643-3.749 0-1.445.952-2.791 2.68-3.788l12.041-6.953c1.668-.962 3.874-1.493 6.212-1.493 2.318 0 4.499.523 6.143 1.472 1.704.984 2.643 2.315 2.643 3.748 0 1.446-.952 2.791-2.68 3.789l-12.042 6.952c-1.668.963-3.874 1.493-6.211 1.493zm12.147-16.753c-2.217 0-4.298.497-5.861 1.399l-12.042 6.952c-1.502.868-2.33 1.998-2.33 3.182 0 1.173.815 2.289 2.293 3.142 1.538.889 3.596 1.378 5.792 1.378h.001c2.216 0 4.298-.497 5.861-1.399l12.041-6.953c1.502-.867 2.33-1.997 2.33-3.182 0-1.172-.814-2.288-2.292-3.142-1.539-.888-3.596-1.377-5.793-1.377z' fill='#607D8B'/><path d='M165.63 123.219l-5.734 3.311c-3.167 1.828-8.286 1.837-11.433.02-3.147-1.817-3.131-4.772.036-6.601l5.734-3.31 11.397 6.58' fill='#FAFAFA'/><path d='M154.233 117.448l9.995 5.771-4.682 2.704c-1.434.827-3.352 1.283-5.399 1.283-2.029 0-3.923-.449-5.333-1.263-1.29-.744-2-1.694-2-2.674 0-.991.723-1.955 2.036-2.713l5.383-3.108m0-.809l-5.734 3.31c-3.167 1.829-3.183 4.784-.036 6.601 1.568.905 3.623 1.357 5.684 1.357 2.077 0 4.159-.46 5.749-1.377l5.734-3.311-11.397-6.58M145.445 179.667c-1.773 0-3.241-.85-4.243-2.245-.067-.092-.057-.275.023-.356.08-.081.207-.12.3-.055.781.548 1.706.812 2.751.811 1.322 0 2.754-.446 4.256-1.313 5.31-3.066 9.631-10.522 9.631-16.615 0-1.927-.442-3.562-1.279-4.726a.235.235 0 0 1 .024-.301.232.232 0 0 1 .3-.027c1.67 1.172 2.59 3.38 2.59 6.219 0 6.242-4.425 13.987-9.865 17.127-1.573.908-3.083 1.481-4.488 1.481zM142.476 178c.814.651 1.82 1.002 2.969 1.002 1.322 0 2.753-.452 4.255-1.32 5.31-3.065 9.631-10.523 9.631-16.617 0-1.98-.463-3.63-1.325-4.793.411 1.035.624 2.26.624 3.62 0 6.242-4.425 13.875-9.865 17.015-1.573.909-3.084 1.376-4.489 1.376a5.49 5.49 0 0 1-1.8-.283z' fill='#607D8B'/><path d='M148.648 176.704c5.384-3.108 9.748-10.636 9.748-16.813 0-2.052-.483-3.693-1.322-4.861-1.785-1.252-4.375-1.194-7.258.471-5.383 3.108-9.748 10.636-9.748 16.813 0 2.051.484 3.692 1.323 4.86 1.785 1.253 4.374 1.195 7.257-.47' fill='#FAFAFA'/><path d='M144.276 178.276c-1.143 0-2.158-.307-3.019-.911a.217.217 0 0 1-.055-.054c-.895-1.244-1.367-2.972-1.367-4.997 0-6.241 4.425-13.875 9.865-17.016 1.573-.908 3.084-1.369 4.489-1.369 1.143 0 2.158.307 3.019.91a.24.24 0 0 1 .055.055c.894 1.244 1.367 2.971 1.367 4.997 0 6.241-4.425 13.875-9.865 17.016-1.573.908-3.084 1.369-4.489 1.369zm-2.718-1.172c.773.533 1.687.901 2.718.901 1.322 0 2.754-.538 4.256-1.405 5.31-3.066 9.631-10.567 9.631-16.661 0-1.908-.434-3.554-1.256-4.716-.774-.532-1.688-.814-2.718-.814-1.322 0-2.754.433-4.256 1.3-5.31 3.066-9.631 10.564-9.631 16.657 0 1.91.434 3.576 1.256 4.738z' fill='#607D8B'/><path d='M150.72 172.361l-.363-.295a24.105 24.105 0 0 0 2.148-3.128 24.05 24.05 0 0 0 1.977-4.375l.443.149a24.54 24.54 0 0 1-2.015 4.46 24.61 24.61 0 0 1-2.19 3.189M115.917 191.514l-.363-.294a24.174 24.174 0 0 0 2.148-3.128 24.038 24.038 0 0 0 1.976-4.375l.443.148a24.48 24.48 0 0 1-2.015 4.461 24.662 24.662 0 0 1-2.189 3.188M114 237.476V182.584 237.476' fill='#607D8B'/><g><path d='M81.822 37.474c.017-.135-.075-.28-.267-.392-.327-.188-.826-.21-1.109-.045l-6.012 3.471c-.131.076-.194.178-.191.285.002.132.002.461.002.578v.043l-.007.128-6.591 3.779c-.001 0-2.077 1.046-2.787 5.192 0 0-.912 6.961-.898 19.745.015 12.57.606 17.07 1.167 21.351.22 1.684 3.001 2.125 3.001 2.125.331.04.698-.027 1.08-.248l75.273-43.551c1.808-1.069 2.667-3.719 3.056-6.284 1.213-7.99 1.675-32.978-.275-39.878-.196-.693-.51-1.083-.868-1.282l-2.086-.79c-.727.028-1.416.467-1.534.535L82.032 37.072l-.21.402' fill='#FFF'/><path d='M144.311 1.701l2.085.79c.358.199.672.589.868 1.282 1.949 6.9 1.487 31.887.275 39.878-.39 2.565-1.249 5.215-3.056 6.284L69.21 93.486a1.78 1.78 0 0 1-.896.258l-.183-.011c0 .001-2.782-.44-3.003-2.124-.56-4.282-1.151-8.781-1.165-21.351-.015-12.784.897-19.745.897-19.745.71-4.146 2.787-5.192 2.787-5.192l6.591-3.779.007-.128v-.043c0-.117 0-.446-.002-.578-.003-.107.059-.21.191-.285l6.012-3.472a.98.98 0 0 1 .481-.11c.218 0 .449.053.627.156.193.112.285.258.268.392l.211-.402 60.744-34.836c.117-.068.806-.507 1.534-.535m0-.997l-.039.001c-.618.023-1.283.244-1.974.656l-.021.012-60.519 34.706a2.358 2.358 0 0 0-.831-.15c-.365 0-.704.084-.98.244l-6.012 3.471c-.442.255-.699.69-.689 1.166l.001.15-6.08 3.487c-.373.199-2.542 1.531-3.29 5.898l-.006.039c-.009.07-.92 7.173-.906 19.875.014 12.62.603 17.116 1.172 21.465l.002.015c.308 2.355 3.475 2.923 3.836 2.98l.034.004c.101.013.204.019.305.019a2.77 2.77 0 0 0 1.396-.392l75.273-43.552c1.811-1.071 2.999-3.423 3.542-6.997 1.186-7.814 1.734-33.096-.301-40.299-.253-.893-.704-1.527-1.343-1.882l-.132-.062-2.085-.789a.973.973 0 0 0-.353-.065' fill='#455A64'/><path d='M128.267 11.565l1.495.434-56.339 32.326' fill='#FFF'/><path d='M74.202 90.545a.5.5 0 0 1-.25-.931l18.437-10.645a.499.499 0 1 1 .499.864L74.451 90.478l-.249.067M75.764 42.654l-.108-.062.046-.171 5.135-2.964.17.045-.045.171-5.135 2.964-.063.017M70.52 90.375V46.421l.063-.036L137.84 7.554v43.954l-.062.036L70.52 90.375zm.25-43.811v43.38l66.821-38.579V7.985L70.77 46.564z' fill='#607D8B'/><path d='M86.986 83.182c-.23.149-.612.384-.849.523l-11.505 6.701c-.237.139-.206.252.068.252h.565c.275 0 .693-.113.93-.252L87.7 83.705c.237-.139.428-.253.425-.256a11.29 11.29 0 0 1-.006-.503c0-.274-.188-.377-.418-.227l-.715.463' fill='#607D8B'/><path d='M75.266 90.782H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.236-.138.615-.371.844-.519l.715-.464a.488.488 0 0 1 .266-.089c.172 0 .345.13.345.421 0 .214.001.363.003.437l.006.004-.004.069c-.003.075-.003.075-.486.356l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.108.866-.234l11.505-6.702c.168-.098.294-.173.361-.214-.004-.084-.004-.218-.004-.437l-.095-.171-.131.049-.714.463c-.232.15-.616.386-.854.525l-11.505 6.702-.029.018z' fill='#607D8B'/><path d='M75.266 89.871H74.7c-.2 0-.316-.056-.346-.166-.03-.11.043-.217.215-.317l11.505-6.702c.258-.151.694-.268.993-.268h.565c.2 0 .316.056.346.166.03.11-.043.217-.215.317l-11.505 6.702a2.282 2.282 0 0 1-.992.268zm-.6-.25l.034.001h.566c.252 0 .649-.107.866-.234l11.505-6.702.03-.018-.035-.001h-.565c-.252 0-.649.108-.867.234l-11.505 6.702-.029.018zM74.37 90.801v-1.247 1.247' fill='#607D8B'/><path d='M68.13 93.901c-.751-.093-1.314-.737-1.439-1.376-.831-4.238-1.151-8.782-1.165-21.352-.015-12.784.897-19.745.897-19.745.711-4.146 2.787-5.192 2.787-5.192l74.859-43.219c.223-.129 2.487-1.584 3.195.923 1.95 6.9 1.488 31.887.275 39.878-.389 2.565-1.248 5.215-3.056 6.283L69.21 93.653c-.382.221-.749.288-1.08.248 0 0-2.781-.441-3.001-2.125-.561-4.281-1.152-8.781-1.167-21.351-.014-12.784.898-19.745.898-19.745.71-4.146 2.787-5.191 2.787-5.191l6.598-3.81.871-.119 6.599-3.83.046-.461L68.13 93.901' fill='#FAFAFA'/><path d='M68.317 94.161l-.215-.013h-.001l-.244-.047c-.719-.156-2.772-.736-2.976-2.292-.568-4.34-1.154-8.813-1.168-21.384-.014-12.654.891-19.707.9-19.777.725-4.231 2.832-5.338 2.922-5.382l6.628-3.827.87-.119 6.446-3.742.034-.334a.248.248 0 0 1 .273-.223.248.248 0 0 1 .223.272l-.059.589-6.752 3.919-.87.118-6.556 3.785c-.031.016-1.99 1.068-2.666 5.018-.007.06-.908 7.086-.894 19.702.014 12.539.597 16.996 1.161 21.305.091.691.689 1.154 1.309 1.452a1.95 1.95 0 0 1-.236-.609c-.781-3.984-1.155-8.202-1.17-21.399-.014-12.653.891-19.707.9-19.777.725-4.231 2.832-5.337 2.922-5.382-.004.001 74.444-42.98 74.846-43.212l.028-.017c.904-.538 1.72-.688 2.36-.433.555.221.949.733 1.172 1.52 2.014 7.128 1.46 32.219.281 39.983-.507 3.341-1.575 5.515-3.175 6.462L69.335 93.869a2.023 2.023 0 0 1-1.018.292zm-.147-.507c.293.036.604-.037.915-.217l75.273-43.551c1.823-1.078 2.602-3.915 2.934-6.106 1.174-7.731 1.731-32.695-.268-39.772-.178-.631-.473-1.032-.876-1.192-.484-.193-1.166-.052-1.921.397l-.034.021-74.858 43.218c-.031.017-1.989 1.069-2.666 5.019-.007.059-.908 7.085-.894 19.702.015 13.155.386 17.351 1.161 21.303.09.461.476.983 1.037 1.139.114.025.185.037.196.039h.001z' fill='#455A64'/><path d='M69.317 68.982c.489-.281.885-.056.885.505 0 .56-.396 1.243-.885 1.525-.488.282-.884.057-.884-.504 0-.56.396-1.243.884-1.526' fill='#FFF'/><path d='M68.92 71.133c-.289 0-.487-.228-.487-.625 0-.56.396-1.243.884-1.526a.812.812 0 0 1 .397-.121c.289 0 .488.229.488.626 0 .56-.396 1.243-.885 1.525a.812.812 0 0 1-.397.121m.794-2.459a.976.976 0 0 0-.49.147c-.548.317-.978 1.058-.978 1.687 0 .486.271.812.674.812a.985.985 0 0 0 .491-.146c.548-.317.978-1.057.978-1.687 0-.486-.272-.813-.675-.813' fill='#8097A2'/><path d='M68.92 70.947c-.271 0-.299-.307-.299-.439 0-.491.361-1.116.79-1.363a.632.632 0 0 1 .303-.096c.272 0 .301.306.301.438 0 .491-.363 1.116-.791 1.364a.629.629 0 0 1-.304.096m.794-2.086a.812.812 0 0 0-.397.121c-.488.283-.884.966-.884 1.526 0 .397.198.625.487.625a.812.812 0 0 0 .397-.121c.489-.282.885-.965.885-1.525 0-.397-.199-.626-.488-.626' fill='#8097A2'/><path d='M69.444 85.35c.264-.152.477-.031.477.272 0 .303-.213.67-.477.822-.263.153-.477.031-.477-.271 0-.302.214-.671.477-.823' fill='#FFF'/><path d='M69.23 86.51c-.156 0-.263-.123-.263-.337 0-.302.214-.671.477-.823a.431.431 0 0 1 .214-.066c.156 0 .263.124.263.338 0 .303-.213.67-.477.822a.431.431 0 0 1-.214.066m.428-1.412c-.1 0-.203.029-.307.09-.32.185-.57.618-.57.985 0 .309.185.524.449.524a.63.63 0 0 0 .308-.09c.32-.185.57-.618.57-.985 0-.309-.185-.524-.45-.524' fill='#8097A2'/><path d='M69.23 86.322l-.076-.149c0-.235.179-.544.384-.661l.12-.041.076.151c0 .234-.179.542-.383.66l-.121.04m.428-1.038a.431.431 0 0 0-.214.066c-.263.152-.477.521-.477.823 0 .214.107.337.263.337a.431.431 0 0 0 .214-.066c.264-.152.477-.519.477-.822 0-.214-.107-.338-.263-.338' fill='#8097A2'/><path d='M139.278 7.769v43.667L72.208 90.16V46.493l67.07-38.724' fill='#455A64'/><path d='M72.083 90.375V46.421l.063-.036 67.257-38.831v43.954l-.062.036-67.258 38.831zm.25-43.811v43.38l66.821-38.579V7.985L72.333 46.564z' fill='#607D8B'/></g><path d='M125.737 88.647l-7.639 3.334V84l-11.459 4.713v8.269L99 100.315l13.369 3.646 13.368-15.314' fill='#455A64'/></g></svg>")};var ev="WEBVR_CARDBOARD_VIEWER";function ew(e){try{this.selectedKey=localStorage.getItem(ev)}catch(e){console.error("Failed to load viewer profile: %s",e)}this.selectedKey||(this.selectedKey=e||"CardboardV1"),this.dialog=this.createDialog_(en.Viewers),this.root=null,this.onChangeCallbacks_=[]}ew.prototype.show=function(e){this.root=e,e.appendChild(this.dialog),this.dialog.querySelector("#"+this.selectedKey).checked=!0,this.dialog.style.display="block"},ew.prototype.hide=function(){this.root&&this.root.contains(this.dialog)&&this.root.removeChild(this.dialog),this.dialog.style.display="none"},ew.prototype.getCurrentViewer=function(){return en.Viewers[this.selectedKey]},ew.prototype.getSelectedKey_=function(){var e=this.dialog.querySelector("input[name=field]:checked");return e?e.id:null},ew.prototype.onChange=function(e){this.onChangeCallbacks_.push(e)},ew.prototype.fireOnChange_=function(e){for(var t=0;t<this.onChangeCallbacks_.length;t++)this.onChangeCallbacks_[t](e)},ew.prototype.onSave_=function(){if(this.selectedKey=this.getSelectedKey_(),!this.selectedKey||!en.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(en.Viewers[this.selectedKey]);try{localStorage.setItem(ev,this.selectedKey)}catch(e){console.error("Failed to save viewer profile: %s",e)}this.hide()},ew.prototype.createDialog_=function(e){var t=document.createElement("div");t.classList.add("webvr-polyfill-viewer-selector"),t.style.display="none";var i=document.createElement("div"),r=i.style;r.position="fixed",r.left=0,r.top=0,r.width="100%",r.height="100%",r.background="rgba(0, 0, 0, 0.3)",i.addEventListener("click",this.hide.bind(this));var n=document.createElement("div"),r=n.style;for(var a in r.boxSizing="border-box",r.position="fixed",r.top="24px",r.left="50%",r.marginLeft="-140px",r.width="280px",r.padding="24px",r.overflow="hidden",r.background="#fafafa",r.fontFamily="'Roboto', sans-serif",r.boxShadow="0px 5px 20px #666",n.appendChild(this.createH1_("Select your viewer")),e)n.appendChild(this.createChoice_(a,e[a].label));return n.appendChild(this.createButton_("Save",this.onSave_.bind(this))),t.appendChild(i),t.appendChild(n),t},ew.prototype.createH1_=function(e){var t=document.createElement("h1"),i=t.style;return i.color="black",i.fontSize="20px",i.fontWeight="bold",i.marginTop=0,i.marginBottom="24px",t.innerHTML=e,t},ew.prototype.createChoice_=function(e,t){var i=document.createElement("div");i.style.marginTop="8px",i.style.color="black";var r=document.createElement("input");r.style.fontSize="30px",r.setAttribute("id",e),r.setAttribute("type","radio"),r.setAttribute("value",e),r.setAttribute("name","field");var n=document.createElement("label");return n.style.marginLeft="4px",n.setAttribute("for",e),n.innerHTML=t,i.appendChild(r),i.appendChild(n),i},ew.prototype.createButton_=function(e,t){var i=document.createElement("button");i.innerHTML=e;var r=i.style;return r.float="right",r.textTransform="uppercase",r.color="#1094f7",r.fontSize="14px",r.letterSpacing=0,r.border=0,r.background="none",r.marginTop="16px",i.addEventListener("click",t),i},"undefined"!=typeof window?window:void 0!==E||"undefined"!=typeof self&&self;var ey=(e=p={exports:{}},t=p.exports,i=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(1),a="undefined"!=typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream,s=function(){function e(){(function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")})(this,e),a?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",n),this.noSleepVideo.addEventListener("timeupdate",(function(e){this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())}).bind(this)))}return r(e,[{key:"enable",value:function(){a?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/",window.setTimeout(window.stop,0)},15e3)):this.noSleepVideo.play()}},{key:"disable",value:function(){a?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]),e}();e.exports=s},function(e,t,i){e.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])},e.exports=i(),(f=p.exports)&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default"))?f.default:f,eb=1e3,eE=[0,0,.5,1],ex=[.5,0,.5,1],eM=window.requestAnimationFrame,eS=window.cancelAnimationFrame;function eF(e){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:e.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:e.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:e.canPresent},maxLayers:{writable:!1,enumerable:!0,value:e.maxLayers},hasOrientation:{enumerable:!0,get:function(){return H("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData"),e.hasOrientation}}})}function eR(e){var t=!("wakelock"in(e=e||{}))||e.wakelock;this.isPolyfilled=!0,this.displayId=eb++,this.displayName="",this.depthNear=.01,this.depthFar=1e4,this.isPresenting=!1,Object.defineProperty(this,"isConnected",{get:function(){return H("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay"),!1}}),this.capabilities=new eF({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1}),this.stageParameters=null,this.waitingForPresent_=!1,this.layer_=null,this.originalParent_=null,this.fullscreenElement_=null,this.fullscreenWrapper_=null,this.fullscreenElementCachedStyle_=null,this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null,t&&G()&&(this.wakelock_=new ey)}eR.prototype.getFrameData=function(e){return k(e,this._getPose(),this)},eR.prototype.getPose=function(){return H("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData"),this._getPose()},eR.prototype.resetPose=function(){return H("VRDisplay.prototype.resetPose"),this._resetPose()},eR.prototype.getImmediatePose=function(){return H("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData"),this._getPose()},eR.prototype.requestAnimationFrame=function(e){return eM(e)},eR.prototype.cancelAnimationFrame=function(e){return eS(e)},eR.prototype.wrapForFullscreen=function(e){if(y())return e;if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var t=["height: "+Math.min(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",t.join("; ")+";"),this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==e)return this.fullscreenWrapper_;if(this.fullscreenElement_&&(this.originalParent_?this.originalParent_.appendChild(this.fullscreenElement_):this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)),this.fullscreenElement_=e,this.originalParent_=e.parentElement,this.originalParent_||document.body.appendChild(e),!this.fullscreenWrapper_.parentElement){var i=this.fullscreenElement_.parentElement;i.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_),i.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild),this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var r=this;return function(){if(r.fullscreenElement_){var e=["position: absolute","top: 0","left: 0","width: "+Math.max(screen.width,screen.height)+"px","height: "+Math.min(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];r.fullscreenElement_.setAttribute("style",e.join("; ")+";")}}(),this.fullscreenWrapper_},eR.prototype.removeFullscreenWrapper=function(){if(this.fullscreenElement_){var e=this.fullscreenElement_;this.fullscreenElementCachedStyle_?e.setAttribute("style",this.fullscreenElementCachedStyle_):e.removeAttribute("style"),this.fullscreenElement_=null,this.fullscreenElementCachedStyle_=null;var t=this.fullscreenWrapper_.parentElement;return this.fullscreenWrapper_.removeChild(e),this.originalParent_===t?t.insertBefore(e,this.fullscreenWrapper_):this.originalParent_&&this.originalParent_.appendChild(e),t.removeChild(this.fullscreenWrapper_),e}},eR.prototype.requestPresent=function(e){var t=this.isPresenting,i=this;return e instanceof Array||(H("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument"),e=[e]),new Promise(function(r,n){if(!i.capabilities.canPresent){n(Error("VRDisplay is not capable of presenting."));return}if(0==e.length||e.length>i.capabilities.maxLayers){n(Error("Invalid number of layers."));return}var a=e[0];if(!a.source){r();return}var s=a.leftBounds||eE,o=a.rightBounds||ex;if(t){var l=i.layer_;l.source!==a.source&&(l.source=a.source);for(var h=0;h<4;h++)l.leftBounds[h]=s[h],l.rightBounds[h]=o[h];i.wrapForFullscreen(i.layer_.source),i.updatePresent_(),r();return}if(i.layer_={predistorted:a.predistorted,source:a.source,leftBounds:s.slice(0),rightBounds:o.slice(0)},i.waitingForPresent_=!1,i.layer_&&i.layer_.source){var c=i.wrapForFullscreen(i.layer_.source);i.addFullscreenListeners_(c,function(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i.isPresenting=c===e,i.isPresenting?(screen.orientation&&screen.orientation.lock&&screen.orientation.lock("landscape-primary").catch(function(e){console.error("screen.orientation.lock() failed due to",e.message)}),i.waitingForPresent_=!1,i.beginPresent_(),r()):(screen.orientation&&screen.orientation.unlock&&screen.orientation.unlock(),i.removeFullscreenWrapper(),i.disableWakeLock(),i.endPresent_(),i.removeFullscreenListeners_()),i.fireVRDisplayPresentChange_()},function(){i.waitingForPresent_&&(i.removeFullscreenWrapper(),i.removeFullscreenListeners_(),i.disableWakeLock(),i.waitingForPresent_=!1,i.isPresenting=!1,n(Error("Unable to present.")))}),D(c)?(i.enableWakeLock(),i.waitingForPresent_=!0):(y()||b())&&(i.enableWakeLock(),i.isPresenting=!0,i.beginPresent_(),i.fireVRDisplayPresentChange_(),r())}i.waitingForPresent_||y()||(B(),n(Error("Unable to present.")))})},eR.prototype.exitPresent=function(){var e=this.isPresenting,t=this;return this.isPresenting=!1,this.layer_=null,this.disableWakeLock(),new Promise(function(i,r){e?(!B()&&y()&&(t.endPresent_(),t.fireVRDisplayPresentChange_()),b()&&(t.removeFullscreenWrapper(),t.removeFullscreenListeners_(),t.endPresent_(),t.fireVRDisplayPresentChange_()),i()):r(Error("Was not presenting to VRDisplay."))})},eR.prototype.getLayers=function(){return this.layer_?[this.layer_]:[]},eR.prototype.fireVRDisplayPresentChange_=function(){var e=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(e)},eR.prototype.fireVRDisplayConnect_=function(){var e=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(e)},eR.prototype.addFullscreenListeners_=function(e,t,i){this.removeFullscreenListeners_(),this.fullscreenEventTarget_=e,this.fullscreenChangeHandler_=t,this.fullscreenErrorHandler_=i,t&&(document.fullscreenEnabled?e.addEventListener("fullscreenchange",t,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenchange",t,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenchange",t,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenchange",t,!1)),i&&(document.fullscreenEnabled?e.addEventListener("fullscreenerror",i,!1):document.webkitFullscreenEnabled?e.addEventListener("webkitfullscreenerror",i,!1):document.mozFullScreenEnabled?document.addEventListener("mozfullscreenerror",i,!1):document.msFullscreenEnabled&&e.addEventListener("msfullscreenerror",i,!1))},eR.prototype.removeFullscreenListeners_=function(){if(this.fullscreenEventTarget_){var e=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var t=this.fullscreenChangeHandler_;e.removeEventListener("fullscreenchange",t,!1),e.removeEventListener("webkitfullscreenchange",t,!1),document.removeEventListener("mozfullscreenchange",t,!1),e.removeEventListener("msfullscreenchange",t,!1)}if(this.fullscreenErrorHandler_){var i=this.fullscreenErrorHandler_;e.removeEventListener("fullscreenerror",i,!1),e.removeEventListener("webkitfullscreenerror",i,!1),document.removeEventListener("mozfullscreenerror",i,!1),e.removeEventListener("msfullscreenerror",i,!1)}this.fullscreenEventTarget_=null,this.fullscreenChangeHandler_=null,this.fullscreenErrorHandler_=null}},eR.prototype.enableWakeLock=function(){this.wakelock_&&this.wakelock_.enable()},eR.prototype.disableWakeLock=function(){this.wakelock_&&this.wakelock_.disable()},eR.prototype.beginPresent_=function(){},eR.prototype.endPresent_=function(){},eR.prototype.submitFrame=function(e){},eR.prototype.getEyeParameters=function(e){return null};var e_={ADDITIONAL_VIEWERS:[],DEFAULT_VIEWER:"",MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},eT={LEFT:"left",RIGHT:"right"};function eP(e){var t=N({},e_);e=N(t,e||{}),eR.call(this,{wakelock:e.MOBILE_WAKE_LOCK}),this.config=e,this.displayName="Cardboard VRDisplay",this.capabilities=new eF({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1}),this.stageParameters=null,this.bufferScale_=this.config.BUFFER_SCALE,this.poseSensor_=new em(this.config),this.distorter_=null,this.cardboardUI_=null,this.dpdb_=new eo(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this)),this.deviceInfo_=new en(this.dpdb_.getDeviceParams(),e.ADDITIONAL_VIEWERS),this.viewerSelector_=new ew(e.DEFAULT_VIEWER),this.viewerSelector_.onChange(this.onViewerChanged_.bind(this)),this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer()),this.config.ROTATE_INSTRUCTIONS_DISABLED||(this.rotateInstructions_=new eg),y()&&window.addEventListener("resize",this.onResize_.bind(this))}return eP.prototype=Object.create(eR.prototype),eP.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}},eP.prototype._resetPose=function(){this.poseSensor_.resetPose&&this.poseSensor_.resetPose()},eP.prototype._getFieldOfView=function(e){var t;if(e==eT.LEFT)t=this.deviceInfo_.getFieldOfViewLeftEye();else{if(e!=eT.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=this.deviceInfo_.getFieldOfViewRightEye()}return t},eP.prototype._getEyeOffset=function(e){var t;if(e==eT.LEFT)t=[-(.5*this.deviceInfo_.viewer.interLensDistance),0,0];else{if(e!=eT.RIGHT)return console.error("Invalid eye provided: %s",e),null;t=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}return t},eP.prototype.getEyeParameters=function(e){var t=this._getEyeOffset(e),i=this._getFieldOfView(e),r={offset:t,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};return Object.defineProperty(r,"fieldOfView",{enumerable:!0,get:function(){return H("VRFieldOfView","VRFrameData's projection matrices"),i}}),r},eP.prototype.onDeviceParamsUpdated_=function(e){this.config.DEBUG&&console.log("DPDB reported that device params were updated."),this.deviceInfo_.updateDeviceParams(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_)},eP.prototype.updateBounds_=function(){this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)&&this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)},eP.prototype.beginPresent_=function(){var e=this.layer_.source.getContext("webgl");e||(e=this.layer_.source.getContext("experimental-webgl")),e||(e=this.layer_.source.getContext("webgl2")),e&&(this.layer_.predistorted?this.config.CARDBOARD_UI_DISABLED||(e.canvas.width=P()*this.bufferScale_,e.canvas.height=C()*this.bufferScale_,this.cardboardUI_=new j(e)):(this.config.CARDBOARD_UI_DISABLED||(this.cardboardUI_=new j(e)),this.distorter_=new W(e,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS),this.distorter_.updateDeviceInfo(this.deviceInfo_)),this.cardboardUI_&&this.cardboardUI_.listen((function(e){this.viewerSelector_.show(this.layer_.source.parentElement),e.stopPropagation(),e.preventDefault()}).bind(this),(function(e){this.exitPresent(),e.stopPropagation(),e.preventDefault()}).bind(this)),this.rotateInstructions_&&(T()&&G()?this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement):this.rotateInstructions_.update()),this.orientationHandler=this.onOrientationChange_.bind(this),window.addEventListener("orientationchange",this.orientationHandler),this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this),window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler),this.fireVRDisplayDeviceParamsChange_())},eP.prototype.endPresent_=function(){this.distorter_&&(this.distorter_.destroy(),this.distorter_=null),this.cardboardUI_&&(this.cardboardUI_.destroy(),this.cardboardUI_=null),this.rotateInstructions_&&this.rotateInstructions_.hide(),this.viewerSelector_.hide(),window.removeEventListener("orientationchange",this.orientationHandler),window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)},eP.prototype.updatePresent_=function(){this.endPresent_(),this.beginPresent_()},eP.prototype.submitFrame=function(e){if(this.distorter_)this.updateBounds_(),this.distorter_.submitFrame();else if(this.cardboardUI_&&this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2"));var i=t.canvas;(i.width!=this.lastWidth||i.height!=this.lastHeight)&&this.cardboardUI_.onResize(),this.lastWidth=i.width,this.lastHeight=i.height,this.cardboardUI_.render()}},eP.prototype.onOrientationChange_=function(e){this.viewerSelector_.hide(),this.rotateInstructions_&&this.rotateInstructions_.update(),this.onResize_()},eP.prototype.onResize_=function(e){if(this.layer_){var t=this.layer_.source.getContext("webgl");t||(t=this.layer_.source.getContext("experimental-webgl")),t||(t=this.layer_.source.getContext("webgl2")),t.canvas.setAttribute("style","position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; border: 0; margin: 0; padding: 0px; box-sizing: content-box;"),V(t.canvas)}},eP.prototype.onViewerChanged_=function(e){this.deviceInfo_.setViewer(e),this.distorter_&&this.distorter_.updateDeviceInfo(this.deviceInfo_),this.fireVRDisplayDeviceParamsChange_()},eP.prototype.fireVRDisplayDeviceParamsChange_=function(){var e=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(e)},eP.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.rightViewMatrix=new Float32Array(16),this.pose=null},eP.VRDisplay=eR,eP}();class tu extends q{constructor(e){super(),this.global=e,this.onWindowResize=this.onWindowResize.bind(this),this.global.window.addEventListener("resize",this.onWindowResize),this.environmentBlendMode="opaque"}onBaseLayerSet(e,t){throw Error("Not implemented")}isSessionSupported(e){throw Error("Not implemented")}isFeatureSupported(e){throw Error("Not implemented")}async requestSession(e,t){throw Error("Not implemented")}requestAnimationFrame(e){throw Error("Not implemented")}onFrameStart(e){throw Error("Not implemented")}onFrameEnd(e){throw Error("Not implemented")}doesSessionSupportReferenceSpace(e,t){throw Error("Not implemented")}requestStageBounds(){throw Error("Not implemented")}async requestFrameOfReferenceTransform(e,t){}cancelAnimationFrame(e){throw Error("Not implemented")}endSession(e){throw Error("Not implemented")}getViewSpaces(e){}getViewport(e,t,i,r,n){throw Error("Not implemented")}getProjectionMatrix(e,t){throw Error("Not implemented")}getBasePoseMatrix(){throw Error("Not implemented")}getBaseViewMatrix(e){throw Error("Not implemented")}getInputSources(){throw Error("Not implemented")}getInputPose(e,t,i){throw Error("Not implemented")}onWindowResize(){this.onWindowResize()}}let td={mapping:"xr-standard",displayProfiles:{"Oculus Quest":["oculus-touch-v2","oculus-touch","generic-trigger-squeeze-thumbstick"]},profiles:["oculus-touch","generic-trigger-squeeze-thumbstick"],axes:{length:4,0:null,1:null,2:0,3:1},buttons:{length:7,0:1,1:2,2:null,3:0,4:3,5:4,6:null},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},tA={mapping:"xr-standard",profiles:["microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}};var tp={"Daydream Controller":{mapping:"",profiles:["google-daydream","generic-trigger-touchpad"],buttons:{length:3,0:null,1:null,2:0}},"Gear VR Controller":{mapping:"xr-standard",profiles:["samsung-gearvr","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"HTC Vive Focus Controller":{mapping:"xr-standard",profiles:["htc-vive-focus","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0}},"Oculus Go Controller":{mapping:"xr-standard",profiles:["oculus-go","generic-trigger-touchpad"],buttons:{length:3,0:1,1:null,2:0},gripTransform:{orientation:[.11*Math.PI,0,0,1]}},"Oculus Touch (Right)":td,"Oculus Touch (Left)":td,"OpenVR Gamepad":{mapping:"xr-standard",profiles:["htc-vive","generic-trigger-squeeze-touchpad"],displayProfiles:{"HTC Vive":["htc-vive","generic-trigger-squeeze-touchpad"],"HTC Vive DVT":["htc-vive","generic-trigger-squeeze-touchpad"],"Valve Index":["valve-index","generic-trigger-squeeze-touchpad-thumbstick"]},buttons:{length:3,0:1,1:2,2:0},gripTransform:{position:[0,0,.05,1]},targetRayTransform:{orientation:[-.08*Math.PI,0,0,1]},userAgentOverrides:{Firefox:{axes:{invert:[1,3]}}}},"Spatial Controller (Spatial Interaction Source) 045E-065A":tA,"Spatial Controller (Spatial Interaction Source) 045E-065D":{mapping:"xr-standard",profiles:["samsung-odyssey","microsoft-mixed-reality","generic-trigger-squeeze-touchpad-thumbstick"],buttons:{length:4,0:1,1:0,2:2,3:4},gripTransform:{position:[0,-.02,.04,1],orientation:[.11*Math.PI,0,0,1]}},"Windows Mixed Reality (Right)":tA,"Windows Mixed Reality (Left)":tA};const tf=ea(.155,-.465,-.15),tm=ea(-.155,-.465,-.15),tg=ea(0,0,-.25),tv=ea(0,0,.05),tw=ea(-.08,.14,.08),ty=180/Math.PI;class tb{constructor(){this.hand="right",this.headElbowOffset=tf,this.controllerQ=ed(),this.lastControllerQ=ed(),this.headQ=ed(),this.headPos=er(),this.elbowPos=er(),this.wristPos=er(),this.time=null,this.lastTime=null,this.rootQ=ed(),this.position=er()}setHandedness(e){this.hand!=e&&(this.hand=e,"left"==this.hand?this.headElbowOffset=tm:this.headElbowOffset=tf)}update(e,t){this.time=eB(),e&&(ev(this.lastControllerQ,this.controllerQ),ev(this.controllerQ,e)),t&&(ee(this.headPos,t),et(this.headQ,t));let i=this.getHeadYawOrientation_(),r=this.quatAngle_(this.lastControllerQ,this.controllerQ);r/((this.time-this.lastTime)/1e3)>.61?ep(this.rootQ,this.rootQ,i,Math.min(r/.175,1)):ev(this.rootQ,i);let n=ea(0,0,-1);eu(n,n,this.controllerQ);let a=ec(n,[0,1,0]),s=this.clamp_((a-.12)/.87,0,1),o=em(this.rootQ);ef(o,o),eA(o,o,this.controllerQ);let l=this.elbowPos;es(l,this.headPos),eo(l,l,this.headElbowOffset);let h=en(tw);el(h,h,s),eo(l,l,h);let c=this.quatAngle_(o,ed());sssss;let u=(1-Math.pow(c*ty/180,4))*(.4+.6*s*.4),d=ed();ep(d,d,o,u);let A=ef(ed(),d),p=em(o);eA(p,p,A);let f=this.wristPos;es(f,tv),eu(f,f,d),eo(f,f,tg),eu(f,f,p),eo(f,f,l);let m=en(tw);el(m,m,s),eo(this.position,this.wristPos,m),eu(this.position,this.position,this.rootQ),this.lastTime=this.time}getPosition(){return this.position}getHeadYawOrientation_(){var e,t,i,r,n,a,s,o,l,h,c,u,d,A;let p,f,m,g,v,w,y,b=er();return n=b,a=this.headQ,s=0,o=a[0]*a[0],l=a[1]*a[1],h=a[2]*a[2],c=a[3]*a[3],n[0]=Math.asin((u=2*(a[0]*a[3]-a[1]*a[2]),d=-1,A=1,u<-1?d:u>1?A:u)),n[1]=Math.atan2(2*(a[0]*a[2]+a[1]*a[3]),c-o-l+h),n[2]=Math.atan2(2*(a[0]*a[1]+a[2]*a[3]),c-o+l-h),e=ed(),t=0,i=b[1]*ty,r=0,f=Math.sin(t*=p=.5*Math.PI/180),m=Math.cos(t),g=Math.sin(i*=p),v=Math.cos(i),w=Math.sin(r*=p),y=Math.cos(r),e[0]=f*v*y-m*g*w,e[1]=m*g*y+f*v*w,e[2]=m*v*w-f*g*y,e[3]=m*v*y+f*g*w,e}clamp_(e,t,i){return Math.min(Math.max(e,t),i)}quatAngle_(e,t){let i,r,n,a=[0,0,-1],s=[0,0,-1];return eu(a,a,e),eu(s,s,t),i=ea(a[0],a[1],a[2]),r=ea(s[0],s[1],s[2]),eh(i,i),eh(r,r),(n=ec(i,r))>1?0:n<-1?Math.PI:Math.acos(n)}}const tE=Symbol("@@webxr-polyfill/XRRemappedGamepad"),tx={pressed:!1,touched:!1,value:0};Object.freeze(tx);class tM{constructor(e,t,i){if(i||(i={}),i.userAgentOverrides){for(let e in i.userAgentOverrides)if(navigator.userAgent.includes(e)){let t=i.userAgentOverrides[e];for(let e in t)e in i?Object.assign(i[e],t[e]):i[e]=t[e];break}}let r=Array(i.axes&&i.axes.length?i.axes.length:e.axes.length),n=Array(i.buttons&&i.buttons.length?i.buttons.length:e.buttons.length),a=null;if(i.gripTransform){let e=i.gripTransform.orientation||[0,0,0,1];$(a=Y(),ew(e,e),i.gripTransform.position||[0,0,0])}let s=null;if(i.targetRayTransform){let e=i.targetRayTransform.orientation||[0,0,0,1];$(s=Y(),ew(e,e),i.targetRayTransform.position||[0,0,0])}let o=i.profiles;i.displayProfiles&&t.displayName in i.displayProfiles&&(o=i.displayProfiles[t.displayName]),this[tE]={gamepad:e,map:i,profiles:o||[e.id],mapping:i.mapping||e.mapping,axes:r,buttons:n,gripTransform:a,targetRayTransform:s},this._update()}_update(){let e=this[tE].gamepad,t=this[tE].map,i=this[tE].axes;for(let r=0;r<i.length;++r)t.axes&&r in t.axes?null===t.axes[r]?i[r]=0:i[r]=e.axes[t.axes[r]]:i[r]=e.axes[r];if(t.axes&&t.axes.invert)for(let e of t.axes.invert)e<i.length&&(i[e]*=-1);let r=this[tE].buttons;for(let i=0;i<r.length;++i)t.buttons&&i in t.buttons?null===t.buttons[i]?r[i]=tx:r[i]=e.buttons[t.buttons[i]]:r[i]=e.buttons[i]}get id(){return""}get _profiles(){return this[tE].profiles}get index(){return -1}get connected(){return this[tE].gamepad.connected}get timestamp(){return this[tE].gamepad.timestamp}get mapping(){return this[tE].mapping}get axes(){return this[tE].axes}get buttons(){return this[tE].buttons}get hapticActuators(){return this[tE].gamepad.hapticActuators}}class tS{constructor(e,t,i=0,r=-1){this.polyfill=e,this.display=t,this.nativeGamepad=null,this.gamepad=null,this.inputSource=new e6(this),this.lastPosition=er(),this.emulatedPosition=!1,this.basePoseMatrix=Y(),this.outputMatrix=Y(),this.primaryButtonIndex=i,this.primaryActionPressed=!1,this.primarySqueezeButtonIndex=r,this.primarySqueezeActionPressed=!1,this.handedness="",this.targetRayMode="gaze",this.armModel=null}get profiles(){return this.gamepad?this.gamepad._profiles:[]}updateFromGamepad(e){this.nativeGamepad!==e&&(this.nativeGamepad=e,e?this.gamepad=new tM(e,this.display,tp[e.id]):this.gamepad=null),this.handedness=""===e.hand?"none":e.hand,this.gamepad&&this.gamepad._update(),e.pose?(this.targetRayMode="tracked-pointer",this.emulatedPosition=!e.pose.hasPosition):""===e.hand&&(this.targetRayMode="gaze",this.emulatedPosition=!1)}updateBasePoseMatrix(){if(this.nativeGamepad&&this.nativeGamepad.pose){let e=this.nativeGamepad.pose,t=e.position,i=e.orientation;if(!t&&!i)return;t?(this.lastPosition[0]=t[0],this.lastPosition[1]=t[1],this.lastPosition[2]=t[2]):e.hasPosition?t=this.lastPosition:(this.armModel||(this.armModel=new tb),this.armModel.setHandedness(this.nativeGamepad.hand),this.armModel.update(i,this.polyfill.getBasePoseMatrix()),t=this.armModel.getPosition()),$(this.basePoseMatrix,i,t)}else{var e,t;e=this.basePoseMatrix,t=this.polyfill.getBasePoseMatrix(),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]}return this.basePoseMatrix}getXRPose(e,t){switch(this.updateBasePoseMatrix(),t){case"target-ray":e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[tE].targetRayTransform&&J(this.outputMatrix,this.outputMatrix,this.gamepad[tE].targetRayTransform);break;case"grip":if(!this.nativeGamepad||!this.nativeGamepad.pose)return null;e._transformBasePoseMatrix(this.outputMatrix,this.basePoseMatrix),this.gamepad&&this.gamepad[tE].gripTransform&&J(this.outputMatrix,this.outputMatrix,this.gamepad[tE].gripTransform);break;default:return null}return e._adjustForOriginOffset(this.outputMatrix),new XRPose(new XRRigidTransform(this.outputMatrix),this.emulatedPosition)}}Symbol("@@webxr-polyfill/WebVRDevice");const tF={highRefreshRate:!0},tR={oculus:1,openvr:1,"spatial controller (spatial interaction source)":1};let t_=0;class tT{constructor(e,t,i={}){if(this.mode=e,this.enabledFeatures=t,this.outputContext=null,this.immersive="immersive-vr"==e||"immersive-ar"==e,this.ended=null,this.baseLayer=null,this.id=++t_,this.modifiedCanvasLayer=!1,this.outputContext){let e=i.renderContextType||"2d";this.renderContext=this.outputContext.canvas.getContext(e)}}}class tP extends tu{constructor(e,t){let{canPresent:i}=t.capabilities;super(e),this.display=t,this.frame=new e.VRFrameData,this.sessions=new Map,this.immersiveSession=null,this.canPresent=i,this.baseModelMatrix=Y(),this.gamepadInputSources={},this.tempVec3=new Float32Array(3),this.onVRDisplayPresentChange=this.onVRDisplayPresentChange.bind(this),e.window.addEventListener("vrdisplaypresentchange",this.onVRDisplayPresentChange),this.CAN_USE_GAMEPAD=e.navigator&&"getGamepads"in e.navigator,this.HAS_BITMAP_SUPPORT=to(e)}get depthNear(){return this.display.depthNear}set depthNear(e){this.display.depthNear=e}get depthFar(){return this.display.depthFar}set depthFar(e){this.display.depthFar=e}onBaseLayerSet(e,t){let i=this.sessions.get(e),r=t.context.canvas;if(i.immersive){let e=this.display.getEyeParameters("left"),n=this.display.getEyeParameters("right");r.width=2*Math.max(e.renderWidth,n.renderWidth),r.height=Math.max(e.renderHeight,n.renderHeight),this.display.requestPresent([{source:r,attributes:tF}]).then(()=>{this.global.document.body.contains(r)||(i.modifiedCanvasLayer=!0,this.global.document.body.appendChild(r),th(r)),i.baseLayer=t})}else i.baseLayer=t}isSessionSupported(e){return"immersive-ar"!=e&&("immersive-vr"!=e||!1!==this.canPresent)}isFeatureSupported(e){switch(e){case"viewer":case"local":case"local-floor":return!0;default:return!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let i="immersive-vr"==e;if(i){let e=this.global.document.createElement("canvas");e.getContext("webgl"),await this.display.requestPresent([{source:e,attributes:tF}])}let r=new tT(e,t,{renderContextType:this.HAS_BITMAP_SUPPORT?"bitmaprenderer":"2d"});return this.sessions.set(r.id,r),i&&(this.immersiveSession=r,this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id)),Promise.resolve(r.id)}requestAnimationFrame(e){return this.display.requestAnimationFrame(e)}getPrimaryButtonIndex(e){let t=0,i=e.id.toLowerCase();for(let e in tR)if(i.includes(e)){t=tR[e];break}return Math.min(t,e.buttons.length-1)}onFrameStart(e,t){this.display.depthNear=t.depthNear,this.display.depthFar=t.depthFar,this.display.getFrameData(this.frame);let i=this.sessions.get(e);if(i.immersive&&this.CAN_USE_GAMEPAD){let e=this.gamepadInputSources;this.gamepadInputSources={};let t=this.global.navigator.getGamepads();for(let r=0;r<t.length;++r){let n=t[r];if(n&&n.displayId>0){let t=e[r];if(t||(t=new tS(this,this.display,this.getPrimaryButtonIndex(n))),t.updateFromGamepad(n),this.gamepadInputSources[r]=t,-1!=t.primaryButtonIndex){let e=n.buttons[t.primaryButtonIndex].pressed;e&&!t.primaryActionPressed?this.dispatchEvent("@@webxr-polyfill/input-select-start",{sessionId:i.id,inputSource:t.inputSource}):!e&&t.primaryActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-select-end",{sessionId:i.id,inputSource:t.inputSource}),t.primaryActionPressed=e}if(-1!=t.primarySqueezeButtonIndex){let e=n.buttons[t.primarySqueezeButtonIndex].pressed;e&&!t.primarySqueezeActionPressed?this.dispatchEvent("@@webxr-polyfill/input-squeeze-start",{sessionId:i.id,inputSource:t.inputSource}):!e&&t.primarySqueezeActionPressed&&this.dispatchEvent("@@webxr-polyfill/input-squeeze-end",{sessionId:i.id,inputSource:t.inputSource}),t.primarySqueezeActionPressed=e}}}}if(!i.immersive&&i.baseLayer){let e=i.baseLayer.context.canvas;ei(this.frame.leftProjectionMatrix,t.inlineVerticalFieldOfView,e.width/e.height,t.depthNear,t.depthFar)}}onFrameEnd(e){let t=this.sessions.get(e);if(!t.ended&&t.baseLayer){if(t.outputContext&&!(t.immersive&&!this.display.capabilities.hasExternalDisplay)){let e=t.immersive&&this.display.capabilities.hasExternalDisplay,i=t.baseLayer.context.canvas,r=e?i.width/2:i.width,n=i.height;{let e=t.outputContext.canvas,a=e.width,s=e.height,o=t.renderContext;this.HAS_BITMAP_SUPPORT?i.transferToImageBitmap?o.transferFromImageBitmap(i.transferToImageBitmap()):this.global.createImageBitmap(i,0,0,r,n,{resizeWidth:a,resizeHeight:s}).then(e=>o.transferFromImageBitmap(e)):o.drawImage(i,0,0,r,n,0,0,a,s)}}t.immersive&&t.baseLayer&&this.display.submitFrame()}}cancelAnimationFrame(e){this.display.cancelAnimationFrame(e)}async endSession(e){let t=this.sessions.get(e);if(!t.ended){if(t.immersive)return this.display.exitPresent();t.ended=!0}}doesSessionSupportReferenceSpace(e,t){let i=this.sessions.get(e);return!i.ended&&i.enabledFeatures.has(t)}requestStageBounds(){if(this.display.stageParameters){let e=this.display.stageParameters.sizeX,t=this.display.stageParameters.sizeZ,i=[];return i.push(-e/2),i.push(-t/2),i.push(e/2),i.push(-t/2),i.push(e/2),i.push(t/2),i.push(-e/2),i.push(t/2),i}return null}async requestFrameOfReferenceTransform(e,t){return("local-floor"===e||"bounded-floor"===e)&&this.display.stageParameters&&this.display.stageParameters.sittingToStandingTransform?this.display.stageParameters.sittingToStandingTransform:null}getProjectionMatrix(e){if("left"===e)return this.frame.leftProjectionMatrix;if("right"===e)return this.frame.rightProjectionMatrix;if("none"===e)return this.frame.leftProjectionMatrix;throw Error("eye must be of type 'left' or 'right'")}getViewport(e,t,i,r){let n=this.sessions.get(e),{width:a,height:s}=i.context.canvas;if(!n.immersive)return r.x=r.y=0,r.width=a,r.height=s,!0;if("left"===t||"none"===t)r.x=0;else{if("right"!==t)return!1;r.x=a/2}return r.y=0,r.width=a/2,r.height=s,!0}getBasePoseMatrix(){let{position:e,orientation:t}=this.frame.pose;return(e||t)&&(e||((e=this.tempVec3)[0]=e[1]=e[2]=0),$(this.baseModelMatrix,t,e)),this.baseModelMatrix}getBaseViewMatrix(e){if("left"===e||"none"===e)return this.frame.leftViewMatrix;if("right"===e)return this.frame.rightViewMatrix;throw Error("eye must be of type 'left' or 'right'")}getInputSources(){let e=[];for(let t in this.gamepadInputSources)e.push(this.gamepadInputSources[t].inputSource);return e}getInputPose(e,t,i){if(!t)return null;for(let r in this.gamepadInputSources){let n=this.gamepadInputSources[r];if(n.inputSource===e)return n.getXRPose(t,i)}return null}onWindowResize(){}onVRDisplayPresentChange(e){this.display.isPresenting||this.sessions.forEach(e=>{if(e.immersive&&!e.ended){if(e.modifiedCanvasLayer){let t=e.baseLayer.context.canvas;document.body.removeChild(t),t.setAttribute("style","")}this.immersiveSession===e&&(this.immersiveSession=null),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e.id)}})}}class tC extends tP{constructor(e,t){var i;let r=new((i=tc)&&i.__esModule?i.default:i)(t||{});super(e,r),this.display=r,this.frame={rightViewMatrix:new Float32Array(16),leftViewMatrix:new Float32Array(16),rightProjectionMatrix:new Float32Array(16),leftProjectionMatrix:new Float32Array(16),pose:null,timestamp:null}}}let tD=0;class tB{constructor(e,t){this.mode=e,this.enabledFeatures=t,this.ended=null,this.baseLayer=null,this.id=++tD}}class tI extends tu{constructor(e){super(e),this.sessions=new Map,this.projectionMatrix=Y(),this.identityMatrix=Y()}onBaseLayerSet(e,t){this.sessions.get(e).baseLayer=t}isSessionSupported(e){return"inline"==e}isFeatureSupported(e){return"viewer"===e}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let i=new tB(e,t);return this.sessions.set(i.id,i),Promise.resolve(i.id)}requestAnimationFrame(e){return window.requestAnimationFrame(e)}cancelAnimationFrame(e){window.cancelAnimationFrame(e)}onFrameStart(e,t){let i=this.sessions.get(e);if(i.baseLayer){let e=i.baseLayer.context.canvas;ei(this.projectionMatrix,t.inlineVerticalFieldOfView,e.width/e.height,t.depthNear,t.depthFar)}}onFrameEnd(e){}async endSession(e){this.sessions.get(e).ended=!0}doesSessionSupportReferenceSpace(e,t){let i=this.sessions.get(e);return!i.ended&&i.enabledFeatures.has(t)}requestStageBounds(){return null}async requestFrameOfReferenceTransform(e,t){return null}getProjectionMatrix(e){return this.projectionMatrix}getViewport(e,t,i,r){this.sessions.get(e);let{width:n,height:a}=i.context.canvas;return r.x=r.y=0,r.width=n,r.height=a,!0}getBasePoseMatrix(){return this.identityMatrix}getBaseViewMatrix(e){return this.identityMatrix}getInputSources(){return[]}getInputPose(e,t,i){return null}onWindowResize(){}}const tL=async function(e){let t=null;if("getVRDisplays"in e.navigator)try{let i=await e.navigator.getVRDisplays();i&&i.length&&(t=new tP(e,i[0]))}catch(e){}return t},tO=async function(e,t){if(t.webvr){let t=await tL(e);if(t)return t}let i=tl(e);return i&&t.cardboard||!i&&t.allowCardboardOnDesktop?(e.VRFrameData||(e.VRFrameData=function(){this.rightViewMatrix=new Float32Array(16),this.leftViewMatrix=new Float32Array(16),this.rightProjectionMatrix=new Float32Array(16),this.leftProjectionMatrix=new Float32Array(16),this.pose=null}),new tC(e,t.cardboardConfig)):new tI(e)},tG={global:eD,webvr:!0,cardboard:!0,cardboardConfig:null,allowCardboardOnDesktop:!1},tN=["navigator","HTMLCanvasElement","WebGLRenderingContext"];class tV{constructor(e={}){this.config=Object.freeze(Object.assign({},tG,e)),this.global=this.config.global,this.nativeWebXR="xr"in this.global.navigator,this.injected=!1,this._injectPolyfill(this.global)}_injectPolyfill(e){if(!tN.every(t=>!!e[t]))throw Error(`Global must have the following attributes : ${tN}`);for(let t of Object.keys(tn))void 0!==e[t]?console.warn(`${t} already defined on global.`):e[t]=tn[t];ta(e.WebGLRenderingContext)&&(ts(e.HTMLCanvasElement),e.OffscreenCanvas&&ts(e.OffscreenCanvas),e.WebGL2RenderingContext&&ta(e.WebGL2RenderingContext),window.isSecureContext||console.warn(`WebXR Polyfill Warning:
This page is not running in a secure context (https:// or localhost)!
This means that although the page may be able to use the WebXR Polyfill it will
not be able to use native WebXR implementations, and as such will not be able to
access dedicated VR or AR hardware, and will not be able to take advantage of
any performance improvements a native WebXR implementation may offer. Please
host this content on a secure origin for the best user experience.
`)),this.injected=!0,this._patchNavigatorXR()}_patchNavigatorXR(){let e=tO(this.global,this.config);this.xr=new tn.XRSystem(e),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}_injectCompatibilityShims(e){if(!tN.every(t=>!!e[t]))throw Error(`Global must have the following attributes : ${tN}`);if(e.navigator.xr&&"supportsSession"in e.navigator.xr&&!("isSessionSupported"in e.navigator.xr)){let t=e.navigator.xr.supportsSession;e.navigator.xr.isSessionSupported=function(e){return t.call(this,e).then(()=>!0).catch(()=>!1)},e.navigator.xr.supportsSession=function(e){return console.warn("navigator.xr.supportsSession() is deprecated. Please call navigator.xr.isSessionSupported() instead and check the boolean value returned when the promise resolves."),t.call(this,e)}}}}var tk="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==E?E:"undefined"!=typeof self?self:{},tU=(m=w={exports:{}},w.exports,v={encode:function(e){var t,i=new ArrayBuffer(256),r=new DataView(i),n=0;function a(e){for(var a=i.byteLength,s=n+e;a<s;)a*=2;if(a!==i.byteLength){var o=r;r=new DataView(i=new ArrayBuffer(a));for(var l=n+3>>2,h=0;h<l;++h)r.setUint32(4*h,o.getUint32(4*h))}return t=e,r}function s(e){a(1).setUint8(n,e),n+=t}function o(e){for(var i=a(e.length),r=0;r<e.length;++r)i.setUint8(n+r,e[r]);n+=t}function l(e,i){var r,o;i<24?s(e<<5|i):i<256?(s(e<<5|24),s(i)):(i<65536?(s(e<<5|25),a(2).setUint16(n,i)):i<4294967296?(s(e<<5|26),a(4).setUint32(n,i)):(s(e<<5|27),r=i%4294967296,(o=a(8)).setUint32(n,(i-r)/4294967296),o.setUint32(n+4,r)),n+=t)}if(function e(i){if(!1===i)return s(244);if(!0===i)return s(245);if(null===i)return s(246);if(void 0===i)return s(247);switch(typeof i){case"number":if(Math.floor(i)===i){if(0<=i&&i<=9007199254740992)return l(0,i);if(-9007199254740992<=i&&i<0)return l(1,-(i+1))}return s(251),void(a(8).setFloat64(n,i),n+=t);case"string":var r,h,c=[];for(r=0;r<i.length;++r){var u=i.charCodeAt(r);u<128?c.push(u):(u<2048?c.push(192|u>>6):(u<55296?c.push(224|u>>12):(u=((1023&u)<<10|1023&i.charCodeAt(++r))+65536,c.push(240|u>>18),c.push(128|u>>12&63)),c.push(128|u>>6&63)),c.push(128|63&u))}return l(3,c.length),o(c);default:if(Array.isArray(i))for(l(4,h=i.length),r=0;r<h;++r)e(i[r]);else if(i instanceof Uint8Array)l(2,i.length),o(i);else{var d=Object.keys(i);for(l(5,h=d.length),r=0;r<h;++r){var A=d[r];e(A),e(i[A])}}}}(e),"slice"in i)return i.slice(0,n);for(var h=new ArrayBuffer(n),c=new DataView(h),u=0;u<n;++u)c.setUint8(u,r.getUint8(u));return h},decode:function(e,t,i){var r=new DataView(e),n=0;function a(t){var i;return i=new Uint8Array(e,n,t),n+=t,i}function s(){var e;return e=r.getUint8(n),n+=1,e}function o(){var e;return e=r.getUint16(n),n+=2,e}function l(){var e;return e=r.getUint32(n),n+=4,e}function h(){return 255===r.getUint8(n)&&(n+=1,!0)}function c(e){if(e<24)return e;if(24===e)return s();if(25===e)return o();if(26===e)return l();if(27===e)return 4294967296*l()+l();if(31===e)return -1;throw"Invalid length encoding"}function u(e){var t=s();if(255===t)return -1;var i=c(31&t);if(i<0||t>>5!==e)throw"Invalid indefinite length element";return i}function d(e,t){for(var i=0;i<t;++i){var r=s();128&r&&(r<224?(r=(31&r)<<6|63&s(),t-=1):r<240?(r=(15&r)<<12|(63&s())<<6|63&s(),t-=2):(r=(15&r)<<18|(63&s())<<12|(63&s())<<6|63&s(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof i&&(i=function(){return g});var A=function e(){var l,A,p,f,m,v=s(),w=v>>5,y=31&v;if(7===w)switch(y){case 25:return function(){var e=new DataView(new ArrayBuffer(4)),t=o(),i=31744&t,r=1023&t;if(31744===i)i=261120;else if(0!==i)i+=114688;else if(0!==r)return 5960464477539063e-23*r;return e.setUint32(0,(32768&t)<<16|i<<13|r<<13),e.getFloat32(0)}();case 26:return l=r.getFloat32(n),n+=4,l;case 27:return A=r.getFloat64(n),n+=8,A}if((f=c(y))<0&&(w<2||6<w))throw"Invalid length";switch(w){case 0:return f;case 1:return -1-f;case 2:if(f<0){for(var b=[],E=0;(f=u(w))>=0;)E+=f,b.push(a(f));var x=new Uint8Array(E),M=0;for(p=0;p<b.length;++p)x.set(b[p],M),M+=b[p].length;return x}return a(f);case 3:var S=[];if(f<0)for(;(f=u(w))>=0;)d(S,f);else d(S,f);return String.fromCharCode.apply(null,S);case 4:if(f<0)for(m=[];!h();)m.push(e());else for(p=0,m=Array(f);p<f;++p)m[p]=e();return m;case 5:var F={};for(p=0;p<f||f<0&&!h();++p)F[e()]=e();return F;case 6:return t(e(),f);case 7:switch(f){case 20:return!1;case 21:return!0;case 22:return null;case 23:return g;default:return i(f)}}}();if(n!==e.byteLength)throw"Remaining bytes";return A}},"function"==typeof g&&g.amd?g("cbor/cbor",v):m.exports?m.exports=v:tk.CBOR||(tk.CBOR=v),w.exports);/**
 * This files defines the HoloPlayClient class and Message class.
 *
 * Copyright (c) [2019] [Looking Glass Factory]
 *
 * @link    https://lookingglassfactory.com/
 * @file    This files defines the HoloPlayClient class and Message class.
 * @author  Looking Glass Factory.
 * @version 0.0.8
 * @license SEE LICENSE IN LICENSE.md
 */const tz="undefined"==typeof window?S("khIrc"):window.WebSocket;class tQ{constructor(e,t,i,r=!1,n,a,s){this.reqs=[],this.reps=[],this.requestId=this.getRequestId(),this.debug=r,this.isGreedy=a,this.errCallback=t,this.closeCallback=i,this.alwaysdebug=!1,this.isConnected=!1;let o=null;n||a||s?o=new tX(n,a,s,this.debug):(r&&(this.alwaysdebug=!0),"function"==typeof e&&(o=new tW)),this.openWebsocket(o,e)}sendMessage(e,t=60){this.alwaysdebug&&(e.cmd.debug=!0);let i=e.toCbor();return this.sendRequestObj(i,t)}disconnect(){this.ws.close()}openWebsocket(e=null,t=null){this.ws=new tz("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]),this.ws.parent=this,this.ws.binaryType="arraybuffer",this.ws.onmessage=this.messageHandler,this.ws.onopen=()=>{this.isConnected=!0,this.debug&&console.log("socket open"),null!=e&&this.sendMessage(e).then(t)},this.ws.onerror=this.onSocketError,this.ws.onclose=this.onClose}sendRequestObj(e,t){return new Promise((i,r)=>{let n={id:this.requestId++,parent:this,payload:e,success:i,error:r,send:function(){this.debug&&console.log("attemtping to send request with ID "+this.id),this.timeout=setTimeout(n.send.bind(this),1e3*t);let i=new Uint8Array(e.byteLength+4);new DataView(i.buffer).setUint32(0,this.id),i.set(new Uint8Array(this.payload),4),this.parent.ws.send(i.buffer)}};this.reqs.push(n),n.send()})}messageHandler(e){console.log("message");let t=e.data;if(t.byteLength<4)return;let i=new DataView(t).getUint32(0);if(i<2147483648){this.parent.err("bad nng header");return}let r=this.parent.findReqIndex(i);if(-1==r){this.parent.err("got reply that doesn't match known request!");return}let n={id:i,payload:tU.decode(t.slice(4))};0==n.payload.error?this.parent.reqs[r].success(n.payload):this.parent.reqs[r].error(n.payload),clearTimeout(this.parent.reqs[r].timeout),this.parent.reqs.splice(r,1),this.parent.reps.push(n),this.debug&&console.log(n.payload)}getRequestId(){return Math.floor(2147483647*this.prng())+2147483648}onClose(e){this.parent.isConnected=!1,this.parent.debug&&console.log("socket closed"),"function"==typeof this.parent.closeCallback&&this.parent.closeCallback(e)}onSocketError(e){this.parent.debug&&console.log(e),"function"==typeof this.parent.errCallback&&this.parent.errCallback(e)}err(e){this.debug&&console.log("[DRIVER ERROR]"+e)}findReqIndex(e){let t=0;for(;t<this.reqs.length;t++)if(this.reqs[t].id==e)return t;return -1}prng(){var e,t,i,r,n;return void 0==this.rng&&(this.rng=(e=(n=function(e){for(var t=0,i=1779033703^e.length;t<e.length;t++)i=(i=Math.imul(i^e.charCodeAt(t),3432918353))<<13|i>>>19;return function(){return i=Math.imul((i=Math.imul(i^i>>>16,2246822507))^i>>>13,3266489909),(i^=i>>>16)>>>0}}(Date.now().toString()))(),t=n(),i=n(),r=n(),()=>{var n=t<<9,a=5*e;return a=(a<<7|a>>>25)*9,i^=e,r^=t,t^=i,e^=r,i^=n,r=r<<11|r>>>21,(a>>>0)/4294967296})),this.rng()}}class tH{constructor(e,t){this.cmd=e,this.bin=t}toCbor(){return tU.encode(this)}}class tX extends tH{constructor(e="",t=!1,i="",r=!1){let n={init:{}};""!=e&&(n.init.appid=e),""!=i&&(n.init.onclose=i),t&&(n.init.greedy=!0),r&&(n.init.debug=!0),super(n,null)}}class tW extends tH{constructor(){super({info:{}},null)}}function tq(e,...t){let i=e[0];for(let r=1;r<e.length;++r){let n=t[r-1];i+=("number"==typeof n?n.toPrecision(10):n)+e[r]}return i}var tj={};f(tj,"create",()=>tZ),f(tj,"clone",()=>tK),f(tj,"copy",()=>tJ),f(tj,"fromValues",()=>t$),f(tj,"set",()=>t1),f(tj,"identity",()=>t0),f(tj,"transpose",()=>t2),f(tj,"invert",()=>t3),f(tj,"adjoint",()=>t4),f(tj,"determinant",()=>t5),f(tj,"multiply",()=>t6),f(tj,"translate",()=>t7),f(tj,"scale",()=>t8),f(tj,"rotate",()=>t9),f(tj,"rotateX",()=>ie),f(tj,"rotateY",()=>it),f(tj,"rotateZ",()=>ii),f(tj,"fromTranslation",()=>ir),f(tj,"fromScaling",()=>ia),f(tj,"fromRotation",()=>is),f(tj,"fromXRotation",()=>io),f(tj,"fromYRotation",()=>il),f(tj,"fromZRotation",()=>ih),f(tj,"fromRotationTranslation",()=>ic),f(tj,"fromQuat2",()=>iu),f(tj,"getTranslation",()=>id),f(tj,"getScaling",()=>iA),f(tj,"getRotation",()=>ip),f(tj,"fromRotationTranslationScale",()=>im),f(tj,"fromRotationTranslationScaleOrigin",()=>ig),f(tj,"fromQuat",()=>iv),f(tj,"frustum",()=>iw),f(tj,"perspective",()=>iy),f(tj,"perspectiveFromFieldOfView",()=>ib),f(tj,"ortho",()=>iE),f(tj,"lookAt",()=>ix),f(tj,"targetTo",()=>iM),f(tj,"str",()=>iS),f(tj,"frob",()=>iF),f(tj,"add",()=>iR),f(tj,"subtract",()=>i_),f(tj,"multiplyScalar",()=>iT),f(tj,"multiplyScalarAndAdd",()=>iP),f(tj,"exactEquals",()=>iC),f(tj,"equals",()=>iD),f(tj,"mul",()=>iB),f(tj,"sub",()=>iI);var tY="undefined"!=typeof Float32Array?Float32Array:Array;function tZ(){var e=new tY(16);return tY!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function tK(e){var t=new tY(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tJ(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function t$(e,t,i,r,n,a,s,o,l,h,c,u,d,A,p,f){var m=new tY(16);return m[0]=e,m[1]=t,m[2]=i,m[3]=r,m[4]=n,m[5]=a,m[6]=s,m[7]=o,m[8]=l,m[9]=h,m[10]=c,m[11]=u,m[12]=d,m[13]=A,m[14]=p,m[15]=f,m}function t1(e,t,i,r,n,a,s,o,l,h,c,u,d,A,p,f,m){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=h,e[9]=c,e[10]=u,e[11]=d,e[12]=A,e[13]=p,e[14]=f,e[15]=m,e}function t0(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function t2(e,t){if(e===t){var i=t[1],r=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function t3(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],A=t[11],p=t[12],f=t[13],m=t[14],g=t[15],v=i*o-r*s,w=i*l-n*s,y=i*h-a*s,b=r*l-n*o,E=r*h-a*o,x=n*h-a*l,M=c*f-u*p,S=c*m-d*p,F=c*g-A*p,R=u*m-d*f,_=u*g-A*f,T=d*g-A*m,P=v*T-w*_+y*R+b*F-E*S+x*M;return P?(P=1/P,e[0]=(o*T-l*_+h*R)*P,e[1]=(n*_-r*T-a*R)*P,e[2]=(f*x-m*E+g*b)*P,e[3]=(d*E-u*x-A*b)*P,e[4]=(l*F-s*T-h*S)*P,e[5]=(i*T-n*F+a*S)*P,e[6]=(m*y-p*x-g*w)*P,e[7]=(c*x-d*y+A*w)*P,e[8]=(s*_-o*F+h*M)*P,e[9]=(r*F-i*_-a*M)*P,e[10]=(p*E-f*y+g*v)*P,e[11]=(u*y-c*E-A*v)*P,e[12]=(o*S-s*R-l*M)*P,e[13]=(i*R-r*S+n*M)*P,e[14]=(f*w-p*b-m*v)*P,e[15]=(c*b-u*w+d*v)*P,e):null}function t4(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],h=t[7],c=t[8],u=t[9],d=t[10],A=t[11],p=t[12],f=t[13],m=t[14],g=t[15];return e[0]=o*(d*g-A*m)-u*(l*g-h*m)+f*(l*A-h*d),e[1]=-(r*(d*g-A*m)-u*(n*g-a*m)+f*(n*A-a*d)),e[2]=r*(l*g-h*m)-o*(n*g-a*m)+f*(n*h-a*l),e[3]=-(r*(l*A-h*d)-o*(n*A-a*d)+u*(n*h-a*l)),e[4]=-(s*(d*g-A*m)-c*(l*g-h*m)+p*(l*A-h*d)),e[5]=i*(d*g-A*m)-c*(n*g-a*m)+p*(n*A-a*d),e[6]=-(i*(l*g-h*m)-s*(n*g-a*m)+p*(n*h-a*l)),e[7]=i*(l*A-h*d)-s*(n*A-a*d)+c*(n*h-a*l),e[8]=s*(u*g-A*f)-c*(o*g-h*f)+p*(o*A-h*u),e[9]=-(i*(u*g-A*f)-c*(r*g-a*f)+p*(r*A-a*u)),e[10]=i*(o*g-h*f)-s*(r*g-a*f)+p*(r*h-a*o),e[11]=-(i*(o*A-h*u)-s*(r*A-a*u)+c*(r*h-a*o)),e[12]=-(s*(u*m-d*f)-c*(o*m-l*f)+p*(o*d-l*u)),e[13]=i*(u*m-d*f)-c*(r*m-n*f)+p*(r*d-n*u),e[14]=-(i*(o*m-l*f)-s*(r*m-n*f)+p*(r*l-n*o)),e[15]=i*(o*d-l*u)-s*(r*d-n*u)+c*(r*l-n*o),e}function t5(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],h=e[8],c=e[9],u=e[10],d=e[11],A=e[12],p=e[13],f=e[14],m=e[15];return(t*s-i*a)*(u*m-d*f)-(t*o-r*a)*(c*m-d*p)+(t*l-n*a)*(c*f-u*p)+(i*o-r*s)*(h*m-d*A)-(i*l-n*s)*(h*f-u*A)+(r*l-n*o)*(h*p-c*A)}function t6(e,t,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=t[8],d=t[9],A=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],w=i[0],y=i[1],b=i[2],E=i[3];return e[0]=w*r+y*o+b*u+E*f,e[1]=w*n+y*l+b*d+E*m,e[2]=w*a+y*h+b*A+E*g,e[3]=w*s+y*c+b*p+E*v,w=i[4],y=i[5],b=i[6],E=i[7],e[4]=w*r+y*o+b*u+E*f,e[5]=w*n+y*l+b*d+E*m,e[6]=w*a+y*h+b*A+E*g,e[7]=w*s+y*c+b*p+E*v,w=i[8],y=i[9],b=i[10],E=i[11],e[8]=w*r+y*o+b*u+E*f,e[9]=w*n+y*l+b*d+E*m,e[10]=w*a+y*h+b*A+E*g,e[11]=w*s+y*c+b*p+E*v,w=i[12],y=i[13],b=i[14],E=i[15],e[12]=w*r+y*o+b*u+E*f,e[13]=w*n+y*l+b*d+E*m,e[14]=w*a+y*h+b*A+E*g,e[15]=w*s+y*c+b*p+E*v,e}function t7(e,t,i){var r=i[0],n=i[1],a=i[2],s=void 0,o=void 0,l=void 0,h=void 0,c=void 0,u=void 0,d=void 0,A=void 0,p=void 0,f=void 0,m=void 0,g=void 0;return t===e?(e[12]=t[0]*r+t[4]*n+t[8]*a+t[12],e[13]=t[1]*r+t[5]*n+t[9]*a+t[13],e[14]=t[2]*r+t[6]*n+t[10]*a+t[14],e[15]=t[3]*r+t[7]*n+t[11]*a+t[15]):(s=t[0],o=t[1],l=t[2],h=t[3],c=t[4],u=t[5],d=t[6],A=t[7],p=t[8],f=t[9],m=t[10],g=t[11],e[0]=s,e[1]=o,e[2]=l,e[3]=h,e[4]=c,e[5]=u,e[6]=d,e[7]=A,e[8]=p,e[9]=f,e[10]=m,e[11]=g,e[12]=s*r+c*n+p*a+t[12],e[13]=o*r+u*n+f*a+t[13],e[14]=l*r+d*n+m*a+t[14],e[15]=h*r+A*n+g*a+t[15]),e}function t8(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function t9(e,t,i,r){var n=r[0],a=r[1],s=r[2],o=Math.sqrt(n*n+a*a+s*s),l=void 0,h=void 0,c=void 0,u=void 0,d=void 0,A=void 0,p=void 0,f=void 0,m=void 0,g=void 0,v=void 0,w=void 0,y=void 0,b=void 0,E=void 0,x=void 0,M=void 0,S=void 0,F=void 0,R=void 0,_=void 0,T=void 0,P=void 0,C=void 0;return o<1e-6?null:(n*=o=1/o,a*=o,s*=o,l=Math.sin(i),c=1-(h=Math.cos(i)),u=t[0],d=t[1],A=t[2],p=t[3],f=t[4],m=t[5],g=t[6],v=t[7],w=t[8],y=t[9],b=t[10],E=t[11],x=n*n*c+h,M=a*n*c+s*l,S=s*n*c-a*l,F=n*a*c-s*l,R=a*a*c+h,_=s*a*c+n*l,T=n*s*c+a*l,P=a*s*c-n*l,C=s*s*c+h,e[0]=u*x+f*M+w*S,e[1]=d*x+m*M+y*S,e[2]=A*x+g*M+b*S,e[3]=p*x+v*M+E*S,e[4]=u*F+f*R+w*_,e[5]=d*F+m*R+y*_,e[6]=A*F+g*R+b*_,e[7]=p*F+v*R+E*_,e[8]=u*T+f*P+w*C,e[9]=d*T+m*P+y*C,e[10]=A*T+g*P+b*C,e[11]=p*T+v*P+E*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ie(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],s=t[5],o=t[6],l=t[7],h=t[8],c=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+h*r,e[5]=s*n+c*r,e[6]=o*n+u*r,e[7]=l*n+d*r,e[8]=h*n-a*r,e[9]=c*n-s*r,e[10]=u*n-o*r,e[11]=d*n-l*r,e}function it(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],s=t[1],o=t[2],l=t[3],h=t[8],c=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-h*r,e[1]=s*n-c*r,e[2]=o*n-u*r,e[3]=l*n-d*r,e[8]=a*r+h*n,e[9]=s*r+c*n,e[10]=o*r+u*n,e[11]=l*r+d*n,e}function ii(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],s=t[1],o=t[2],l=t[3],h=t[4],c=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+h*r,e[1]=s*n+c*r,e[2]=o*n+u*r,e[3]=l*n+d*r,e[4]=h*n-a*r,e[5]=c*n-s*r,e[6]=u*n-o*r,e[7]=d*n-l*r,e}function ir(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function ia(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function is(e,t,i){var r=i[0],n=i[1],a=i[2],s=Math.sqrt(r*r+n*n+a*a),o=void 0,l=void 0,h=void 0;return s<1e-6?null:(r*=s=1/s,n*=s,a*=s,o=Math.sin(t),h=1-(l=Math.cos(t)),e[0]=r*r*h+l,e[1]=n*r*h+a*o,e[2]=a*r*h-n*o,e[3]=0,e[4]=r*n*h-a*o,e[5]=n*n*h+l,e[6]=a*n*h+r*o,e[7]=0,e[8]=r*a*h+n*o,e[9]=n*a*h-r*o,e[10]=a*a*h+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function io(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function il(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ih(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ic(e,t,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=r+r,l=n+n,h=a+a,c=r*o,u=r*l,d=r*h,A=n*l,p=n*h,f=a*h,m=s*o,g=s*l,v=s*h;return e[0]=1-(A+f),e[1]=u+v,e[2]=d-g,e[3]=0,e[4]=u-v,e[5]=1-(c+f),e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-(c+A),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function iu(e,t){var i=new tY(3),r=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],h=t[6],c=t[7],u=r*r+n*n+a*a+s*s;return u>0?(i[0]=(o*s+c*r+l*a-h*n)*2/u,i[1]=(l*s+c*n+h*r-o*a)*2/u,i[2]=(h*s+c*a+o*n-l*r)*2/u):(i[0]=(o*s+c*r+l*a-h*n)*2,i[1]=(l*s+c*n+h*r-o*a)*2,i[2]=(h*s+c*a+o*n-l*r)*2),ic(e,t,i),e}function id(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function iA(e,t){var i=t[0],r=t[1],n=t[2],a=t[4],s=t[5],o=t[6],l=t[8],h=t[9],c=t[10];return e[0]=Math.sqrt(i*i+r*r+n*n),e[1]=Math.sqrt(a*a+s*s+o*o),e[2]=Math.sqrt(l*l+h*h+c*c),e}function ip(e,t){var i=t[0]+t[5]+t[10],r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function im(e,t,i,r){var n=t[0],a=t[1],s=t[2],o=t[3],l=n+n,h=a+a,c=s+s,u=n*l,d=n*h,A=n*c,p=a*h,f=a*c,m=s*c,g=o*l,v=o*h,w=o*c,y=r[0],b=r[1],E=r[2];return e[0]=(1-(p+m))*y,e[1]=(d+w)*y,e[2]=(A-v)*y,e[3]=0,e[4]=(d-w)*b,e[5]=(1-(u+m))*b,e[6]=(f+g)*b,e[7]=0,e[8]=(A+v)*E,e[9]=(f-g)*E,e[10]=(1-(u+p))*E,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function ig(e,t,i,r,n){var a=t[0],s=t[1],o=t[2],l=t[3],h=a+a,c=s+s,u=o+o,d=a*h,A=a*c,p=a*u,f=s*c,m=s*u,g=o*u,v=l*h,w=l*c,y=l*u,b=r[0],E=r[1],x=r[2],M=n[0],S=n[1],F=n[2],R=(1-(f+g))*b,_=(A+y)*b,T=(p-w)*b,P=(A-y)*E,C=(1-(d+g))*E,D=(m+v)*E,B=(p+w)*x,I=(m-v)*x,L=(1-(d+f))*x;return e[0]=R,e[1]=_,e[2]=T,e[3]=0,e[4]=P,e[5]=C,e[6]=D,e[7]=0,e[8]=B,e[9]=I,e[10]=L,e[11]=0,e[12]=i[0]+M-(R*M+P*S+B*F),e[13]=i[1]+S-(_*M+C*S+I*F),e[14]=i[2]+F-(T*M+D*S+L*F),e[15]=1,e}function iv(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,l=n+n,h=i*s,c=r*s,u=r*o,d=n*s,A=n*o,p=n*l,f=a*s,m=a*o,g=a*l;return e[0]=1-u-p,e[1]=c+g,e[2]=d-m,e[3]=0,e[4]=c-g,e[5]=1-h-p,e[6]=A+f,e[7]=0,e[8]=d+m,e[9]=A-f,e[10]=1-h-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iw(e,t,i,r,n,a,s){var o=1/(i-t),l=1/(n-r),h=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(i+t)*o,e[9]=(n+r)*l,e[10]=(s+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*h,e[15]=0,e}function iy(e,t,i,r,n){var a=1/Math.tan(t/2),s=void 0;return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(s=1/(r-n),e[10]=(n+r)*s,e[14]=2*n*r*s):(e[10]=-1,e[14]=-2*r),e}function ib(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),h=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((s-o)*l*.5),e[9]=(n-a)*h*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function iE(e,t,i,r,n,a,s){var o=1/(t-i),l=1/(r-n),h=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+i)*o,e[13]=(n+r)*l,e[14]=(s+a)*h,e[15]=1,e}function ix(e,t,i,r){var n=void 0,a=void 0,s=void 0,o=void 0,l=void 0,h=void 0,c=void 0,u=void 0,d=void 0,A=void 0,p=t[0],f=t[1],m=t[2],g=r[0],v=r[1],w=r[2],y=i[0],b=i[1],E=i[2];return 1e-6>Math.abs(p-y)&&1e-6>Math.abs(f-b)&&1e-6>Math.abs(m-E)?t0(e):(A=1/Math.sqrt((c=p-y)*c+(u=f-b)*u+(d=m-E)*d),c*=A,u*=A,d*=A,(A=Math.sqrt((n=v*d-w*u)*n+(a=w*c-g*d)*a+(s=g*u-v*c)*s))?(n*=A=1/A,a*=A,s*=A):(n=0,a=0,s=0),(A=Math.sqrt((o=u*s-d*a)*o+(l=d*n-c*s)*l+(h=c*a-u*n)*h))?(o*=A=1/A,l*=A,h*=A):(o=0,l=0,h=0),e[0]=n,e[1]=o,e[2]=c,e[3]=0,e[4]=a,e[5]=l,e[6]=u,e[7]=0,e[8]=s,e[9]=h,e[10]=d,e[11]=0,e[12]=-(n*p+a*f+s*m),e[13]=-(o*p+l*f+h*m),e[14]=-(c*p+u*f+d*m),e[15]=1,e)}function iM(e,t,i,r){var n=t[0],a=t[1],s=t[2],o=r[0],l=r[1],h=r[2],c=n-i[0],u=a-i[1],d=s-i[2],A=c*c+u*u+d*d;A>0&&(c*=A=1/Math.sqrt(A),u*=A,d*=A);var p=l*d-h*u,f=h*c-o*d,m=o*u-l*c;return(A=p*p+f*f+m*m)>0&&(p*=A=1/Math.sqrt(A),f*=A,m*=A),e[0]=p,e[1]=f,e[2]=m,e[3]=0,e[4]=u*m-d*f,e[5]=d*p-c*m,e[6]=c*f-u*p,e[7]=0,e[8]=c,e[9]=u,e[10]=d,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e}function iS(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function iF(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function iR(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function i_(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function iT(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function iP(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function iC(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function iD(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],c=e[8],u=e[9],d=e[10],A=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=t[0],w=t[1],y=t[2],b=t[3],E=t[4],x=t[5],M=t[6],S=t[7],F=t[8],R=t[9],_=t[10],T=t[11],P=t[12],C=t[13],D=t[14],B=t[15];return Math.abs(i-v)<=1e-6*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-w)<=1e-6*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(n-y)<=1e-6*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-b)<=1e-6*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(s-E)<=1e-6*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(o-x)<=1e-6*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(l-M)<=1e-6*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(h-S)<=1e-6*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(c-F)<=1e-6*Math.max(1,Math.abs(c),Math.abs(F))&&Math.abs(u-R)<=1e-6*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(d-_)<=1e-6*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(A-T)<=1e-6*Math.max(1,Math.abs(A),Math.abs(T))&&Math.abs(p-P)<=1e-6*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(f-C)<=1e-6*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(m-D)<=1e-6*Math.max(1,Math.abs(m),Math.abs(D))&&Math.abs(g-B)<=1e-6*Math.max(1,Math.abs(g),Math.abs(B))}var iB=t6,iI=i_,iL=Object.defineProperty,iO=(e,t,i)=>t in e?iL(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,iG=(e,t,i)=>(iO(e,"symbol"!=typeof t?t+"":t,i),i);(y=b||(b={}))[y.Swizzled=0]="Swizzled",y[y.Center=1]="Center",y[y.Quilt=2]="Quilt";class iN extends EventTarget{constructor(e){super(),iG(this,"_calibration",{configVersion:"1.0",pitch:{value:45},slope:{value:-5},center:{value:-.5},viewCone:{value:40},invView:{value:1},verticalAngle:{value:0},DPI:{value:338},screenW:{value:250},screenH:{value:250},flipImageX:{value:0},flipImageY:{value:0},flipSubp:{value:0}}),iG(this,"_viewControls",{tileHeight:512,numViews:45,trackballX:0,trackballY:0,targetX:0,targetY:1.6,targetZ:-.5,targetDiam:2,fovy:13/180*Math.PI,depthiness:1.25,inlineView:b.Center}),this._viewControls={...this._viewControls,...e},this.syncCalibration()}syncCalibration(){new tQ(e=>{if(e.devices.length<1){console.error("No Looking Glass devices found!");return}e.devices.length>1&&console.warn("More than one Looking Glass device found... using the first one"),this.calibration=e.devices[0].calibration},e=>{console.error("Error creating Looking Glass client:",e)})}addEventListener(e,t,i){super.addEventListener(e,t,i)}onConfigChange(){this.dispatchEvent(new Event("on-config-changed"))}get calibration(){return this._calibration}set calibration(e){this._calibration={...this._calibration,...e},this.onConfigChange()}updateViewControls(e){null!=e&&(this._viewControls={...this._viewControls,...e},this.onConfigChange())}get tileHeight(){return this._viewControls.tileHeight}set tileHeight(e){this.updateViewControls({tileHeight:e})}get numViews(){return this._viewControls.numViews}set numViews(e){this.updateViewControls({numViews:e})}get targetX(){return this._viewControls.targetX}set targetX(e){this.updateViewControls({targetX:e})}get targetY(){return this._viewControls.targetY}set targetY(e){this.updateViewControls({targetY:e})}get targetZ(){return this._viewControls.targetZ}set targetZ(e){this.updateViewControls({targetZ:e})}get trackballX(){return this._viewControls.trackballX}set trackballX(e){this.updateViewControls({trackballX:e})}get trackballY(){return this._viewControls.trackballY}set trackballY(e){this.updateViewControls({trackballY:e})}get targetDiam(){return this._viewControls.targetDiam}set targetDiam(e){this.updateViewControls({targetDiam:e})}get fovy(){return this._viewControls.fovy}set fovy(e){this.updateViewControls({fovy:e})}get depthiness(){return this._viewControls.depthiness}set depthiness(e){this.updateViewControls({depthiness:e})}get inlineView(){return this._viewControls.inlineView}set inlineView(e){this.updateViewControls({inlineView:e})}get aspect(){return this._calibration.screenW.value/this._calibration.screenH.value}get tileWidth(){return Math.round(this.tileHeight*this.aspect)}get framebufferWidth(){return 2**Math.ceil(Math.log2(Math.max(Math.sqrt(this.tileWidth*this.tileHeight*this.numViews),this.tileWidth)))}get quiltWidth(){return Math.floor(this.framebufferWidth/this.tileWidth)}get quiltHeight(){return Math.ceil(this.numViews/this.quiltWidth)}get framebufferHeight(){return 2**Math.ceil(Math.log2(this.quiltHeight*this.tileHeight))}get viewCone(){return this._calibration.viewCone.value*this.depthiness/180*Math.PI}get tilt(){return this._calibration.screenH.value/(this._calibration.screenW.value*this._calibration.slope.value)*(this._calibration.flipImageX.value?-1:1)}get subp(){return 1/(3*this._calibration.screenW.value)}get pitch(){let e=this._calibration.screenW.value/this._calibration.DPI.value;return this._calibration.pitch.value*e*Math.cos(Math.atan(1/this._calibration.slope.value))}}let iV=null;function ik(){return null==iV&&(iV=new iN),iV}function iU(e){let t=ik();null!=e&&t.updateViewControls(e)}const iz=Symbol("LookingGlassXRWebGLLayer");class iQ extends tt{constructor(e,t,i){let r,n,a,s,o,l,h,c;super(e,t,i);let u=document.createElement("canvas");u.tabIndex=0;let d=u.getContext("2d",{alpha:!1});u.addEventListener("dblclick",function(){this.requestFullscreen()});let A=function(e){var t;let i=ik(),r=document.createElement("style");document.head.appendChild(r),null==(t=r.sheet)||t.insertRule("#LookingGlassWebXRControls * { all: revert; font-family: sans-serif }");let n=document.createElement("div");n.id="LookingGlassWebXRControls",n.style.position="fixed",n.style.zIndex="1000",n.style.padding="15px",n.style.width="320px",n.style.maxWidth="calc(100vw - 18px)",n.style.maxHeight="calc(100vh - 18px)",n.style.whiteSpace="nowrap",n.style.background="rgba(0, 0, 0, 0.6)",n.style.color="white",n.style.borderRadius="10px",n.style.right="15px",n.style.bottom="15px";let a=document.createElement("div");n.appendChild(a),a.style.width="100%",a.style.textAlign="center",a.style.fontWeight="bold",a.innerText="Looking Glass Controls ";let s=document.createElement("div");n.appendChild(s),s.style.width="100%",s.style.whiteSpace="normal",s.style.color="rgba(255,255,255,0.7)",s.style.fontSize="14px",s.style.margin="5px 0",s.innerHTML="Click the popup and use WASD, mouse left/right drag, and scroll.";let o=document.createElement("input");a.appendChild(o),o.type="button",o.value="",o.dataset.otherValue="",o.onclick=()=>{[n.style.right,n.style.left]=[n.style.left,n.style.right],[o.value,o.dataset.otherValue]=[o.dataset.otherValue||"",o.value]};let l=document.createElement("div");n.appendChild(l);let h=(e,t,r)=>{let n=r.stringify,a=document.createElement("div");a.style.marginBottom="8px",l.appendChild(a);let s=i[e],o=document.createElement("label");if(a.appendChild(o),o.innerText=r.label,o.setAttribute("for",e),o.style.width="100px",o.style.display="inline-block",o.style.textDecoration="dotted underline 1px",o.style.fontFamily='"Courier New"',o.style.fontSize="13px",o.style.fontWeight="bold",o.title=r.title,"checkbox"!==t.type){let e=document.createElement("input");a.appendChild(e),e.type="button",e.value="",e.alt="reset",e.title="Reset value to default",e.style.padding="0 4px",e.onclick=e=>{h.value=s,h.oninput(e)}}let h=document.createElement("input");a.appendChild(h),Object.assign(h,t),h.id=e,h.title=r.title,h.value=void 0!==t.value?t.value:s;let c=t=>{i[e]=t,d(t)};h.oninput=()=>{c("range"===t.type?parseFloat(h.value):"checkbox"===t.type?h.checked:h.value)};let u=t=>{let n=t(i[e]);r.fixRange&&(n=r.fixRange(n),h.max=Math.max(parseFloat(h.max),n).toString(),h.min=Math.min(parseFloat(h.min),n).toString()),h.value=n,c(n)};"range"===t.type&&(h.style.width="110px",h.style.height="8px",h.onwheel=e=>{u(i=>i+Math.sign(e.deltaX-e.deltaY)*t.step)});let d=e=>{};if(n){let e=document.createElement("span");e.style.fontFamily='"Courier New"',e.style.fontSize="13px",e.style.marginLeft="3px",a.appendChild(e),(d=t=>{e.innerHTML=n(t)})(s)}return u};h("tileHeight",{type:"range",min:160,max:455,step:1},{label:"resolution",title:"resolution of each view",stringify:e=>`${(e*i.aspect).toFixed()}&times;${e.toFixed()}`}),h("numViews",{type:"range",min:1,max:145,step:1},{label:"views",title:"number of different viewing angles to render",stringify:e=>e.toFixed()});let c=h("trackballX",{type:"range",min:-Math.PI,max:1.0001*Math.PI,step:.5/180*Math.PI},{label:"trackball x",title:"camera trackball x",fixRange:e=>(e+3*Math.PI)%(2*Math.PI)-Math.PI,stringify:e=>`${(e/Math.PI*180).toFixed()}&deg;`}),u=h("trackballY",{type:"range",min:-.5*Math.PI,max:.5001*Math.PI,step:1/180*Math.PI},{label:"trackball y",title:"camera trackball y",fixRange:e=>Math.max(-.5*Math.PI,Math.min(e,.5*Math.PI)),stringify:e=>`${(e/Math.PI*180).toFixed()}&deg;`}),d=h("targetX",{type:"range",min:-20,max:20,step:.1},{label:"target x",title:"target position x",fixRange:e=>e,stringify:e=>e.toFixed(2)+" m"}),A=h("targetY",{type:"range",min:-20,max:20,step:.1},{label:"target y",title:"target position y",fixRange:e=>e,stringify:e=>e.toFixed(2)+" m"}),p=h("targetZ",{type:"range",min:-20,max:20,step:.1},{label:"target z",title:"target position z",fixRange:e=>e,stringify:e=>e.toFixed(2)+" m"});h("fovy",{type:"range",min:1/180*Math.PI,max:120.1/180*Math.PI,step:1/180*Math.PI},{label:"fov",title:"perspective fov (degrades stereo effect)",fixRange:e=>Math.max(1/180*Math.PI,Math.min(e,120.1/180*Math.PI)),stringify:e=>{let t=2*Math.atan(Math.tan(e/2)*i.aspect)/Math.PI*180;return`${(e/Math.PI*180).toFixed()}&deg;&times;${t.toFixed()}&deg;`}}),h("depthiness",{type:"range",min:0,max:2,step:.01},{label:"depthiness",title:'exaggerates depth by multiplying the width of the view cone (as reported by the firmware) - can somewhat compensate for depthiness lost using higher fov. 1.25 seems to be most physically accurate on Looking Glass 8.9".',fixRange:e=>Math.max(0,e),stringify:e=>`${e.toFixed(2)}x`}),h("inlineView",{type:"range",min:0,max:2,step:1},{label:"inline view",title:"what to show inline on the original canvas (swizzled = no overwrite)",fixRange:e=>Math.max(0,Math.min(e,2)),stringify:e=>0===e?"swizzled":1===e?"center":2===e?"quilt":"?"}),e.oncontextmenu=e=>{e.preventDefault()},e.addEventListener("wheel",e=>{let t=i.targetDiam;return i.targetDiam=Math.pow(1.1,Math.log(t)/Math.log(1.1)+.01*e.deltaY)}),e.addEventListener("mousemove",e=>{let t=e.movementX,r=-e.movementY;if(2&e.buttons||1&e.buttons&&(e.shiftKey||e.ctrlKey)){let e=i.trackballX,n=i.trackballY,a=-Math.cos(e)*t+Math.sin(e)*Math.sin(n)*r,s=-Math.cos(n)*r,o=Math.sin(e)*t+Math.cos(e)*Math.sin(n)*r;d(e=>e+a*i.targetDiam*.001),A(e=>e+s*i.targetDiam*.001),p(e=>e+o*i.targetDiam*.001)}else 1&e.buttons&&(c(e=>e-.01*t),u(e=>e-.01*r))});let f={w:0,a:0,s:0,d:0};return e.addEventListener("keydown",e=>{switch(e.code){case"KeyW":f.w=1;break;case"KeyA":f.a=1;break;case"KeyS":f.s=1;break;case"KeyD":f.d=1}}),e.addEventListener("keyup",e=>{switch(e.code){case"KeyW":f.w=0;break;case"KeyA":f.a=0;break;case"KeyS":f.s=0;break;case"KeyD":f.d=0}}),requestAnimationFrame(function e(){let t=f.d-f.a,r=f.w-f.s;t&&r&&(t*=Math.sqrt(.5),r*=Math.sqrt(.5));let n=i.trackballX,a=i.trackballY,s=Math.cos(n)*t-Math.sin(n)*Math.cos(a)*r,o=-Math.sin(a)*r,l=-Math.sin(n)*t-Math.cos(n)*Math.cos(a)*r;d(e=>e+s*i.targetDiam*.03),A(e=>e+o*i.targetDiam*.03),p(e=>e+l*i.targetDiam*.03),requestAnimationFrame(e)}),n}(u),p=ik(),f=this[e9].config,m=t.createTexture(),g=t.createFramebuffer(),v=t.enable.bind(t),w=t.disable.bind(t),y=t.getExtension("OES_vertex_array_object"),b=y?y.bindVertexArrayOES.bind(y):t.bindVertexArray.bind(t),E=()=>{let e=t.getParameter(t.TEXTURE_BINDING_2D);if(t.bindTexture(t.TEXTURE_2D,m),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,p.framebufferWidth,p.framebufferHeight,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,e),r){let e=t.getParameter(t.RENDERBUFFER_BINDING);t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,n.format,p.framebufferWidth,p.framebufferHeight),t.bindRenderbuffer(t.RENDERBUFFER,e)}};(f.depth||f.stencil)&&(f.depth&&f.stencil?n={format:t.DEPTH_STENCIL,attachment:t.DEPTH_STENCIL_ATTACHMENT}:f.depth?n={format:t.DEPTH_COMPONENT16,attachment:t.DEPTH_ATTACHMENT}:f.stencil&&(n={format:t.STENCIL_INDEX8,attachment:t.STENCIL_ATTACHMENT}),r=t.createRenderbuffer()),E(),p.addEventListener("on-config-changed",E);let x=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,g),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,m,0),(f.depth||f.stencil)&&t.framebufferRenderbuffer(t.FRAMEBUFFER,n.attachment,t.RENDERBUFFER,r),t.bindFramebuffer(t.FRAMEBUFFER,x);let M=t.createProgram(),S=t.createShader(t.VERTEX_SHADER);t.attachShader(M,S);let F=t.createShader(t.FRAGMENT_SHADER);t.attachShader(M,F);{let e=`
       attribute vec2 a_position;
       varying vec2 v_texcoord;
       void main() {
         gl_Position = vec4(a_position * 2.0 - 1.0, 0.0, 1.0);
         v_texcoord = a_position;
       }
     `;t.shaderSource(S,e),t.compileShader(S),t.getShaderParameter(S,t.COMPILE_STATUS)||console.warn(t.getShaderInfoLog(S))}let R=()=>{let e=tq`
  precision mediump float;
  uniform int u_viewType;
  uniform sampler2D u_texture;
  varying vec2 v_texcoord;
  const float pitch    = ${p.pitch};
  const float tilt     = ${p.tilt};
  const float center   = ${p.calibration.center.value};
  const float invView  = ${p.calibration.invView.value};
  const float flipX    = ${p.calibration.flipImageX.value};
  const float flipY    = ${p.calibration.flipImageY.value};
  const float subp     = ${p.subp};
  const float numViews = ${p.numViews};
  const float tilesX   = ${p.quiltWidth};
  const float tilesY   = ${p.quiltHeight};
  const vec2 quiltViewPortion = vec2(
    ${p.quiltWidth*p.tileWidth/p.framebufferWidth},
    ${p.quiltHeight*p.tileHeight/p.framebufferHeight});
  vec2 texArr(vec3 uvz) {
    float z = floor(uvz.z * numViews);
    float x = (mod(z, tilesX) + uvz.x) / tilesX;
    float y = (floor(z / tilesX) + uvz.y) / tilesY;
    return vec2(x, y) * quiltViewPortion;
  }
  float remap(float value, float from1, float to1, float from2, float to2) {
    return (value - from1) / (to1 - from1) * (to2 - from2) + from2;
  }
  void main() {
    if (u_viewType == 2) { // "quilt" view
      gl_FragColor = texture2D(u_texture, v_texcoord);
      return;
    }
    if (u_viewType == 1) { // middle view
      gl_FragColor = texture2D(u_texture, texArr(vec3(v_texcoord.x, v_texcoord.y, 0.5)));
      return;
    }
    vec4 rgb[3];
    vec3 nuv = vec3(v_texcoord.xy, 0.0);
    // Flip UVs if necessary
    nuv.x = (1.0 - flipX) * nuv.x + flipX * (1.0 - nuv.x);
    nuv.y = (1.0 - flipY) * nuv.y + flipY * (1.0 - nuv.y);
    for (int i = 0; i < 3; i++) {
      nuv.z = (v_texcoord.x + float(i) * subp + v_texcoord.y * tilt) * pitch - center;
      nuv.z = mod(nuv.z + ceil(abs(nuv.z)), 1.0);
      nuv.z = (1.0 - invView) * nuv.z + invView * (1.0 - nuv.z);
      rgb[i] = texture2D(u_texture, texArr(vec3(v_texcoord.x, v_texcoord.y, nuv.z)));
    }
    gl_FragColor = vec4(rgb[0].r, rgb[1].g, rgb[2].b, 1);
  }
`;if(e===a)return;if(a=e,t.shaderSource(F,e),t.compileShader(F),!t.getShaderParameter(F,t.COMPILE_STATUS)){console.warn(t.getShaderInfoLog(F));return}if(t.linkProgram(M),!t.getProgramParameter(M,t.LINK_STATUS)){console.warn(t.getProgramInfoLog(M));return}s=t.getAttribLocation(M,"a_position"),o=t.getUniformLocation(M,"u_viewType");let i=t.getUniformLocation(M,"u_texture"),r=t.getParameter(t.CURRENT_PROGRAM);t.useProgram(M),t.uniform1i(i,0),t.useProgram(r)};p.addEventListener("on-config-changed",R);let _=y?y.createVertexArrayOES():t.createVertexArray(),T=t.createBuffer(),P=t.getParameter(t.ARRAY_BUFFER_BINDING),C=t.getParameter(34229);b(_),t.bindBuffer(t.ARRAY_BUFFER,T),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.STATIC_DRAW),t.enableVertexAttribArray(s),t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),b(C),t.bindBuffer(t.ARRAY_BUFFER,P);let D=t.canvas;window.addEventListener("unload",()=>{c&&c.close(),c=void 0}),this[iz]={LookingGlassEnabled:!1,framebuffer:g,clearFramebuffer:()=>{console.assert(this[iz].LookingGlassEnabled),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer);let e=t.getParameter(t.COLOR_CLEAR_VALUE),i=t.getParameter(t.DEPTH_CLEAR_VALUE),r=t.getParameter(t.STENCIL_CLEAR_VALUE);t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(0),t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.clearColor(e[0],e[1],e[2],e[3]),t.clearDepth(i),t.clearStencil(r)},blitTextureToDefaultFramebufferIfNeeded:()=>{if(!this[iz].LookingGlassEnabled)return;(D.width!==p.calibration.screenW.value||D.height!==p.calibration.screenH.value)&&(l=D.width,h=D.height,D.width=p.calibration.screenW.value,D.height=p.calibration.screenH.value);let e=t.getParameter(34229),i=t.getParameter(t.CULL_FACE),r=t.getParameter(t.BLEND),n=t.getParameter(t.DEPTH_TEST),a=t.getParameter(t.STENCIL_TEST),s=t.getParameter(t.SCISSOR_TEST),c=t.getParameter(t.VIEWPORT),A=t.getParameter(t.FRAMEBUFFER_BINDING),f=t.getParameter(t.RENDERBUFFER_BINDING),g=t.getParameter(t.CURRENT_PROGRAM),y=t.getParameter(t.ACTIVE_TEXTURE);{let e=t.getParameter(t.TEXTURE_BINDING_2D);t.bindFramebuffer(t.FRAMEBUFFER,null),t.useProgram(M),b(_),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,m),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),t.uniform1i(o,0),t.drawArrays(t.TRIANGLES,0,6),null==d||d.clearRect(0,0,u.width,u.height),null==d||d.drawImage(D,0,0),0!==p.inlineView&&(t.uniform1i(o,p.inlineView),t.drawArrays(t.TRIANGLES,0,6)),t.bindTexture(t.TEXTURE_2D,e)}t.activeTexture(y),t.useProgram(g),t.bindRenderbuffer(t.RENDERBUFFER,f),t.bindFramebuffer(t.FRAMEBUFFER,A),t.viewport(...c),(s?v:w)(t.SCISSOR_TEST),(a?v:w)(t.STENCIL_TEST),(n?v:w)(t.DEPTH_TEST),(r?v:w)(t.BLEND),(i?v:w)(t.CULL_FACE),b(e)},moveCanvasToWindow:(e,t)=>{var i;!!c!=e&&(e?(R(),u.style.position="fixed",u.style.top="0",u.style.left="0",u.style.width="100%",u.style.height="100%",u.width=p.calibration.screenW.value,u.height=p.calibration.screenH.value,document.body.appendChild(A),(c=window.open("",void 0,"width=640,height=360")).document.title="Looking Glass Window (fullscreen me on Looking Glass!)",c.document.body.style.background="black",c.document.body.appendChild(u),console.assert(t),c.onbeforeunload=t):(null==(i=A.parentElement)||i.removeChild(A),D.width=l,D.height=h,c.onbeforeunload=void 0,c.close(),c=void 0))}}}get framebuffer(){return this[iz].LookingGlassEnabled?this[iz].framebuffer:null}get framebufferWidth(){return ik().framebufferWidth}get framebufferHeight(){return ik().framebufferHeight}}class iH extends tu{constructor(e){super(e),this.sessions=new Map,this.viewSpaces=[],this.basePoseMatrix=tj.create(),this.inlineProjectionMatrix=tj.create(),this.inlineInverseViewMatrix=tj.create(),this.LookingGlassProjectionMatrices=[],this.LookingGlassInverseViewMatrices=[]}onBaseLayerSet(e,t){let i=this.sessions.get(e);i.baseLayer=t;let r=t[iz];r.LookingGlassEnabled=i.immersive,i.immersive&&r.moveCanvasToWindow(!0,()=>{this.endSession(e)})}isSessionSupported(e){return"inline"===e||"immersive-vr"===e}isFeatureSupported(e){switch(e){case"viewer":case"local":case"local-floor":return!0;case"bounded-floor":case"unbounded":return!1;default:return console.warn("LookingGlassXRDevice.isFeatureSupported: feature not understood:",e),!1}}async requestSession(e,t){if(!this.isSessionSupported(e))return Promise.reject();let i="inline"!==e,r=new iW(e,t);return this.sessions.set(r.id,r),i&&this.dispatchEvent("@@webxr-polyfill/vr-present-start",r.id),Promise.resolve(r.id)}requestAnimationFrame(e){return this.global.requestAnimationFrame(e)}cancelAnimationFrame(e){this.global.cancelAnimationFrame(e)}onFrameStart(e,t){let i=this.sessions.get(e),r=ik();if(i.immersive){let e=Math.tan(.5*r.fovy),n=.5*r.targetDiam/e,a=n-r.targetDiam,s=this.basePoseMatrix;tj.fromTranslation(s,[r.targetX,r.targetY,r.targetZ]),tj.rotate(s,s,r.trackballX,[0,1,0]),tj.rotate(s,s,-r.trackballY,[1,0,0]),tj.translate(s,s,[0,0,n]);for(let i=0;i<r.numViews;++i){let o=(i+.5)/r.numViews-.5,l=Math.tan(r.viewCone*o),h=n*l,c=this.LookingGlassInverseViewMatrices[i]=this.LookingGlassInverseViewMatrices[i]||tj.create();tj.translate(c,s,[h,0,0]),tj.invert(c,c);let u=Math.max(a+t.depthNear,.01),d=a+t.depthFar,A=u*e,p=-A,f=-(u*l),m=r.aspect*A,g=f+m,v=f-m,w=this.LookingGlassProjectionMatrices[i]=this.LookingGlassProjectionMatrices[i]||tj.create();tj.set(w,2*u/(g-v),0,0,0,0,2*u/(A-p),0,0,(g+v)/(g-v),(A+p)/(A-p),-(d+u)/(d-u),-1,0,0,-2*d*u/(d-u),0)}i.baseLayer[iz].clearFramebuffer()}else{let e=i.baseLayer.context,r=e.drawingBufferWidth/e.drawingBufferHeight;tj.perspective(this.inlineProjectionMatrix,t.inlineVerticalFieldOfView,r,t.depthNear,t.depthFar),tj.fromTranslation(this.basePoseMatrix,[0,1.6,0]),tj.invert(this.inlineInverseViewMatrix,this.basePoseMatrix)}}onFrameEnd(e){this.sessions.get(e).baseLayer[iz].blitTextureToDefaultFramebufferIfNeeded()}async requestFrameOfReferenceTransform(e,t){let i=tj.create();switch(e){case"viewer":case"local":return tj.fromTranslation(i,[0,-1.6,0]),i;case"local-floor":return i;default:throw Error("XRReferenceSpaceType not understood")}}endSession(e){let t=this.sessions.get(e);t.immersive&&t.baseLayer&&(t.baseLayer[iz].moveCanvasToWindow(!1),this.dispatchEvent("@@webxr-polyfill/vr-present-end",e)),t.ended=!0}doesSessionSupportReferenceSpace(e,t){let i=this.sessions.get(e);return!i.ended&&i.enabledFeatures.has(t)}getViewSpaces(e){if("immersive-vr"===e){let e=ik();for(let t=this.viewSpaces.length;t<e.numViews;++t)this.viewSpaces[t]=new iq(t);return this.viewSpaces.length=e.numViews,this.viewSpaces}}getViewport(e,t,i,r,n){if(void 0===n){let t=this.sessions.get(e).baseLayer.context;r.x=0,r.y=0,r.width=t.drawingBufferWidth,r.height=t.drawingBufferHeight}else{let e=ik(),t=n%e.quiltWidth,i=Math.floor(n/e.quiltWidth);r.x=e.tileWidth*t,r.y=e.tileHeight*i,r.width=e.tileWidth,r.height=e.tileHeight}return!0}getProjectionMatrix(e,t){return void 0===t?this.inlineProjectionMatrix:this.LookingGlassProjectionMatrices[t]||tj.create()}getBasePoseMatrix(){return this.basePoseMatrix}getBaseViewMatrix(){return this.inlineInverseViewMatrix}_getViewMatrixByIndex(e){return this.LookingGlassInverseViewMatrices[e]=this.LookingGlassInverseViewMatrices[e]||tj.create()}getInputSources(){return[]}getInputPose(e,t,i){return null}onWindowResize(){}}let iX=0;class iW{constructor(e,t){iG(this,"mode"),iG(this,"immersive"),iG(this,"id"),iG(this,"baseLayer"),iG(this,"inlineVerticalFieldOfView"),iG(this,"ended"),iG(this,"enabledFeatures"),this.mode=e,this.immersive="immersive-vr"===e||"immersive-ar"===e,this.id=++iX,this.baseLayer=null,this.inlineVerticalFieldOfView=.5*Math.PI,this.ended=!1,this.enabledFeatures=t}}class iq extends ex{constructor(e){super(),iG(this,"viewIndex"),this.viewIndex=e}get eye(){return"none"}_onPoseUpdate(e){this._inverseBaseMatrix=e._getViewMatrixByIndex(this.viewIndex)}}class ij extends tV{constructor(e){for(let t in super(),iG(this,"vrButton"),iG(this,"device"),iG(this,"isPresenting",!1),iU(e),this.overrideDefaultVRButton(),console.warn('Looking Glass WebXR "polyfill" overriding native WebXR API.'),tn)this.global[t]=tn[t];this.global.XRWebGLLayer=iQ,this.injected=!0,this.device=new iH(this.global),this.xr=new eC(Promise.resolve(this.device)),Object.defineProperty(this.global.navigator,"xr",{value:this.xr,configurable:!0})}async overrideDefaultVRButton(){this.vrButton=await iY("VRButton"),this.vrButton&&(this.device.addEventListener("@@webxr-polyfill/vr-present-start",()=>{this.isPresenting=!0,this.updateVRButtonUI()}),this.device.addEventListener("@@webxr-polyfill/vr-present-end",()=>{this.isPresenting=!1,this.updateVRButtonUI()}),this.vrButton.addEventListener("click",e=>{this.updateVRButtonUI()}),this.updateVRButtonUI())}async updateVRButtonUI(){this.vrButton&&(await new Promise(e=>setTimeout(e,100)),this.isPresenting?this.vrButton.innerHTML="EXIT LOOKING GLASS":this.vrButton.innerHTML="ENTER LOOKING GLASS",this.vrButton.style.width="220px",this.vrButton.style.left="calc(50% - 110px)")}update(e){iU(e)}}async function iY(e){return new Promise((t,i)=>{let r=new MutationObserver(function(i){i.forEach(function(i){i.addedNodes.forEach(function(i){i.id==e&&(t(i),r.disconnect())})})});r.observe(document.body,{subtree:!1,childList:!0}),setTimeout(()=>{r.disconnect(),i(`id:${e} not found`)},5e3)})}const iZ=ik();class iK{static createButton(e,t={}){let i=document.createElement("button");function r(){i.style.display="",i.style.cursor="auto",i.style.left="calc(50% - 75px)",i.style.width="150px",i.onmouseenter=null,i.onmouseleave=null,i.onclick=null}function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return i.id="VRButton",i.style.display="none",n(i),navigator.xr.isSessionSupported("immersive-vr").then(function(n){n?function(){let r=null;async function n(t){t.addEventListener("end",a),await e.xr.setSession(t),i.textContent="EXIT VR",r=t}function a(){r.removeEventListener("end",a),i.textContent="ENTER VR",r=null}i.style.display="",i.style.cursor="pointer",i.style.left="calc(50% - 50px)",i.style.width="100px",i.textContent="ENTER VR";let s={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};i.onmouseenter=function(){i.style.opacity="1.0"},i.onmouseleave=function(){i.style.opacity="0.5"},i.onclick=function(){null===r?navigator.xr.requestSession("immersive-vr",s).then(n):(r.end(),void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(n).catch(e=>{console.warn(e)}))},void 0!==navigator.xr.offerSession&&navigator.xr.offerSession("immersive-vr",s).then(n).catch(e=>{console.warn(e)})}():(r(),i.textContent="VR NOT SUPPORTED"),n&&iK.xrSessionIsGranted&&i.click()}).catch(function(e){r(),console.warn("Exception when trying to call xr.isSessionSupported",e),i.textContent="VR NOT ALLOWED"}),i;{let e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",n(e),e}}static registerSessionGrantedListener(){"undefined"!=typeof navigator&&"xr"in navigator&&!/WebXRViewer\//i.test(navigator.userAgent)&&navigator.xr.addEventListener("sessiongranted",()=>{iK.xrSessionIsGranted=!0})}}iK.xrSessionIsGranted=!1,iK.registerSessionGrantedListener();const iJ={"X-Wing":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/ldraw/officialLibrary/models/7140-1-X-wingFighter.mpd_Packed.mpd","UCS AT-ST":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/ldraw/officialLibrary/models/10174-1-ImperialAT-ST-UCS.mpd_Packed.mpd","Death Star":"https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/models/10143-1 - Death Star II.mpd","Lunar Vehicle":"https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/models/ldraw/officialLibrary/models/1621-1-LunarMPVVehicle.mpd_Packed.mpd"};["6814-1 - Ice Tunnelator.mpd","6861-2 - Super Model Building Instruction.mpd","75060 - Slave I.mpd","6983-1 - Ice Station Odyssey.mpd","6835-1 - Saucer Scout.mpd","21311 - Voltron - Voltron.mpd","21303 - WALLE.mpd","1180-1 - Space Port Moon Buggy.mpd","10179-1 - Millennium Falcon - UCS.mpd","6232-1 - Skeleton Crew.mpd","6235 - Buried Treasure.mpd"].forEach(e=>{iJ[e.replace(/.+?\s-\s/,"").replace(/\.mpd$/,"")]=`https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/models/${e}`});const i$=decodeURI(window.location.hash.replace(/^#/,"")),i1={enable:!0,model:i$ in iJ?i$:"Voltron - Voltron",renderScale:1,tiles:1,samplesPerFrame:1,bounces:5,filterGlossyFactor:.5,pause:!1,tiltingPreview:!0,animationSpeed:1,numViews:54,viewCone:35,viewerDistance:.5,saveQuilt:()=>{!function(){s.setSize(l.target.width,l.target.height),h.render(s);let e=s.domElement.toDataURL("image/png"),t=document.createElement("a");t.href=e,t.download="preview.png",t.click(),t.remove(),i6()}()}},i0=new R.Vector4;let i2=i4(i1.numViews);function i3(){if(u.environment){if(s.xr.enabled=!1,a.update(),(l.samples<1||!i1.enable)&&s.render(u,o),i1.enable){if(l.material.filterGlossyFactor=i1.filterGlossyFactor,l.material.bounces=i1.bounces,l.material.physicalCamera.updateFrom(o),o.updateMatrixWorld(),!i1.pause||l.samples<1)for(let e=0,t=i1.samplesPerFrame;e<t;e++)l.update();if(s.autoClear=!1,l.samples>1&&i1.tiltingPreview&&!s.xr.isPresenting){let e=(.5+.5*Math.sin(i1.animationSpeed*window.performance.now()*.0025))*l.viewCount;c.material.displayIndex=Math.floor(e),c.material.aspectRatio=l.displayAspect*window.innerHeight/window.innerWidth,c.material.heightScale=Math.min(560/window.innerHeight,1),c.render(s)}else s.xr.isPresenting?(iZ.numViews=l.samples<1?1:i1.numViews,s.getViewport(i0),s.setViewport(0,0,i2.quiltWidth,i2.quiltHeight),h.render(s),s.setViewport(i0)):h.render(s);s.autoClear=!0}d.disable(s.xr.isPresenting),s.xr.enabled=!0,i.innerText=`Samples: ${Math.floor(l.samples)}`,r.innerText=`Distance: ${o.position.length().toFixed(2)}`}}function i4(e){let t=235200*e,i=2**Math.ceil(Math.log2(Math.max(Math.sqrt(t),420))),r=Math.floor(i/420),n=Math.ceil(e/r);return{numViews:e,numPixels:t,bufferWidth:i,quiltTilesX:r,quiltTilesY:n,quiltWidth:420*r,quiltHeight:560*n}}function i5(){let{renderScale:e,viewCone:t,viewerDistance:i}=i1;i2=i4(i1.numViews),iZ.numViews=i2.numViews,l.viewCount=i2.numViews,l.viewCone=t*R.MathUtils.DEG2RAD,l.setFromDisplayView(i,.11620499999999999,.15494),l.setSize(e*i2.quiltWidth,e*i2.quiltHeight),l.quiltDimensions.set(i2.quiltTilesX,i2.quiltTilesY)}function i6(){let e=window.innerWidth,t=window.innerHeight;s.setSize(e,t),s.setPixelRatio(window.devicePixelRatio);let i=e/t;o.aspect=i,o.updateProjectionMatrix()}!async function(){let e;r=document.getElementById("distance"),t=document.getElementById("loading"),i=document.getElementById("samples"),(s=new R.WebGLRenderer({antialias:!0})).toneMapping=R.ACESFilmicToneMapping,s.physicallyCorrectLights=!0,s.xr.enabled=!0,document.body.appendChild(s.domElement),u=new R.Scene;let A=window.innerWidth/window.innerHeight;(o=new O.PhysicalCamera(60,A,.025,500)).position.set(.43,.06,-.2).normalize().multiplyScalar(.48),o.bokehSize=0,(l=new U(s)).material=new G.PhysicalPathTracingMaterial,l.tiles.set(i1.tiles,i1.tiles),l.camera=o,o.fov=l.viewFoV*R.MathUtils.RAD2DEG,o.updateProjectionMatrix(),h=new z.FullScreenQuad(new R.MeshBasicMaterial({map:l.target.texture,blending:R.CustomBlending})),c=new z.FullScreenQuad(new X({quiltMap:l.target.texture,quiltDimensions:l.quiltDimensions,aspectRatio:l.displayAspect})),new Q.OrbitControls(o,s.domElement).addEventListener("change",()=>{l.reset()}),new(0,_.RGBELoader)().load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/aristea_wreck_puresky_2k.hdr",e=>{e.mapping=R.EquirectangularReflectionMapping,u.environment=e,u.background=e,l.material.envMapInfo.updateFrom(e),l.reset()});let p=!1,f=new R.LoadingManager;f.onProgress=(e,i,r)=>{p||(t.innerText=`Loading : ${Math.floor(100*i/r)}%`)};let m=new T.LDrawLoader(f);await m.preloadMaterials("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/colors/ldcfgalt.ldr"),m.setPartsLibraryPath("https://raw.githubusercontent.com/gkjohnson/ldraw-parts-library/master/complete/ldraw/").loadAsync(iJ[i1.model]).then(i=>{let r=(0,P.LDrawUtils).mergeObject(i);r.rotation.set(Math.PI,0,0);let n=[];r.traverse(e=>{e.isLineSegments&&n.push(e),e.isMesh&&(e.material.roughness*=.25)}),n.forEach(e=>{e.parent.remove(e)}),function(e,t){e.traverse(e=>{if(e.material){let t=e.material;if(t.opacity<.65&&t.opacity>.2){let i=new R.MeshPhysicalMaterial;for(let e in t)if(e in t){if(null===t[e])continue;t[e].isTexture?i[e]=t[e]:t[e].copy&&t[e].constructor===i[e].constructor?i[e].copy(t[e]):"number"==typeof t[e]&&(i[e]=t[e])}i.opacity=1,i.transmission=1,i.thickness=1,i.ior=1.4;let r={};i.color.getHSL(r),r.l=Math.max(r.l,.35),i.color.setHSL(r.h,r.s,r.l),e.material=i}}})}(r,0);let a=(0,B.generateRadialFloorTexture)(2048),s=new R.Mesh(new R.PlaneGeometry,new R.MeshStandardMaterial({map:a,transparent:!0,color:1118481,roughness:.2,metalness:.2,side:R.DoubleSide}));s.scale.setScalar(5),s.rotation.x=-Math.PI/2;let o=new R.Box3;o.setFromObject(r),r.position.addScaledVector(o.min,-.5).addScaledVector(o.max,-.5);let l=new R.Sphere;o.getBoundingSphere(l);let h=Math.min(.06/Math.min(Math.sqrt(o.min.x**2+o.min.z**2),l.radius),.14/(o.max.y-o.min.y));r.scale.setScalar(h),r.position.multiplyScalar(h),r.updateMatrixWorld(),o.setFromObject(r);let c=new R.Group;return s.position.y=o.min.y,c.add(r,s),c.updateMatrixWorld(!0),new L.MaterialReducer().process(c),(e=new I.PathTracingSceneGenerator).generate(c,{onProgress:e=>{t.innerText=`Building BVH : ${Math.floor(100*e)}%`}})}).then(i=>{u.add(i.scene);let{bvh:r,textures:n,materials:a,geometry:o}=i,h=l.material;h.bvh.updateFrom(r),h.attributesArray.updateFrom(o.attributes.normal,o.attributes.tangent,o.attributes.uv,o.attributes.color),h.materialIndexAttribute.updateFrom(o.attributes.materialIndex),h.textures.setTextures(s,n,2048,2048),h.materials.updateFrom(a,n),e.dispose(),t.style.visibility="hidden",s.domElement.style.visibility="visible",l.reset(),new ij,document.body.append(iK.createButton(s)),s.setAnimationLoop(i3)}).catch(e=>{p=!0,t.innerText="Failed to load model. "+e.message}),a=new D.default,document.body.appendChild(a.dom),iZ.tileHeight=560,iZ.numViews=i1.numViews,iZ.inlineView=2,i6(),i5(),function(){(n=new C.GUI).add(i1,"model",Object.keys(iJ)).onChange(e=>{window.location.hash=e,window.location.reload()}),n.add(i1,"enable"),n.add(i1,"renderScale",.1,1,.01).onChange(()=>{i5(),l.reset()}),d=n.add(i1,"saveQuilt");let e=n.addFolder("Path Tracing");e.add(i1,"pause"),e.add(i1,"bounces",1,20,1).onChange(()=>{l.reset()}),e.add(i1,"filterGlossyFactor",0,1).onChange(()=>{l.reset()}),e.add(i1,"samplesPerFrame",1,10,1),e.add(i1,"tiles",1,3,1).onChange(e=>{l.tiles.setScalar(e)});let t=n.addFolder("Looking Glass Views");t.add(i1,"numViews",1,100,1).onChange(()=>{i5(),l.reset()}),t.add(i1,"viewCone",10,70,.1).onChange(()=>{i5(),l.reset()}),t.add(i1,"viewerDistance",.2,2,.1).onChange(()=>{i5(),l.reset()});let i=n.addFolder("Preview");i.add(i1,"tiltingPreview"),i.add(i1,"animationSpeed",0,2),i.open()}(),window.addEventListener("resize",i6)}();
//# sourceMappingURL=lkg.3f4c3d44.js.map
